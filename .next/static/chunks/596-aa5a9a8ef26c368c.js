(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[596],{1029:(t,e,r)=>{"use strict";var n=r(1746),i=r(5459),s="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function o(t){if(t>0x7fffffff)throw RangeError('The value "'+t+'" is invalid for option "size"');var e=new Uint8Array(t);return Object.setPrototypeOf(e,a.prototype),e}function a(t,e,r){if("number"==typeof t){if("string"==typeof e)throw TypeError('The "string" argument must be of type string. Received type number');return l(t)}return u(t,e,r)}function u(t,e,r){if("string"==typeof t){var n=t,i=e;if(("string"!=typeof i||""===i)&&(i="utf8"),!a.isEncoding(i))throw TypeError("Unknown encoding: "+i);var s=0|d(n,i),u=o(s),c=u.write(n,i);return c!==s&&(u=u.slice(0,c)),u}if(ArrayBuffer.isView(t)){var l=t;if(P(l,Uint8Array)){var m=new Uint8Array(l);return f(m.buffer,m.byteOffset,m.byteLength)}return h(l)}if(null==t)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(P(t,ArrayBuffer)||t&&P(t.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(P(t,SharedArrayBuffer)||t&&P(t.buffer,SharedArrayBuffer)))return f(t,e,r);if("number"==typeof t)throw TypeError('The "value" argument must not be of type number. Received type number');var g=t.valueOf&&t.valueOf();if(null!=g&&g!==t)return a.from(g,e,r);var y=function(t){if(a.isBuffer(t)){var e=0|p(t.length),r=o(e);return 0===r.length||t.copy(r,0,0,e),r}return void 0!==t.length?"number"!=typeof t.length||function(t){return t!=t}(t.length)?o(0):h(t):"Buffer"===t.type&&Array.isArray(t.data)?h(t.data):void 0}(t);if(y)return y;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return a.from(t[Symbol.toPrimitive]("string"),e,r);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function c(t){if("number"!=typeof t)throw TypeError('"size" argument must be of type number');if(t<0)throw RangeError('The value "'+t+'" is invalid for option "size"')}function l(t){return c(t),o(t<0?0:0|p(t))}function h(t){for(var e=t.length<0?0:0|p(t.length),r=o(e),n=0;n<e;n+=1)r[n]=255&t[n];return r}function f(t,e,r){var n;if(e<0||t.byteLength<e)throw RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(r||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(n=void 0===e&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,e):new Uint8Array(t,e,r),a.prototype),n}function p(t){if(t>=0x7fffffff)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|t}function d(t,e){if(a.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||P(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);var r=t.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;for(var i=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return N(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return x(t).length;default:if(i)return n?-1:N(t).length;e=(""+e).toLowerCase(),i=!0}}function m(t,e,r){var i,s,o,a=!1;if((void 0===e||e<0)&&(e=0),e>this.length||((void 0===r||r>this.length)&&(r=this.length),r<=0||(r>>>=0)<=(e>>>=0)))return"";for(t||(t="utf8");;)switch(t){case"hex":return function(t,e,r){var n=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>n)&&(r=n);for(var i="",s=e;s<r;++s)i+=O[t[s]];return i}(this,e,r);case"utf8":case"utf-8":return b(this,e,r);case"ascii":return function(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(127&t[i]);return n}(this,e,r);case"latin1":case"binary":return function(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(t[i]);return n}(this,e,r);case"base64":return i=this,s=e,o=r,0===s&&o===i.length?n.fromByteArray(i):n.fromByteArray(i.slice(s,o));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(t,e,r){for(var n=t.slice(e,r),i="",s=0;s<n.length-1;s+=2)i+=String.fromCharCode(n[s]+256*n[s+1]);return i}(this,e,r);default:if(a)throw TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),a=!0}}function g(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function y(t,e,r,n,i){var s;if(0===t.length)return -1;if("string"==typeof r?(n=r,r=0):r>0x7fffffff?r=0x7fffffff:r<-0x80000000&&(r=-0x80000000),(s=r*=1)!=s&&(r=i?0:t.length-1),r<0&&(r=t.length+r),r>=t.length)if(i)return -1;else r=t.length-1;else if(r<0)if(!i)return -1;else r=0;if("string"==typeof e&&(e=a.from(e,n)),a.isBuffer(e))return 0===e.length?-1:v(t,e,r,n,i);if("number"==typeof e){if(e&=255,"function"==typeof Uint8Array.prototype.indexOf)if(i)return Uint8Array.prototype.indexOf.call(t,e,r);else return Uint8Array.prototype.lastIndexOf.call(t,e,r);return v(t,[e],r,n,i)}throw TypeError("val must be string, number or Buffer")}function v(t,e,r,n,i){var s,o=1,a=t.length,u=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return -1;o=2,a/=2,u/=2,r/=2}function c(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}if(i){var l=-1;for(s=r;s<a;s++)if(c(t,s)===c(e,-1===l?0:s-l)){if(-1===l&&(l=s),s-l+1===u)return l*o}else -1!==l&&(s-=s-l),l=-1}else for(r+u>a&&(r=a-u),s=r;s>=0;s--){for(var h=!0,f=0;f<u;f++)if(c(t,s+f)!==c(e,f)){h=!1;break}if(h)return s}return -1}function b(t,e,r){r=Math.min(t.length,r);for(var n=[],i=e;i<r;){var s,o,a,u,c=t[i],l=null,h=c>239?4:c>223?3:c>191?2:1;if(i+h<=r)switch(h){case 1:c<128&&(l=c);break;case 2:(192&(s=t[i+1]))==128&&(u=(31&c)<<6|63&s)>127&&(l=u);break;case 3:s=t[i+1],o=t[i+2],(192&s)==128&&(192&o)==128&&(u=(15&c)<<12|(63&s)<<6|63&o)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:s=t[i+1],o=t[i+2],a=t[i+3],(192&s)==128&&(192&o)==128&&(192&a)==128&&(u=(15&c)<<18|(63&s)<<12|(63&o)<<6|63&a)>65535&&u<1114112&&(l=u)}null===l?(l=65533,h=1):l>65535&&(l-=65536,n.push(l>>>10&1023|55296),l=56320|1023&l),n.push(l),i+=h}var f=n,p=f.length;if(p<=4096)return String.fromCharCode.apply(String,f);for(var d="",m=0;m<p;)d+=String.fromCharCode.apply(String,f.slice(m,m+=4096));return d}function w(t,e,r){if(t%1!=0||t<0)throw RangeError("offset is not uint");if(t+e>r)throw RangeError("Trying to access beyond buffer length")}function E(t,e,r,n,i,s){if(!a.isBuffer(t))throw TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<s)throw RangeError('"value" argument is out of bounds');if(r+n>t.length)throw RangeError("Index out of range")}function T(t,e,r,n,i,s){if(r+n>t.length||r<0)throw RangeError("Index out of range")}function _(t,e,r,n,s){return e*=1,r>>>=0,s||T(t,e,r,4,34028234663852886e22,-34028234663852886e22),i.write(t,e,r,n,23,4),r+4}function S(t,e,r,n,s){return e*=1,r>>>=0,s||T(t,e,r,8,17976931348623157e292,-17976931348623157e292),i.write(t,e,r,n,52,8),r+8}e.hp=a,e.IS=50,a.TYPED_ARRAY_SUPPORT=function(){try{var t=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(t,e),42===t.foo()}catch(t){return!1}}(),a.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}}),a.poolSize=8192,a.from=function(t,e,r){return u(t,e,r)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array),a.alloc=function(t,e,r){return(c(t),t<=0)?o(t):void 0!==e?"string"==typeof r?o(t).fill(e,r):o(t).fill(e):o(t)},a.allocUnsafe=function(t){return l(t)},a.allocUnsafeSlow=function(t){return l(t)},a.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==a.prototype},a.compare=function(t,e){if(P(t,Uint8Array)&&(t=a.from(t,t.offset,t.byteLength)),P(e,Uint8Array)&&(e=a.from(e,e.offset,e.byteLength)),!a.isBuffer(t)||!a.isBuffer(e))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;for(var r=t.length,n=e.length,i=0,s=Math.min(r,n);i<s;++i)if(t[i]!==e[i]){r=t[i],n=e[i];break}return r<n?-1:+(n<r)},a.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(t,e){if(!Array.isArray(t))throw TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return a.alloc(0);if(void 0===e)for(r=0,e=0;r<t.length;++r)e+=t[r].length;var r,n=a.allocUnsafe(e),i=0;for(r=0;r<t.length;++r){var s=t[r];if(P(s,Uint8Array))i+s.length>n.length?a.from(s).copy(n,i):Uint8Array.prototype.set.call(n,s,i);else if(a.isBuffer(s))s.copy(n,i);else throw TypeError('"list" argument must be an Array of Buffers');i+=s.length}return n},a.byteLength=d,a.prototype._isBuffer=!0,a.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)g(this,e,e+1);return this},a.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)g(this,e,e+3),g(this,e+1,e+2);return this},a.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)g(this,e,e+7),g(this,e+1,e+6),g(this,e+2,e+5),g(this,e+3,e+4);return this},a.prototype.toString=function(){var t=this.length;return 0===t?"":0==arguments.length?b(this,0,t):m.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(t){if(!a.isBuffer(t))throw TypeError("Argument must be a Buffer");return this===t||0===a.compare(this,t)},a.prototype.inspect=function(){var t="",r=e.IS;return t=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(t+=" ... "),"<Buffer "+t+">"},s&&(a.prototype[s]=a.prototype.inspect),a.prototype.compare=function(t,e,r,n,i){if(P(t,Uint8Array)&&(t=a.from(t,t.offset,t.byteLength)),!a.isBuffer(t))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),e<0||r>t.length||n<0||i>this.length)throw RangeError("out of range index");if(n>=i&&e>=r)return 0;if(n>=i)return -1;if(e>=r)return 1;if(e>>>=0,r>>>=0,n>>>=0,i>>>=0,this===t)return 0;for(var s=i-n,o=r-e,u=Math.min(s,o),c=this.slice(n,i),l=t.slice(e,r),h=0;h<u;++h)if(c[h]!==l[h]){s=c[h],o=l[h];break}return s<o?-1:+(o<s)},a.prototype.includes=function(t,e,r){return -1!==this.indexOf(t,e,r)},a.prototype.indexOf=function(t,e,r){return y(this,t,e,r,!0)},a.prototype.lastIndexOf=function(t,e,r){return y(this,t,e,r,!1)},a.prototype.write=function(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else if(isFinite(e))e>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var i,s,o,a,u,c,l,h,f=this.length-e;if((void 0===r||r>f)&&(r=f),t.length>0&&(r<0||e<0)||e>this.length)throw RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var p=!1;;)switch(n){case"hex":return function(t,e,r,n){r=Number(r)||0;var i=t.length-r;n?(n=Number(n))>i&&(n=i):n=i;var s=e.length;n>s/2&&(n=s/2);for(var o=0;o<n;++o){var a,u=parseInt(e.substr(2*o,2),16);if((a=u)!=a)break;t[r+o]=u}return o}(this,t,e,r);case"utf8":case"utf-8":return i=e,s=r,A(N(t,this.length-i),this,i,s);case"ascii":case"latin1":case"binary":return o=e,a=r,A(function(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}(t),this,o,a);case"base64":return u=e,c=r,A(x(t),this,u,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return l=e,h=r,A(function(t,e){for(var r,n,i=[],s=0;s<t.length&&!((e-=2)<0);++s)n=(r=t.charCodeAt(s))>>8,i.push(r%256),i.push(n);return i}(t,this.length-l),this,l,h);default:if(p)throw TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),p=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},a.prototype.slice=function(t,e){var r=this.length;t=~~t,e=void 0===e?r:~~e,t<0?(t+=r)<0&&(t=0):t>r&&(t=r),e<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t);var n=this.subarray(t,e);return Object.setPrototypeOf(n,a.prototype),n},a.prototype.readUintLE=a.prototype.readUIntLE=function(t,e,r){t>>>=0,e>>>=0,r||w(t,e,this.length);for(var n=this[t],i=1,s=0;++s<e&&(i*=256);)n+=this[t+s]*i;return n},a.prototype.readUintBE=a.prototype.readUIntBE=function(t,e,r){t>>>=0,e>>>=0,r||w(t,e,this.length);for(var n=this[t+--e],i=1;e>0&&(i*=256);)n+=this[t+--e]*i;return n},a.prototype.readUint8=a.prototype.readUInt8=function(t,e){return t>>>=0,e||w(t,1,this.length),this[t]},a.prototype.readUint16LE=a.prototype.readUInt16LE=function(t,e){return t>>>=0,e||w(t,2,this.length),this[t]|this[t+1]<<8},a.prototype.readUint16BE=a.prototype.readUInt16BE=function(t,e){return t>>>=0,e||w(t,2,this.length),this[t]<<8|this[t+1]},a.prototype.readUint32LE=a.prototype.readUInt32LE=function(t,e){return t>>>=0,e||w(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+0x1000000*this[t+3]},a.prototype.readUint32BE=a.prototype.readUInt32BE=function(t,e){return t>>>=0,e||w(t,4,this.length),0x1000000*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},a.prototype.readIntLE=function(t,e,r){t>>>=0,e>>>=0,r||w(t,e,this.length);for(var n=this[t],i=1,s=0;++s<e&&(i*=256);)n+=this[t+s]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*e)),n},a.prototype.readIntBE=function(t,e,r){t>>>=0,e>>>=0,r||w(t,e,this.length);for(var n=e,i=1,s=this[t+--n];n>0&&(i*=256);)s+=this[t+--n]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*e)),s},a.prototype.readInt8=function(t,e){return(t>>>=0,e||w(t,1,this.length),128&this[t])?-((255-this[t]+1)*1):this[t]},a.prototype.readInt16LE=function(t,e){t>>>=0,e||w(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?0xffff0000|r:r},a.prototype.readInt16BE=function(t,e){t>>>=0,e||w(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?0xffff0000|r:r},a.prototype.readInt32LE=function(t,e){return t>>>=0,e||w(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},a.prototype.readInt32BE=function(t,e){return t>>>=0,e||w(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},a.prototype.readFloatLE=function(t,e){return t>>>=0,e||w(t,4,this.length),i.read(this,t,!0,23,4)},a.prototype.readFloatBE=function(t,e){return t>>>=0,e||w(t,4,this.length),i.read(this,t,!1,23,4)},a.prototype.readDoubleLE=function(t,e){return t>>>=0,e||w(t,8,this.length),i.read(this,t,!0,52,8)},a.prototype.readDoubleBE=function(t,e){return t>>>=0,e||w(t,8,this.length),i.read(this,t,!1,52,8)},a.prototype.writeUintLE=a.prototype.writeUIntLE=function(t,e,r,n){if(t*=1,e>>>=0,r>>>=0,!n){var i=Math.pow(2,8*r)-1;E(this,t,e,r,i,0)}var s=1,o=0;for(this[e]=255&t;++o<r&&(s*=256);)this[e+o]=t/s&255;return e+r},a.prototype.writeUintBE=a.prototype.writeUIntBE=function(t,e,r,n){if(t*=1,e>>>=0,r>>>=0,!n){var i=Math.pow(2,8*r)-1;E(this,t,e,r,i,0)}var s=r-1,o=1;for(this[e+s]=255&t;--s>=0&&(o*=256);)this[e+s]=t/o&255;return e+r},a.prototype.writeUint8=a.prototype.writeUInt8=function(t,e,r){return t*=1,e>>>=0,r||E(this,t,e,1,255,0),this[e]=255&t,e+1},a.prototype.writeUint16LE=a.prototype.writeUInt16LE=function(t,e,r){return t*=1,e>>>=0,r||E(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},a.prototype.writeUint16BE=a.prototype.writeUInt16BE=function(t,e,r){return t*=1,e>>>=0,r||E(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},a.prototype.writeUint32LE=a.prototype.writeUInt32LE=function(t,e,r){return t*=1,e>>>=0,r||E(this,t,e,4,0xffffffff,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},a.prototype.writeUint32BE=a.prototype.writeUInt32BE=function(t,e,r){return t*=1,e>>>=0,r||E(this,t,e,4,0xffffffff,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},a.prototype.writeIntLE=function(t,e,r,n){if(t*=1,e>>>=0,!n){var i=Math.pow(2,8*r-1);E(this,t,e,r,i-1,-i)}var s=0,o=1,a=0;for(this[e]=255&t;++s<r&&(o*=256);)t<0&&0===a&&0!==this[e+s-1]&&(a=1),this[e+s]=(t/o|0)-a&255;return e+r},a.prototype.writeIntBE=function(t,e,r,n){if(t*=1,e>>>=0,!n){var i=Math.pow(2,8*r-1);E(this,t,e,r,i-1,-i)}var s=r-1,o=1,a=0;for(this[e+s]=255&t;--s>=0&&(o*=256);)t<0&&0===a&&0!==this[e+s+1]&&(a=1),this[e+s]=(t/o|0)-a&255;return e+r},a.prototype.writeInt8=function(t,e,r){return t*=1,e>>>=0,r||E(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},a.prototype.writeInt16LE=function(t,e,r){return t*=1,e>>>=0,r||E(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},a.prototype.writeInt16BE=function(t,e,r){return t*=1,e>>>=0,r||E(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},a.prototype.writeInt32LE=function(t,e,r){return t*=1,e>>>=0,r||E(this,t,e,4,0x7fffffff,-0x80000000),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},a.prototype.writeInt32BE=function(t,e,r){return t*=1,e>>>=0,r||E(this,t,e,4,0x7fffffff,-0x80000000),t<0&&(t=0xffffffff+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},a.prototype.writeFloatLE=function(t,e,r){return _(this,t,e,!0,r)},a.prototype.writeFloatBE=function(t,e,r){return _(this,t,e,!1,r)},a.prototype.writeDoubleLE=function(t,e,r){return S(this,t,e,!0,r)},a.prototype.writeDoubleBE=function(t,e,r){return S(this,t,e,!1,r)},a.prototype.copy=function(t,e,r,n){if(!a.isBuffer(t))throw TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<r&&(n=r),n===r||0===t.length||0===this.length)return 0;if(e<0)throw RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw RangeError("Index out of range");if(n<0)throw RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-r&&(n=t.length-e+r);var i=n-r;return this===t&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(e,r,n):Uint8Array.prototype.set.call(t,this.subarray(r,n),e),i},a.prototype.fill=function(t,e,r,n){if("string"==typeof t){if("string"==typeof e?(n=e,e=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw TypeError("encoding must be a string");if("string"==typeof n&&!a.isEncoding(n))throw TypeError("Unknown encoding: "+n);if(1===t.length){var i,s=t.charCodeAt(0);("utf8"===n&&s<128||"latin1"===n)&&(t=s)}}else"number"==typeof t?t&=255:"boolean"==typeof t&&(t=Number(t));if(e<0||this.length<e||this.length<r)throw RangeError("Out of range index");if(r<=e)return this;if(e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"==typeof t)for(i=e;i<r;++i)this[i]=t;else{var o=a.isBuffer(t)?t:a.from(t,n),u=o.length;if(0===u)throw TypeError('The value "'+t+'" is invalid for argument "value"');for(i=0;i<r-e;++i)this[i+e]=o[i%u]}return this};var I=/[^+/0-9A-Za-z-_]/g;function N(t,e){e=e||1/0;for(var r,n=t.length,i=null,s=[],o=0;o<n;++o){if((r=t.charCodeAt(o))>55295&&r<57344){if(!i){if(r>56319||o+1===n){(e-=3)>-1&&s.push(239,191,189);continue}i=r;continue}if(r<56320){(e-=3)>-1&&s.push(239,191,189),i=r;continue}r=(i-55296<<10|r-56320)+65536}else i&&(e-=3)>-1&&s.push(239,191,189);if(i=null,r<128){if((e-=1)<0)break;s.push(r)}else if(r<2048){if((e-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else if(r<1114112){if((e-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}else throw Error("Invalid code point")}return s}function x(t){return n.toByteArray(function(t){if((t=(t=t.split("=")[0]).trim().replace(I,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function A(t,e,r,n){for(var i=0;i<n&&!(i+r>=e.length)&&!(i>=t.length);++i)e[i+r]=t[i];return i}function P(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}var O=function(){for(var t="0123456789abcdef",e=Array(256),r=0;r<16;++r)for(var n=16*r,i=0;i<16;++i)e[n+i]=t[r]+t[i];return e}()},1746:(t,e)=>{"use strict";e.byteLength=function(t){var e=u(t),r=e[0],n=e[1];return(r+n)*3/4-n},e.toByteArray=function(t){var e,r,s=u(t),o=s[0],a=s[1],c=new i((o+a)*3/4-a),l=0,h=a>0?o-4:o;for(r=0;r<h;r+=4)e=n[t.charCodeAt(r)]<<18|n[t.charCodeAt(r+1)]<<12|n[t.charCodeAt(r+2)]<<6|n[t.charCodeAt(r+3)],c[l++]=e>>16&255,c[l++]=e>>8&255,c[l++]=255&e;return 2===a&&(e=n[t.charCodeAt(r)]<<2|n[t.charCodeAt(r+1)]>>4,c[l++]=255&e),1===a&&(e=n[t.charCodeAt(r)]<<10|n[t.charCodeAt(r+1)]<<4|n[t.charCodeAt(r+2)]>>2,c[l++]=e>>8&255,c[l++]=255&e),c},e.fromByteArray=function(t){for(var e,n=t.length,i=n%3,s=[],o=0,a=n-i;o<a;o+=16383)s.push(function(t,e,n){for(var i,s=[],o=e;o<n;o+=3)i=(t[o]<<16&0xff0000)+(t[o+1]<<8&65280)+(255&t[o+2]),s.push(r[i>>18&63]+r[i>>12&63]+r[i>>6&63]+r[63&i]);return s.join("")}(t,o,o+16383>a?a:o+16383));return 1===i?s.push(r[(e=t[n-1])>>2]+r[e<<4&63]+"=="):2===i&&s.push(r[(e=(t[n-2]<<8)+t[n-1])>>10]+r[e>>4&63]+r[e<<2&63]+"="),s.join("")};for(var r=[],n=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,a=s.length;o<a;++o)r[o]=s[o],n[s.charCodeAt(o)]=o;function u(t){var e=t.length;if(e%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");-1===r&&(r=e);var n=r===e?0:4-r%4;return[r,n]}n[45]=62,n[95]=63},2215:t=>{"use strict";var e=Object.defineProperty,r=Object.getOwnPropertyDescriptor,n=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,s=(t,r)=>{for(var n in r)e(t,n,{get:r[n],enumerable:!0})},o=(t,e,r)=>e.has(t)?(t=>{throw TypeError(t)})("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,r),a={};s(a,{Decimal:()=>et,Public:()=>u,getRuntime:()=>U,makeStrictEnum:()=>_,objectEnumValues:()=>w}),t.exports=((t,s,o,a)=>{if(s&&"object"==typeof s||"function"==typeof s)for(let u of n(s))i.call(t,u)||u===o||e(t,u,{get:()=>s[u],enumerable:!(a=r(s,u))||a.enumerable});return t})(e({},"__esModule",{value:!0}),a);var u={};function c(){return t=>t}s(u,{validator:()=>c});var l,h=Symbol(),f=new WeakMap,p=class{constructor(t){t===h?f.set(this,"Prisma.".concat(this._getName())):f.set(this,"new Prisma.".concat(this._getNamespace(),".").concat(this._getName(),"()"))}_getName(){return this.constructor.name}toString(){return f.get(this)}},d=class extends p{_getNamespace(){return"NullTypes"}},m=class extends d{constructor(){super(...arguments),o(this,l)}};l=new WeakMap,E(m,"DbNull");var g,y=class extends d{constructor(){super(...arguments),o(this,g)}};g=new WeakMap,E(y,"JsonNull");var v,b=class extends d{constructor(){super(...arguments),o(this,v)}};v=new WeakMap,E(b,"AnyNull");var w={classes:{DbNull:m,JsonNull:y,AnyNull:b},instances:{DbNull:new m(h),JsonNull:new y(h),AnyNull:new b(h)}};function E(t,e){Object.defineProperty(t,"name",{value:e,configurable:!0})}var T=new Set(["toJSON","$$typeof","asymmetricMatch",Symbol.iterator,Symbol.toStringTag,Symbol.isConcatSpreadable,Symbol.toPrimitive]);function _(t){return new Proxy(t,{get(t,e){if(e in t)return t[e];if(!T.has(e))throw TypeError("Invalid enum value: ".concat(String(e)))}})}var S=()=>{var t,e;return(null==(e=null==(t=globalThis.process)?void 0:t.release)?void 0:e.name)==="node"},I=()=>{var t,e;return!!globalThis.Bun||!!(null!=(e=null==(t=globalThis.process)?void 0:t.versions)&&e.bun)},N=()=>!!globalThis.Deno,x=()=>"object"==typeof globalThis.Netlify,A=()=>"object"==typeof globalThis.EdgeRuntime,P=()=>{var t;return(null==(t=globalThis.navigator)?void 0:t.userAgent)==="Cloudflare-Workers"},O={node:"Node.js",workerd:"Cloudflare Workers",deno:"Deno and Deno Deploy",netlify:"Netlify Edge Functions","edge-light":"Edge Runtime (Vercel Edge Functions, Vercel Edge Middleware, Next.js (Pages Router) Edge API Routes, Next.js (App Router) Edge Route Handlers or Next.js Middleware)"};function U(){var t;let e=null!=(t=[[x,"netlify"],[A,"edge-light"],[P,"workerd"],[N,"deno"],[I,"bun"],[S,"node"]].flatMap(t=>t[0]()?[t[1]]:[]).at(0))?t:"";return{id:e,prettyName:O[e]||e,isEdge:["workerd","deno","netlify","edge-light"].includes(e)}}var C,j,L="0123456789abcdef",M="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",R="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",q={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-9e15,maxE:9e15,crypto:!1},k=!0,D="[DecimalError] ",B=D+"Invalid argument: ",G=D+"Precision limit exceeded",F=D+"crypto unavailable",J="[object Decimal]",z=Math.floor,K=Math.pow,V=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,H=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,Q=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,$=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Z=M.length-1,W=R.length-1,X={toStringTag:J};function Y(t){var e,r,n,i=t.length-1,s="",o=t[0];if(i>0){for(s+=o,e=1;e<i;e++)(r=7-(n=t[e]+"").length)&&(s+=tl(r)),s+=n;(r=7-(n=(o=t[e])+"").length)&&(s+=tl(r))}else if(0===o)return"0";for(;o%10==0;)o/=10;return s+o}function tt(t,e,r){if(t!==~~t||t<e||t>r)throw Error(B+t)}function te(t,e,r,n){var i,s,o,a;for(s=t[0];s>=10;s/=10)--e;return--e<0?(e+=7,i=0):(i=Math.ceil((e+1)/7),e%=7),s=K(10,7-e),a=t[i]%s|0,null==n?e<3?(0==e?a=a/100|0:1==e&&(a=a/10|0),o=r<4&&99999==a||r>3&&49999==a||5e4==a||0==a):o=(r<4&&a+1==s||r>3&&a+1==s/2)&&(t[i+1]/s/100|0)==K(10,e-2)-1||(a==s/2||0==a)&&(t[i+1]/s/100|0)==0:e<4?(0==e?a=a/1e3|0:1==e?a=a/100|0:2==e&&(a=a/10|0),o=(n||r<4)&&9999==a||!n&&r>3&&4999==a):o=((n||r<4)&&a+1==s||!n&&r>3&&a+1==s/2)&&(t[i+1]/s/1e3|0)==K(10,e-3)-1,o}function tr(t,e,r){for(var n,i,s=[0],o=0,a=t.length;o<a;){for(i=s.length;i--;)s[i]*=e;for(s[0]+=L.indexOf(t.charAt(o++)),n=0;n<s.length;n++)s[n]>r-1&&(void 0===s[n+1]&&(s[n+1]=0),s[n+1]+=s[n]/r|0,s[n]%=r)}return s.reverse()}X.absoluteValue=X.abs=function(){var t=new this.constructor(this);return t.s<0&&(t.s=1),ti(t)},X.ceil=function(){return ti(new this.constructor(this),this.e+1,2)},X.clampedTo=X.clamp=function(t,e){var r=this.constructor;if(t=new r(t),e=new r(e),!t.s||!e.s)return new r(NaN);if(t.gt(e))throw Error(B+e);return 0>this.cmp(t)?t:this.cmp(e)>0?e:new r(this)},X.comparedTo=X.cmp=function(t){var e,r,n,i,s=this.d,o=(t=new this.constructor(t)).d,a=this.s,u=t.s;if(!s||!o)return a&&u?a!==u?a:s===o?0:!s^a<0?1:-1:NaN;if(!s[0]||!o[0])return s[0]?a:o[0]?-u:0;if(a!==u)return a;if(this.e!==t.e)return this.e>t.e^a<0?1:-1;for(n=s.length,i=o.length,e=0,r=n<i?n:i;e<r;++e)if(s[e]!==o[e])return s[e]>o[e]^a<0?1:-1;return n===i?0:n>i^a<0?1:-1},X.cosine=X.cos=function(){var t,e,r=this,n=r.constructor;return r.d?r.d[0]?(t=n.precision,e=n.rounding,n.precision=t+Math.max(r.e,r.sd())+7,n.rounding=1,r=function(t,e){var r,n,i;if(e.isZero())return e;(n=e.d.length)<32?i=(1/tb(4,r=Math.ceil(n/3))).toString():(r=16,i="2.3283064365386962890625e-10"),t.precision+=r,e=tv(t,1,e.times(i),new t(1));for(var s=r;s--;){var o=e.times(e);e=o.times(o).minus(o).times(8).plus(1)}return t.precision-=r,e}(n,tw(n,r)),n.precision=t,n.rounding=e,ti(2==j||3==j?r.neg():r,t,e,!0)):new n(1):new n(NaN)},X.cubeRoot=X.cbrt=function(){var t,e,r,n,i,s,o,a,u,c,l=this.constructor;if(!this.isFinite()||this.isZero())return new l(this);for(k=!1,(s=this.s*K(this.s*this,1/3))&&Math.abs(s)!=1/0?n=new l(s.toString()):(r=Y(this.d),(s=((t=this.e)-r.length+1)%3)&&(r+=1==s||-2==s?"0":"00"),s=K(r,1/3),t=z((t+1)/3)-(t%3==(t<0?-1:2)),(n=new l(r=s==1/0?"5e"+t:(r=s.toExponential()).slice(0,r.indexOf("e")+1)+t)).s=this.s),o=(t=l.precision)+3;;)if(n=tn((c=(u=(a=n).times(a).times(a)).plus(this)).plus(this).times(a),c.plus(u),o+2,1),Y(a.d).slice(0,o)===(r=Y(n.d)).slice(0,o))if("9999"!=(r=r.slice(o-3,o+1))&&(i||"4999"!=r)){+r&&(+r.slice(1)||"5"!=r.charAt(0))||(ti(n,t+1,1),e=!n.times(n).times(n).eq(this));break}else{if(!i&&(ti(a,t+1,0),a.times(a).times(a).eq(this))){n=a;break}o+=4,i=1}return k=!0,ti(n,t,l.rounding,e)},X.decimalPlaces=X.dp=function(){var t,e=this.d,r=NaN;if(e){if(r=((t=e.length-1)-z(this.e/7))*7,t=e[t])for(;t%10==0;t/=10)r--;r<0&&(r=0)}return r},X.dividedBy=X.div=function(t){return tn(this,new this.constructor(t))},X.dividedToIntegerBy=X.divToInt=function(t){var e=this.constructor;return ti(tn(this,new e(t),0,1,1),e.precision,e.rounding)},X.equals=X.eq=function(t){return 0===this.cmp(t)},X.floor=function(){return ti(new this.constructor(this),this.e+1,3)},X.greaterThan=X.gt=function(t){return this.cmp(t)>0},X.greaterThanOrEqualTo=X.gte=function(t){var e=this.cmp(t);return 1==e||0===e},X.hyperbolicCosine=X.cosh=function(){var t,e,r,n,i,s=this,o=s.constructor,a=new o(1);if(!s.isFinite())return new o(s.s?1/0:NaN);if(s.isZero())return a;r=o.precision,n=o.rounding,o.precision=r+Math.max(s.e,s.sd())+4,o.rounding=1,(i=s.d.length)<32?e=(1/tb(4,t=Math.ceil(i/3))).toString():(t=16,e="2.3283064365386962890625e-10"),s=tv(o,1,s.times(e),new o(1),!0);for(var u,c=t,l=new o(8);c--;)u=s.times(s),s=a.minus(u.times(l.minus(u.times(l))));return ti(s,o.precision=r,o.rounding=n,!0)},X.hyperbolicSine=X.sinh=function(){var t,e,r,n,i=this,s=i.constructor;if(!i.isFinite()||i.isZero())return new s(i);if(e=s.precision,r=s.rounding,s.precision=e+Math.max(i.e,i.sd())+4,s.rounding=1,(n=i.d.length)<3)i=tv(s,2,i,i,!0);else{t=(t=1.4*Math.sqrt(n))>16?16:0|t,i=tv(s,2,i=i.times(1/tb(5,t)),i,!0);for(var o,a=new s(5),u=new s(16),c=new s(20);t--;)o=i.times(i),i=i.times(a.plus(o.times(u.times(o).plus(c))))}return s.precision=e,s.rounding=r,ti(i,e,r,!0)},X.hyperbolicTangent=X.tanh=function(){var t,e,r=this.constructor;return this.isFinite()?this.isZero()?new r(this):(t=r.precision,e=r.rounding,r.precision=t+7,r.rounding=1,tn(this.sinh(),this.cosh(),r.precision=t,r.rounding=e)):new r(this.s)},X.inverseCosine=X.acos=function(){var t=this,e=t.constructor,r=t.abs().cmp(1),n=e.precision,i=e.rounding;return -1!==r?0===r?t.isNeg()?tu(e,n,i):new e(0):new e(NaN):t.isZero()?tu(e,n+4,i).times(.5):(e.precision=n+6,e.rounding=1,t=new e(1).minus(t).div(t.plus(1)).sqrt().atan(),e.precision=n,e.rounding=i,t.times(2))},X.inverseHyperbolicCosine=X.acosh=function(){var t,e,r=this,n=r.constructor;return r.lte(1)?new n(r.eq(1)?0:NaN):r.isFinite()?(t=n.precision,e=n.rounding,n.precision=t+Math.max(Math.abs(r.e),r.sd())+4,n.rounding=1,k=!1,r=r.times(r).minus(1).sqrt().plus(r),k=!0,n.precision=t,n.rounding=e,r.ln()):new n(r)},X.inverseHyperbolicSine=X.asinh=function(){var t,e,r=this,n=r.constructor;return!r.isFinite()||r.isZero()?new n(r):(t=n.precision,e=n.rounding,n.precision=t+2*Math.max(Math.abs(r.e),r.sd())+6,n.rounding=1,k=!1,r=r.times(r).plus(1).sqrt().plus(r),k=!0,n.precision=t,n.rounding=e,r.ln())},X.inverseHyperbolicTangent=X.atanh=function(){var t,e,r,n,i=this,s=i.constructor;return i.isFinite()?i.e>=0?new s(i.abs().eq(1)?i.s/0:i.isZero()?i:NaN):(t=s.precision,e=s.rounding,Math.max(n=i.sd(),t)<-(2*i.e)-1?ti(new s(i),t,e,!0):(s.precision=r=n-i.e,i=tn(i.plus(1),new s(1).minus(i),r+t,1),s.precision=t+4,s.rounding=1,i=i.ln(),s.precision=t,s.rounding=e,i.times(.5))):new s(NaN)},X.inverseSine=X.asin=function(){var t,e,r,n,i=this,s=i.constructor;return i.isZero()?new s(i):(e=i.abs().cmp(1),r=s.precision,n=s.rounding,-1!==e?0===e?((t=tu(s,r+4,n).times(.5)).s=i.s,t):new s(NaN):(s.precision=r+6,s.rounding=1,i=i.div(new s(1).minus(i.times(i)).sqrt().plus(1)).atan(),s.precision=r,s.rounding=n,i.times(2)))},X.inverseTangent=X.atan=function(){var t,e,r,n,i,s,o,a,u,c=this,l=c.constructor,h=l.precision,f=l.rounding;if(c.isFinite()){if(c.isZero())return new l(c);if(c.abs().eq(1)&&h+4<=W)return(o=tu(l,h+4,f).times(.25)).s=c.s,o}else{if(!c.s)return new l(NaN);if(h+4<=W)return(o=tu(l,h+4,f).times(.5)).s=c.s,o}for(l.precision=a=h+10,l.rounding=1,t=r=Math.min(28,a/7+2|0);t;--t)c=c.div(c.times(c).plus(1).sqrt().plus(1));for(k=!1,e=Math.ceil(a/7),n=1,u=c.times(c),o=new l(c),i=c;-1!==t;)if(i=i.times(u),s=o.minus(i.div(n+=2)),i=i.times(u),void 0!==(o=s.plus(i.div(n+=2))).d[e])for(t=e;o.d[t]===s.d[t]&&t--;);return r&&(o=o.times(2<<r-1)),k=!0,ti(o,l.precision=h,l.rounding=f,!0)},X.isFinite=function(){return!!this.d},X.isInteger=X.isInt=function(){return!!this.d&&z(this.e/7)>this.d.length-2},X.isNaN=function(){return!this.s},X.isNegative=X.isNeg=function(){return this.s<0},X.isPositive=X.isPos=function(){return this.s>0},X.isZero=function(){return!!this.d&&0===this.d[0]},X.lessThan=X.lt=function(t){return 0>this.cmp(t)},X.lessThanOrEqualTo=X.lte=function(t){return 1>this.cmp(t)},X.logarithm=X.log=function(t){var e,r,n,i,s,o,a,u=this.constructor,c=u.precision,l=u.rounding;if(null==t)t=new u(10),e=!0;else{if(r=(t=new u(t)).d,t.s<0||!r||!r[0]||t.eq(1))return new u(NaN);e=t.eq(10)}if(r=this.d,this.s<0||!r||!r[0]||this.eq(1))return new u(r&&!r[0]?-1/0:1!=this.s?NaN:r?0:1/0);if(e)if(r.length>1)i=!0;else{for(n=r[0];n%10==0;)n/=10;i=1!==n}if(k=!1,te((a=tn(s=tm(this,o=c+5),e?ta(u,o+10):tm(t,o),o,1)).d,n=c,l))do if(o+=10,a=tn(s=tm(this,o),e?ta(u,o+10):tm(t,o),o,1),!i){+Y(a.d).slice(n+1,n+15)+1==1e14&&(a=ti(a,c+1,0));break}while(te(a.d,n+=10,l));return k=!0,ti(a,c,l)},X.minus=X.sub=function(t){var e,r,n,i,s,o,a,u,c,l,h,f,p=this.constructor;if(t=new p(t),!this.d||!t.d)return this.s&&t.s?this.d?t.s=-t.s:t=new p(t.d||this.s!==t.s?this:NaN):t=new p(NaN),t;if(this.s!=t.s)return t.s=-t.s,this.plus(t);if(c=this.d,f=t.d,a=p.precision,u=p.rounding,!c[0]||!f[0]){if(f[0])t.s=-t.s;else{if(!c[0])return new p(3===u?-0:0);t=new p(this)}return k?ti(t,a,u):t}if(r=z(t.e/7),l=z(this.e/7),c=c.slice(),s=l-r){for((h=s<0)?(e=c,s=-s,o=f.length):(e=f,r=l,o=c.length),s>(n=Math.max(Math.ceil(a/7),o)+2)&&(s=n,e.length=1),e.reverse(),n=s;n--;)e.push(0);e.reverse()}else{for((h=(n=c.length)<(o=f.length))&&(o=n),n=0;n<o;n++)if(c[n]!=f[n]){h=c[n]<f[n];break}s=0}for(h&&(e=c,c=f,f=e,t.s=-t.s),o=c.length,n=f.length-o;n>0;--n)c[o++]=0;for(n=f.length;n>s;){if(c[--n]<f[n]){for(i=n;i&&0===c[--i];)c[i]=1e7-1;--c[i],c[n]+=1e7}c[n]-=f[n]}for(;0===c[--o];)c.pop();for(;0===c[0];c.shift())--r;return c[0]?(t.d=c,t.e=to(c,r),k?ti(t,a,u):t):new p(3===u?-0:0)},X.modulo=X.mod=function(t){var e,r=this.constructor;return t=new r(t),this.d&&t.s&&(!t.d||t.d[0])?t.d&&(!this.d||this.d[0])?(k=!1,9==r.modulo?(e=tn(this,t.abs(),0,3,1),e.s*=t.s):e=tn(this,t,0,r.modulo,1),e=e.times(t),k=!0,this.minus(e)):ti(new r(this),r.precision,r.rounding):new r(NaN)},X.naturalExponential=X.exp=function(){return td(this)},X.naturalLogarithm=X.ln=function(){return tm(this)},X.negated=X.neg=function(){var t=new this.constructor(this);return t.s=-t.s,ti(t)},X.plus=X.add=function(t){var e,r,n,i,s,o,a,u,c,l,h=this.constructor;if(t=new h(t),!this.d||!t.d)return this.s&&t.s?this.d||(t=new h(t.d||this.s===t.s?this:NaN)):t=new h(NaN),t;if(this.s!=t.s)return t.s=-t.s,this.minus(t);if(c=this.d,l=t.d,a=h.precision,u=h.rounding,!c[0]||!l[0])return l[0]||(t=new h(this)),k?ti(t,a,u):t;if(s=z(this.e/7),n=z(t.e/7),c=c.slice(),i=s-n){for(i<0?(r=c,i=-i,o=l.length):(r=l,n=s,o=c.length),i>(o=(s=Math.ceil(a/7))>o?s+1:o+1)&&(i=o,r.length=1),r.reverse();i--;)r.push(0);r.reverse()}for((o=c.length)-(i=l.length)<0&&(i=o,r=l,l=c,c=r),e=0;i;)e=(c[--i]=c[i]+l[i]+e)/1e7|0,c[i]%=1e7;for(e&&(c.unshift(e),++n),o=c.length;0==c[--o];)c.pop();return t.d=c,t.e=to(c,n),k?ti(t,a,u):t},X.precision=X.sd=function(t){var e;if(void 0!==t&&!!t!==t&&1!==t&&0!==t)throw Error(B+t);return this.d?(e=tc(this.d),t&&this.e+1>e&&(e=this.e+1)):e=NaN,e},X.round=function(){var t=this.constructor;return ti(new t(this),this.e+1,t.rounding)},X.sine=X.sin=function(){var t,e,r=this,n=r.constructor;return r.isFinite()?r.isZero()?new n(r):(t=n.precision,e=n.rounding,n.precision=t+Math.max(r.e,r.sd())+7,n.rounding=1,r=function(t,e){var r,n=e.d.length;if(n<3)return e.isZero()?e:tv(t,2,e,e);r=(r=1.4*Math.sqrt(n))>16?16:0|r,e=tv(t,2,e=e.times(1/tb(5,r)),e);for(var i,s=new t(5),o=new t(16),a=new t(20);r--;)i=e.times(e),e=e.times(s.plus(i.times(o.times(i).minus(a))));return e}(n,tw(n,r)),n.precision=t,n.rounding=e,ti(j>2?r.neg():r,t,e,!0)):new n(NaN)},X.squareRoot=X.sqrt=function(){var t,e,r,n,i,s,o=this.d,a=this.e,u=this.s,c=this.constructor;if(1!==u||!o||!o[0])return new c(!u||u<0&&(!o||o[0])?NaN:o?this:1/0);for(k=!1,0==(u=Math.sqrt(+this))||u==1/0?(((e=Y(o)).length+a)%2==0&&(e+="0"),u=Math.sqrt(e),a=z((a+1)/2)-(a<0||a%2),n=new c(e=u==1/0?"5e"+a:(e=u.toExponential()).slice(0,e.indexOf("e")+1)+a)):n=new c(u.toString()),r=(a=c.precision)+3;;)if(n=(s=n).plus(tn(this,s,r+2,1)).times(.5),Y(s.d).slice(0,r)===(e=Y(n.d)).slice(0,r))if("9999"!=(e=e.slice(r-3,r+1))&&(i||"4999"!=e)){+e&&(+e.slice(1)||"5"!=e.charAt(0))||(ti(n,a+1,1),t=!n.times(n).eq(this));break}else{if(!i&&(ti(s,a+1,0),s.times(s).eq(this))){n=s;break}r+=4,i=1}return k=!0,ti(n,a,c.rounding,t)},X.tangent=X.tan=function(){var t,e,r=this,n=r.constructor;return r.isFinite()?r.isZero()?new n(r):(t=n.precision,e=n.rounding,n.precision=t+10,n.rounding=1,(r=r.sin()).s=1,r=tn(r,new n(1).minus(r.times(r)).sqrt(),t+10,0),n.precision=t,n.rounding=e,ti(2==j||4==j?r.neg():r,t,e,!0)):new n(NaN)},X.times=X.mul=function(t){var e,r,n,i,s,o,a,u,c,l=this.constructor,h=this.d,f=(t=new l(t)).d;if(t.s*=this.s,!h||!h[0]||!f||!f[0])return new l(!t.s||h&&!h[0]&&!f||f&&!f[0]&&!h?NaN:!h||!f?t.s/0:0*t.s);for(r=z(this.e/7)+z(t.e/7),(u=h.length)<(c=f.length)&&(s=h,h=f,f=s,o=u,u=c,c=o),s=[],n=o=u+c;n--;)s.push(0);for(n=c;--n>=0;){for(e=0,i=u+n;i>n;)a=s[i]+f[n]*h[i-n-1]+e,s[i--]=a%1e7|0,e=a/1e7|0;s[i]=(s[i]+e)%1e7|0}for(;!s[--o];)s.pop();return e?++r:s.shift(),t.d=s,t.e=to(s,r),k?ti(t,l.precision,l.rounding):t},X.toBinary=function(t,e){return tE(this,2,t,e)},X.toDecimalPlaces=X.toDP=function(t,e){var r=this,n=r.constructor;return r=new n(r),void 0===t?r:(tt(t,0,1e9),void 0===e?e=n.rounding:tt(e,0,8),ti(r,t+r.e+1,e))},X.toExponential=function(t,e){var r,n=this,i=n.constructor;return void 0===t?r=ts(n,!0):(tt(t,0,1e9),void 0===e?e=i.rounding:tt(e,0,8),r=ts(n=ti(new i(n),t+1,e),!0,t+1)),n.isNeg()&&!n.isZero()?"-"+r:r},X.toFixed=function(t,e){var r,n,i=this.constructor;return void 0===t?r=ts(this):(tt(t,0,1e9),void 0===e?e=i.rounding:tt(e,0,8),r=ts(n=ti(new i(this),t+this.e+1,e),!1,t+n.e+1)),this.isNeg()&&!this.isZero()?"-"+r:r},X.toFraction=function(t){var e,r,n,i,s,o,a,u,c,l,h,f,p=this.d,d=this.constructor;if(!p)return new d(this);if(c=r=new d(1),n=u=new d(0),o=(s=(e=new d(n)).e=tc(p)-this.e-1)%7,e.d[0]=K(10,o<0?7+o:o),null==t)t=s>0?e:c;else{if(!(a=new d(t)).isInt()||a.lt(c))throw Error(B+a);t=a.gt(e)?s>0?e:c:a}for(k=!1,a=new d(Y(p)),l=d.precision,d.precision=s=7*p.length*2;h=tn(a,e,0,1,1),1!=(i=r.plus(h.times(n))).cmp(t);)r=n,n=i,i=c,c=u.plus(h.times(i)),u=i,i=e,e=a.minus(h.times(i)),a=i;return i=tn(t.minus(r),n,0,1,1),u=u.plus(i.times(c)),r=r.plus(i.times(n)),u.s=c.s=this.s,f=1>tn(c,n,s,1).minus(this).abs().cmp(tn(u,r,s,1).minus(this).abs())?[c,n]:[u,r],d.precision=l,k=!0,f},X.toHexadecimal=X.toHex=function(t,e){return tE(this,16,t,e)},X.toNearest=function(t,e){var r=this,n=r.constructor;if(r=new n(r),null==t){if(!r.d)return r;t=new n(1),e=n.rounding}else{if(t=new n(t),void 0===e?e=n.rounding:tt(e,0,8),!r.d)return t.s?r:t;if(!t.d)return t.s&&(t.s=r.s),t}return t.d[0]?(k=!1,r=tn(r,t,0,e,1).times(t),k=!0,ti(r)):(t.s=r.s,r=t),r},X.toNumber=function(){return+this},X.toOctal=function(t,e){return tE(this,8,t,e)},X.toPower=X.pow=function(t){var e,r,n,i,s,o,a=this,u=a.constructor,c=+(t=new u(t));if(!a.d||!t.d||!a.d[0]||!t.d[0])return new u(K(+a,c));if((a=new u(a)).eq(1))return a;if(n=u.precision,s=u.rounding,t.eq(1))return ti(a,n,s);if((e=z(t.e/7))>=t.d.length-1&&(r=c<0?-c:c)<=0x1fffffffffffff)return i=th(u,a,r,n),t.s<0?new u(1).div(i):ti(i,n,s);if((o=a.s)<0){if(e<t.d.length-1)return new u(NaN);if((1&t.d[e])==0&&(o=1),0==a.e&&1==a.d[0]&&1==a.d.length)return a.s=o,a}return(e=0!=(r=K(+a,c))&&isFinite(r)?new u(r+"").e:z(c*(Math.log("0."+Y(a.d))/Math.LN10+a.e+1)))>u.maxE+1||e<u.minE-1?new u(e>0?o/0:0):(k=!1,u.rounding=a.s=1,r=Math.min(12,(e+"").length),(i=td(t.times(tm(a,n+r)),n)).d&&te((i=ti(i,n+5,1)).d,n,s)&&(e=n+10,+Y((i=ti(td(t.times(tm(a,e+r)),e),e+5,1)).d).slice(n+1,n+15)+1==1e14&&(i=ti(i,n+1,0))),i.s=o,k=!0,u.rounding=s,ti(i,n,s))},X.toPrecision=function(t,e){var r,n=this,i=n.constructor;return void 0===t?r=ts(n,n.e<=i.toExpNeg||n.e>=i.toExpPos):(tt(t,1,1e9),void 0===e?e=i.rounding:tt(e,0,8),r=ts(n=ti(new i(n),t,e),t<=n.e||n.e<=i.toExpNeg,t)),n.isNeg()&&!n.isZero()?"-"+r:r},X.toSignificantDigits=X.toSD=function(t,e){var r=this.constructor;return void 0===t?(t=r.precision,e=r.rounding):(tt(t,1,1e9),void 0===e?e=r.rounding:tt(e,0,8)),ti(new r(this),t,e)},X.toString=function(){var t=this.constructor,e=ts(this,this.e<=t.toExpNeg||this.e>=t.toExpPos);return this.isNeg()&&!this.isZero()?"-"+e:e},X.truncated=X.trunc=function(){return ti(new this.constructor(this),this.e+1,1)},X.valueOf=X.toJSON=function(){var t=this.constructor,e=ts(this,this.e<=t.toExpNeg||this.e>=t.toExpPos);return this.isNeg()?"-"+e:e};var tn=function(){function t(t,e,r){var n,i=0,s=t.length;for(t=t.slice();s--;)n=t[s]*e+i,t[s]=n%r|0,i=n/r|0;return i&&t.unshift(i),t}function e(t,e,r,n){var i,s;if(r!=n)s=r>n?1:-1;else for(i=s=0;i<r;i++)if(t[i]!=e[i]){s=t[i]>e[i]?1:-1;break}return s}function r(t,e,r,n){for(var i=0;r--;)t[r]-=i,i=+(t[r]<e[r]),t[r]=i*n+t[r]-e[r];for(;!t[0]&&t.length>1;)t.shift()}return function(n,i,s,o,a,u){var c,l,h,f,p,d,m,g,y,v,b,w,E,T,_,S,I,N,x,A,P=n.constructor,O=n.s==i.s?1:-1,U=n.d,j=i.d;if(!U||!U[0]||!j||!j[0])return new P(!n.s||!i.s||(U?j&&U[0]==j[0]:!j)?NaN:U&&0==U[0]||!j?0*O:O/0);for(u?(p=1,l=n.e-i.e):(u=1e7,p=7,l=z(n.e/p)-z(i.e/p)),x=j.length,I=U.length,v=(y=new P(O)).d=[],h=0;j[h]==(U[h]||0);h++);if(j[h]>(U[h]||0)&&l--,null==s?(T=s=P.precision,o=P.rounding):T=a?s+(n.e-i.e)+1:s,T<0)v.push(1),d=!0;else{if(T=T/p+2|0,h=0,1==x){for(f=0,j=j[0],T++;(h<I||f)&&T--;h++)_=f*u+(U[h]||0),v[h]=_/j|0,f=_%j|0;d=f||h<I}else{for((f=u/(j[0]+1)|0)>1&&(j=t(j,f,u),U=t(U,f,u),x=j.length,I=U.length),S=x,w=(b=U.slice(0,x)).length;w<x;)b[w++]=0;(A=j.slice()).unshift(0),N=j[0],j[1]>=u/2&&++N;do f=0,(c=e(j,b,x,w))<0?(E=b[0],x!=w&&(E=E*u+(b[1]||0)),(f=E/N|0)>1?(f>=u&&(f=u-1),g=(m=t(j,f,u)).length,w=b.length,1==(c=e(m,b,g,w))&&(f--,r(m,x<g?A:j,g,u))):(0==f&&(c=f=1),m=j.slice()),(g=m.length)<w&&m.unshift(0),r(b,m,w,u),-1==c&&(w=b.length,(c=e(j,b,x,w))<1&&(f++,r(b,x<w?A:j,w,u))),w=b.length):0===c&&(f++,b=[0]),v[h++]=f,c&&b[0]?b[w++]=U[S]||0:(b=[U[S]],w=1);while((S++<I||void 0!==b[0])&&T--);d=void 0!==b[0]}v[0]||v.shift()}if(1==p)y.e=l,C=d;else{for(h=1,f=v[0];f>=10;f/=10)h++;y.e=h+l*p-1,ti(y,a?s+y.e+1:s,o,d)}return y}}();function ti(t,e,r,n){var i,s,o,a,u,c,l,h,f,p=t.constructor;t:if(null!=e){if(!(h=t.d))return t;for(i=1,a=h[0];a>=10;a/=10)i++;if((s=e-i)<0)s+=7,o=e,u=(l=h[f=0])/K(10,i-o-1)%10|0;else if((f=Math.ceil((s+1)/7))>=(a=h.length))if(n){for(;a++<=f;)h.push(0);l=u=0,i=1,s%=7,o=s-7+1}else break t;else{for(l=a=h[f],i=1;a>=10;a/=10)i++;s%=7,u=(o=s-7+i)<0?0:l/K(10,i-o-1)%10|0}if(n=n||e<0||void 0!==h[f+1]||(o<0?l:l%K(10,i-o-1)),c=r<4?(u||n)&&(0==r||r==(t.s<0?3:2)):u>5||5==u&&(4==r||n||6==r&&(s>0?o>0?l/K(10,i-o):0:h[f-1])%10&1||r==(t.s<0?8:7)),e<1||!h[0])return h.length=0,c?(e-=t.e+1,h[0]=K(10,(7-e%7)%7),t.e=-e||0):h[0]=t.e=0,t;if(0==s?(h.length=f,a=1,f--):(h.length=f+1,a=K(10,7-s),h[f]=o>0?(l/K(10,i-o)%K(10,o)|0)*a:0),c)for(;;)if(0==f){for(s=1,o=h[0];o>=10;o/=10)s++;for(o=h[0]+=a,a=1;o>=10;o/=10)a++;s!=a&&(t.e++,1e7==h[0]&&(h[0]=1));break}else{if(h[f]+=a,1e7!=h[f])break;h[f--]=0,a=1}for(s=h.length;0===h[--s];)h.pop()}return k&&(t.e>p.maxE?(t.d=null,t.e=NaN):t.e<p.minE&&(t.e=0,t.d=[0])),t}function ts(t,e,r){if(!t.isFinite())return tg(t);var n,i=t.e,s=Y(t.d),o=s.length;return e?(r&&(n=r-o)>0?s=s.charAt(0)+"."+s.slice(1)+tl(n):o>1&&(s=s.charAt(0)+"."+s.slice(1)),s=s+(t.e<0?"e":"e+")+t.e):i<0?(s="0."+tl(-i-1)+s,r&&(n=r-o)>0&&(s+=tl(n))):i>=o?(s+=tl(i+1-o),r&&(n=r-i-1)>0&&(s=s+"."+tl(n))):((n=i+1)<o&&(s=s.slice(0,n)+"."+s.slice(n)),r&&(n=r-o)>0&&(i+1===o&&(s+="."),s+=tl(n))),s}function to(t,e){var r=t[0];for(e*=7;r>=10;r/=10)e++;return e}function ta(t,e,r){if(e>Z)throw k=!0,r&&(t.precision=r),Error(G);return ti(new t(M),e,1,!0)}function tu(t,e,r){if(e>W)throw Error(G);return ti(new t(R),e,r,!0)}function tc(t){var e=t.length-1,r=7*e+1;if(e=t[e]){for(;e%10==0;e/=10)r--;for(e=t[0];e>=10;e/=10)r++}return r}function tl(t){for(var e="";t--;)e+="0";return e}function th(t,e,r,n){var i,s=new t(1),o=Math.ceil(n/7+4);for(k=!1;;){if(r%2&&tT((s=s.times(e)).d,o)&&(i=!0),0===(r=z(r/2))){r=s.d.length-1,i&&0===s.d[r]&&++s.d[r];break}tT((e=e.times(e)).d,o)}return k=!0,s}function tf(t){return 1&t.d[t.d.length-1]}function tp(t,e,r){for(var n,i,s=new t(e[0]),o=0;++o<e.length;){if(!(i=new t(e[o])).s){s=i;break}((n=s.cmp(i))===r||0===n&&s.s===r)&&(s=i)}return s}function td(t,e){var r,n,i,s,o,a,u,c=0,l=0,h=0,f=t.constructor,p=f.rounding,d=f.precision;if(!t.d||!t.d[0]||t.e>17)return new f(t.d?t.d[0]?t.s<0?0:1/0:1:t.s?t.s<0?0:t:NaN);for(null==e?(k=!1,u=d):u=e,a=new f(.03125);t.e>-2;)t=t.times(a),h+=5;for(u+=n=Math.log(K(2,h))/Math.LN10*2+5|0,r=s=o=new f(1),f.precision=u;;){if(s=ti(s.times(t),u,1),r=r.times(++l),Y((a=o.plus(tn(s,r,u,1))).d).slice(0,u)===Y(o.d).slice(0,u)){for(i=h;i--;)o=ti(o.times(o),u,1);if(null!=e)return f.precision=d,o;if(!(c<3&&te(o.d,u-n,p,c)))return ti(o,f.precision=d,p,k=!0);f.precision=u+=10,r=s=a=new f(1),l=0,c++}o=a}}function tm(t,e){var r,n,i,s,o,a,u,c,l,h,f,p=1,d=t,m=d.d,g=d.constructor,y=g.rounding,v=g.precision;if(d.s<0||!m||!m[0]||!d.e&&1==m[0]&&1==m.length)return new g(m&&!m[0]?-1/0:1!=d.s?NaN:m?0:d);if(null==e?(k=!1,l=v):l=e,g.precision=l+=10,n=(r=Y(m)).charAt(0),!(15e14>Math.abs(s=d.e)))return c=ta(g,l+2,v).times(s+""),d=tm(new g(n+"."+r.slice(1)),l-10).plus(c),g.precision=v,null==e?ti(d,v,y,k=!0):d;for(;n<7&&1!=n||1==n&&r.charAt(1)>3;)n=(r=Y((d=d.times(t)).d)).charAt(0),p++;for(s=d.e,n>1?(d=new g("0."+r),s++):d=new g(n+"."+r.slice(1)),h=d,u=o=d=tn(d.minus(1),d.plus(1),l,1),f=ti(d.times(d),l,1),i=3;;){if(o=ti(o.times(f),l,1),Y((c=u.plus(tn(o,new g(i),l,1))).d).slice(0,l)===Y(u.d).slice(0,l))if(u=u.times(2),0!==s&&(u=u.plus(ta(g,l+2,v).times(s+""))),u=tn(u,new g(p),l,1),null!=e)return g.precision=v,u;else{if(!te(u.d,l-10,y,a))return ti(u,g.precision=v,y,k=!0);g.precision=l+=10,c=o=d=tn(h.minus(1),h.plus(1),l,1),f=ti(d.times(d),l,1),i=a=1}u=c,i+=2}}function tg(t){return String(t.s*t.s/0)}function ty(t,e){var r,n,i;for((r=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(r<0&&(r=n),r+=+e.slice(n+1),e=e.substring(0,n)):r<0&&(r=e.length),n=0;48===e.charCodeAt(n);n++);for(i=e.length;48===e.charCodeAt(i-1);--i);if(e=e.slice(n,i)){if(i-=n,t.e=r=r-n-1,t.d=[],n=(r+1)%7,r<0&&(n+=7),n<i){for(n&&t.d.push(+e.slice(0,n)),i-=7;n<i;)t.d.push(+e.slice(n,n+=7));n=7-(e=e.slice(n)).length}else n-=i;for(;n--;)e+="0";t.d.push(+e),k&&(t.e>t.constructor.maxE?(t.d=null,t.e=NaN):t.e<t.constructor.minE&&(t.e=0,t.d=[0]))}else t.e=0,t.d=[0];return t}function tv(t,e,r,n,i){var s,o,a,u,c=t.precision,l=Math.ceil(c/7);for(k=!1,u=r.times(r),a=new t(n);;){if(o=tn(a.times(u),new t(e++*e++),c,1),a=i?n.plus(o):n.minus(o),n=tn(o.times(u),new t(e++*e++),c,1),void 0!==(o=a.plus(n)).d[l]){for(s=l;o.d[s]===a.d[s]&&s--;);if(-1==s)break}s=a,a=n,n=o,o=s}return k=!0,o.d.length=l+1,o}function tb(t,e){for(var r=t;--e;)r*=t;return r}function tw(t,e){var r,n=e.s<0,i=tu(t,t.precision,1),s=i.times(.5);if((e=e.abs()).lte(s))return j=n?4:1,e;if((r=e.divToInt(i)).isZero())j=n?3:2;else{if((e=e.minus(r.times(i))).lte(s))return j=tf(r)?n?2:3:n?4:1,e;j=tf(r)?n?1:4:n?3:2}return e.minus(i).abs()}function tE(t,e,r,n){var i,s,o,a,u,c,l,h,f,p=t.constructor,d=void 0!==r;if(d?(tt(r,1,1e9),void 0===n?n=p.rounding:tt(n,0,8)):(r=p.precision,n=p.rounding),t.isFinite()){for(o=(l=ts(t)).indexOf("."),d?(i=2,16==e?r=4*r-3:8==e&&(r=3*r-2)):i=e,o>=0&&(l=l.replace(".",""),(f=new p(1)).e=l.length-o,f.d=tr(ts(f),10,i),f.e=f.d.length),s=u=(h=tr(l,10,i)).length;0==h[--u];)h.pop();if(h[0]){if(o<0?s--:((t=new p(t)).d=h,t.e=s,h=(t=tn(t,f,r,n,0,i)).d,s=t.e,c=C),o=h[r],a=i/2,c=c||void 0!==h[r+1],c=n<4?(void 0!==o||c)&&(0===n||n===(t.s<0?3:2)):o>a||o===a&&(4===n||c||6===n&&1&h[r-1]||n===(t.s<0?8:7)),h.length=r,c)for(;++h[--r]>i-1;)h[r]=0,r||(++s,h.unshift(1));for(u=h.length;!h[u-1];--u);for(o=0,l="";o<u;o++)l+=L.charAt(h[o]);if(d){if(u>1)if(16==e||8==e){for(o=16==e?4:3,--u;u%o;u++)l+="0";for(u=(h=tr(l,i,e)).length;!h[u-1];--u);for(o=1,l="1.";o<u;o++)l+=L.charAt(h[o])}else l=l.charAt(0)+"."+l.slice(1);l=l+(s<0?"p":"p+")+s}else if(s<0){for(;++s;)l="0"+l;l="0."+l}else if(++s>u)for(s-=u;s--;)l+="0";else s<u&&(l=l.slice(0,s)+"."+l.slice(s))}else l=d?"0p+0":"0";l=(16==e?"0x":2==e?"0b":8==e?"0o":"")+l}else l=tg(t);return t.s<0?"-"+l:l}function tT(t,e){if(t.length>e)return t.length=e,!0}function t_(t){return new this(t).abs()}function tS(t){return new this(t).acos()}function tI(t){return new this(t).acosh()}function tN(t,e){return new this(t).plus(e)}function tx(t){return new this(t).asin()}function tA(t){return new this(t).asinh()}function tP(t){return new this(t).atan()}function tO(t){return new this(t).atanh()}function tU(t,e){t=new this(t),e=new this(e);var r,n=this.precision,i=this.rounding,s=n+4;return t.s&&e.s?t.d||e.d?!e.d||t.isZero()?(r=e.s<0?tu(this,n,i):new this(0)).s=t.s:!t.d||e.isZero()?(r=tu(this,s,1).times(.5)).s=t.s:e.s<0?(this.precision=s,this.rounding=1,r=this.atan(tn(t,e,s,1)),e=tu(this,s,1),this.precision=n,this.rounding=i,r=t.s<0?r.minus(e):r.plus(e)):r=this.atan(tn(t,e,s,1)):(r=tu(this,s,1).times(e.s>0?.25:.75)).s=t.s:r=new this(NaN),r}function tC(t){return new this(t).cbrt()}function tj(t){return ti(t=new this(t),t.e+1,2)}function tL(t,e,r){return new this(t).clamp(e,r)}function tM(t){if(!t||"object"!=typeof t)throw Error(D+"Object expected");var e,r,n,i=!0===t.defaults,s=["precision",1,1e9,"rounding",0,8,"toExpNeg",-9e15,0,"toExpPos",0,9e15,"maxE",0,9e15,"minE",-9e15,0,"modulo",0,9];for(e=0;e<s.length;e+=3)if(r=s[e],i&&(this[r]=q[r]),void 0!==(n=t[r]))if(z(n)===n&&n>=s[e+1]&&n<=s[e+2])this[r]=n;else throw Error(B+r+": "+n);if(r="crypto",i&&(this[r]=q[r]),void 0!==(n=t[r]))if(!0===n||!1===n||0===n||1===n)if(n)if("u">typeof crypto&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[r]=!0;else throw Error(F);else this[r]=!1;else throw Error(B+r+": "+n);return this}function tR(t){return new this(t).cos()}function tq(t){return new this(t).cosh()}function tk(t,e){return new this(t).div(e)}function tD(t){return new this(t).exp()}function tB(t){return ti(t=new this(t),t.e+1,3)}function tG(){var t,e,r=new this(0);for(k=!1,t=0;t<arguments.length;)if(e=new this(arguments[t++]),e.d)r.d&&(r=r.plus(e.times(e)));else{if(e.s)return k=!0,new this(1/0);r=e}return k=!0,r.sqrt()}function tF(t){return t instanceof t9||t&&t.toStringTag===J||!1}function tJ(t){return new this(t).ln()}function tz(t,e){return new this(t).log(e)}function tK(t){return new this(t).log(2)}function tV(t){return new this(t).log(10)}function tH(){return tp(this,arguments,-1)}function tQ(){return tp(this,arguments,1)}function t$(t,e){return new this(t).mod(e)}function tZ(t,e){return new this(t).mul(e)}function tW(t,e){return new this(t).pow(e)}function tX(t){var e,r,n,i,s=0,o=new this(1),a=[];if(void 0===t?t=this.precision:tt(t,1,1e9),n=Math.ceil(t/7),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));s<n;)(i=e[s])>=429e7?e[s]=crypto.getRandomValues(new Uint32Array(1))[0]:a[s++]=i%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);s<n;)(i=e[s]+(e[s+1]<<8)+(e[s+2]<<16)+((127&e[s+3])<<24))>=214e7?crypto.randomBytes(4).copy(e,s):(a.push(i%1e7),s+=4);s=n/4}else throw Error(F);else for(;s<n;)a[s++]=1e7*Math.random()|0;for(n=a[--s],t%=7,n&&t&&(i=K(10,7-t),a[s]=(n/i|0)*i);0===a[s];s--)a.pop();if(s<0)r=0,a=[0];else{for(r=-1;0===a[0];r-=7)a.shift();for(n=1,i=a[0];i>=10;i/=10)n++;n<7&&(r-=7-n)}return o.e=r,o.d=a,o}function tY(t){return ti(t=new this(t),t.e+1,this.rounding)}function t0(t){return(t=new this(t)).d?t.d[0]?t.s:0*t.s:t.s||NaN}function t1(t){return new this(t).sin()}function t2(t){return new this(t).sinh()}function t5(t){return new this(t).sqrt()}function t6(t,e){return new this(t).sub(e)}function t3(){var t=0,e=arguments,r=new this(e[0]);for(k=!1;r.s&&++t<e.length;)r=r.plus(e[t]);return k=!0,ti(r,this.precision,this.rounding)}function t8(t){return new this(t).tan()}function t4(t){return new this(t).tanh()}function t7(t){return ti(t=new this(t),t.e+1,1)}X[Symbol.for("nodejs.util.inspect.custom")]=X.toString,X[Symbol.toStringTag]="Decimal";var t9=X.constructor=function t(e){var r,n,i;function s(t){var e,r,n;if(!(this instanceof s))return new s(t);if(this.constructor=s,tF(t)){this.s=t.s,k?!t.d||t.e>s.maxE?(this.e=NaN,this.d=null):t.e<s.minE?(this.e=0,this.d=[0]):(this.e=t.e,this.d=t.d.slice()):(this.e=t.e,this.d=t.d?t.d.slice():t.d);return}if("number"==(n=typeof t)){if(0===t){this.s=1/t<0?-1:1,this.e=0,this.d=[0];return}if(t<0?(t=-t,this.s=-1):this.s=1,t===~~t&&t<1e7){for(e=0,r=t;r>=10;r/=10)e++;k?e>s.maxE?(this.e=NaN,this.d=null):e<s.minE?(this.e=0,this.d=[0]):(this.e=e,this.d=[t]):(this.e=e,this.d=[t]);return}if(0*t!=0){t||(this.s=NaN),this.e=NaN,this.d=null;return}return ty(this,t.toString())}if("string"===n)return 45===(r=t.charCodeAt(0))?(t=t.slice(1),this.s=-1):(43===r&&(t=t.slice(1)),this.s=1),$.test(t)?ty(this,t):function(t,e){var r,n,i,s,o,a,u,c,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),$.test(e))return ty(t,e)}else if("Infinity"===e||"NaN"===e)return+e||(t.s=NaN),t.e=NaN,t.d=null,t;if(H.test(e))r=16,e=e.toLowerCase();else if(V.test(e))r=2;else if(Q.test(e))r=8;else throw Error(B+e);for((s=e.search(/p/i))>0?(u=+e.slice(s+1),e=e.substring(2,s)):e=e.slice(2),o=(s=e.indexOf("."))>=0,n=t.constructor,o&&(s=(a=(e=e.replace(".","")).length)-s,i=th(n,new n(r),s,2*s)),s=l=(c=tr(e,r,1e7)).length-1;0===c[s];--s)c.pop();return s<0?new n(0*t.s):(t.e=to(c,l),t.d=c,k=!1,o&&(t=tn(t,i,4*a)),u&&(t=t.times(54>Math.abs(u)?K(2,u):t9.pow(2,u))),k=!0,t)}(this,t);if("bigint"===n)return t<0?(t=-t,this.s=-1):this.s=1,ty(this,t.toString());throw Error(B+t)}if(s.prototype=X,s.ROUND_UP=0,s.ROUND_DOWN=1,s.ROUND_CEIL=2,s.ROUND_FLOOR=3,s.ROUND_HALF_UP=4,s.ROUND_HALF_DOWN=5,s.ROUND_HALF_EVEN=6,s.ROUND_HALF_CEIL=7,s.ROUND_HALF_FLOOR=8,s.EUCLID=9,s.config=s.set=tM,s.clone=t,s.isDecimal=tF,s.abs=t_,s.acos=tS,s.acosh=tI,s.add=tN,s.asin=tx,s.asinh=tA,s.atan=tP,s.atanh=tO,s.atan2=tU,s.cbrt=tC,s.ceil=tj,s.clamp=tL,s.cos=tR,s.cosh=tq,s.div=tk,s.exp=tD,s.floor=tB,s.hypot=tG,s.ln=tJ,s.log=tz,s.log10=tV,s.log2=tK,s.max=tH,s.min=tQ,s.mod=t$,s.mul=tZ,s.pow=tW,s.random=tX,s.round=tY,s.sign=t0,s.sin=t1,s.sinh=t2,s.sqrt=t5,s.sub=t6,s.sum=t3,s.tan=t8,s.tanh=t4,s.trunc=t7,void 0===e&&(e={}),e&&!0!==e.defaults)for(i=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],r=0;r<i.length;)e.hasOwnProperty(n=i[r++])||(e[n]=this[n]);return s.config(e),s}(q);M=new t9(M),R=new t9(R);var et=t9},5459:(t,e)=>{e.read=function(t,e,r,n,i){var s,o,a=8*i-n-1,u=(1<<a)-1,c=u>>1,l=-7,h=r?i-1:0,f=r?-1:1,p=t[e+h];for(h+=f,s=p&(1<<-l)-1,p>>=-l,l+=a;l>0;s=256*s+t[e+h],h+=f,l-=8);for(o=s&(1<<-l)-1,s>>=-l,l+=n;l>0;o=256*o+t[e+h],h+=f,l-=8);if(0===s)s=1-c;else{if(s===u)return o?NaN:1/0*(p?-1:1);o+=Math.pow(2,n),s-=c}return(p?-1:1)*o*Math.pow(2,s-n)},e.write=function(t,e,r,n,i,s){var o,a,u,c=8*s-i-1,l=(1<<c)-1,h=l>>1,f=5960464477539062e-23*(23===i),p=n?0:s-1,d=n?1:-1,m=+(e<0||0===e&&1/e<0);for(isNaN(e=Math.abs(e))||e===1/0?(a=+!!isNaN(e),o=l):(o=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-o))<1&&(o--,u*=2),o+h>=1?e+=f/u:e+=f*Math.pow(2,1-h),e*u>=2&&(o++,u/=2),o+h>=l?(a=0,o=l):o+h>=1?(a=(e*u-1)*Math.pow(2,i),o+=h):(a=e*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;t[r+p]=255&a,p+=d,a/=256,i-=8);for(o=o<<i|a,c+=i;c>0;t[r+p]=255&o,p+=d,o/=256,c-=8);t[r+p-d]|=128*m}},7383:(t,e,r)=>{"use strict";let n,i;r.d(e,{qG:()=>tS});var s,o,a,u,c=Object.prototype.toString,l=Array.isArray||function(t){return"[object Array]"===c.call(t)};function h(t){return"function"==typeof t}function f(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function p(t,e){return null!=t&&"object"==typeof t&&e in t}var d=RegExp.prototype.test,m=/\S/,g={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},y=/\s*/,v=/\s+/,b=/\s*=/,w=/\s*\}/,E=/#|\^|\/|>|\{|&|=|!/;function T(t){this.string=t,this.tail=t,this.pos=0}function _(t,e){this.view=t,this.cache={".":this.view},this.parent=e}function S(){this.templateCache={_cache:{},set:function(t,e){this._cache[t]=e},get:function(t){return this._cache[t]},clear:function(){this._cache={}}}}T.prototype.eos=function(){return""===this.tail},T.prototype.scan=function(t){var e=this.tail.match(t);if(!e||0!==e.index)return"";var r=e[0];return this.tail=this.tail.substring(r.length),this.pos+=r.length,r},T.prototype.scanUntil=function(t){var e,r=this.tail.search(t);switch(r){case -1:e=this.tail,this.tail="";break;case 0:e="";break;default:e=this.tail.substring(0,r),this.tail=this.tail.substring(r)}return this.pos+=e.length,e},_.prototype.push=function(t){return new _(t,this)},_.prototype.lookup=function(t){var e=this.cache;if(e.hasOwnProperty(t))i=e[t];else{for(var r,n,i,s,o,a,u=this,c=!1;u;){if(t.indexOf(".")>0)for(s=u.view,o=t.split("."),a=0;null!=s&&a<o.length;)a===o.length-1&&(c=p(s,o[a])||(r=s,n=o[a],null!=r&&"object"!=typeof r&&r.hasOwnProperty&&r.hasOwnProperty(n))),s=s[o[a++]];else s=u.view[t],c=p(u.view,t);if(c){i=s;break}u=u.parent}e[t]=i}return h(i)&&(i=i.call(this.view)),i},S.prototype.clearCache=function(){void 0!==this.templateCache&&this.templateCache.clear()},S.prototype.parse=function(t,e){var r=this.templateCache,n=t+":"+(e||I.tags).join(":"),i=void 0!==r,s=i?r.get(n):void 0;return void 0==s&&(s=function(t,e){if(!t)return[];var r,n,i,s,o,a,u,c,h,p=!1,g=[],_=[],S=[],N=!1,x=!1,A="",P=0;function O(){if(N&&!x)for(;S.length;)delete _[S.pop()];else S=[];N=!1,x=!1}function U(t){if("string"==typeof t&&(t=t.split(v,2)),!l(t)||2!==t.length)throw Error("Invalid tags: "+t);r=RegExp(f(t[0])+"\\s*"),n=RegExp("\\s*"+f(t[1])),i=RegExp("\\s*"+f("}"+t[1]))}U(e||I.tags);for(var C=new T(t);!C.eos();){if(s=C.pos,a=C.scanUntil(r))for(var j=0,L=a.length;j<L;++j)!function(t){return!d.call(m,t)}(u=a.charAt(j))?(x=!0,p=!0,A+=" "):(S.push(_.length),A+=u),_.push(["text",u,s,s+1]),s+=1,"\n"===u&&(O(),A="",P=0,p=!1);if(!C.scan(r))break;if(N=!0,o=C.scan(E)||"name",C.scan(y),"="===o?(a=C.scanUntil(b),C.scan(b),C.scanUntil(n)):"{"===o?(a=C.scanUntil(i),C.scan(w),C.scanUntil(n),o="&"):a=C.scanUntil(n),!C.scan(n))throw Error("Unclosed tag at "+C.pos);if(c=">"==o?[o,a,s,C.pos,A,P,p]:[o,a,s,C.pos],P++,_.push(c),"#"===o||"^"===o)g.push(c);else if("/"===o){if(!(h=g.pop()))throw Error('Unopened section "'+a+'" at '+s);if(h[1]!==a)throw Error('Unclosed section "'+h[1]+'" at '+s)}else"name"===o||"{"===o||"&"===o?x=!0:"="===o&&U(a)}if(O(),h=g.pop())throw Error('Unclosed section "'+h[1]+'" at '+C.pos);return function(t){for(var e,r=[],n=r,i=[],s=0,o=t.length;s<o;++s)switch((e=t[s])[0]){case"#":case"^":n.push(e),i.push(e),n=e[4]=[];break;case"/":i.pop()[5]=e[2],n=i.length>0?i[i.length-1][4]:r;break;default:n.push(e)}return r}(function(t){for(var e,r,n=[],i=0,s=t.length;i<s;++i)(e=t[i])&&("text"===e[0]&&r&&"text"===r[0]?(r[1]+=e[1],r[3]=e[3]):(n.push(e),r=e));return n}(_))}(t,e),i&&r.set(n,s)),s},S.prototype.render=function(t,e,r,n){var i=this.getConfigTags(n),s=this.parse(t,i),o=e instanceof _?e:new _(e,void 0);return this.renderTokens(s,o,r,t,n)},S.prototype.renderTokens=function(t,e,r,n,i){for(var s,o,a,u="",c=0,l=t.length;c<l;++c)a=void 0,"#"===(o=(s=t[c])[0])?a=this.renderSection(s,e,r,n,i):"^"===o?a=this.renderInverted(s,e,r,n,i):">"===o?a=this.renderPartial(s,e,r,i):"&"===o?a=this.unescapedValue(s,e):"name"===o?a=this.escapedValue(s,e,i):"text"===o&&(a=this.rawValue(s)),void 0!==a&&(u+=a);return u},S.prototype.renderSection=function(t,e,r,n,i){var s=this,o="",a=e.lookup(t[1]);if(a){if(l(a))for(var u=0,c=a.length;u<c;++u)o+=this.renderTokens(t[4],e.push(a[u]),r,n,i);else if("object"==typeof a||"string"==typeof a||"number"==typeof a)o+=this.renderTokens(t[4],e.push(a),r,n,i);else if(h(a)){if("string"!=typeof n)throw Error("Cannot use higher-order sections without the original template");null!=(a=a.call(e.view,n.slice(t[3],t[5]),function(t){return s.render(t,e,r,i)}))&&(o+=a)}else o+=this.renderTokens(t[4],e,r,n,i);return o}},S.prototype.renderInverted=function(t,e,r,n,i){var s=e.lookup(t[1]);if(!s||l(s)&&0===s.length)return this.renderTokens(t[4],e,r,n,i)},S.prototype.indentPartial=function(t,e,r){for(var n=e.replace(/[^ \t]/g,""),i=t.split("\n"),s=0;s<i.length;s++)i[s].length&&(s>0||!r)&&(i[s]=n+i[s]);return i.join("\n")},S.prototype.renderPartial=function(t,e,r,n){if(r){var i=this.getConfigTags(n),s=h(r)?r(t[1]):r[t[1]];if(null!=s){var o=t[6],a=t[5],u=t[4],c=s;0==a&&u&&(c=this.indentPartial(s,u,o));var l=this.parse(c,i);return this.renderTokens(l,e,r,c,n)}}},S.prototype.unescapedValue=function(t,e){var r=e.lookup(t[1]);if(null!=r)return r},S.prototype.escapedValue=function(t,e,r){var n=this.getConfigEscape(r)||I.escape,i=e.lookup(t[1]);if(null!=i)return"number"==typeof i&&n===I.escape?String(i):n(i)},S.prototype.rawValue=function(t){return t[1]},S.prototype.getConfigTags=function(t){return l(t)?t:t&&"object"==typeof t?t.tags:void 0},S.prototype.getConfigEscape=function(t){return t&&"object"==typeof t&&!l(t)?t.escape:void 0};var I={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(cache){N.templateCache=cache},get templateCache(){return N.templateCache}},N=new S;I.clearCache=function(){return N.clearCache()},I.parse=function(t,e){return N.parse(t,e)},I.render=function(t,e,r,n){if("string"!=typeof t)throw TypeError('Invalid template! Template should be a "string" but "'+(l(t)?"array":typeof t)+'" was given as the first argument for mustache#render(template, view, partials)');return N.render(t,e,r,n)},I.escape=function(t){return String(t).replace(/[&<>"'`=\/]/g,function(t){return g[t]})},I.Scanner=T,I.Context=_,I.Writer=S;var x=r(5704),A=r(1029).hp;class P{on(t,e){return this.events[t]||(this.events[t]=[]),this.events[t].push(e),()=>{this.events[t]=this.events[t].filter(t=>t!==e)}}emit(t,e){for(let r of this.events[t]||[])r(e);for(let r of this.events["*"]||[])r(t,e)}constructor(){this.events={},this.events={}}}class O{get isExpired(){return Date.now()>this._expiry}constructor(t,e){this.value=t,this._expiry=Date.now()+1e3*e}}class U{getIncludingExpired(t){var e;return null!=(e=this._cache.get(t))?e:null}set(t,e,r){let n=null!=r?r:this._defaultTtlSeconds;this._cache.set(t,new O(e,n))}addRefreshingPromise(t,e){this._refreshingKeys.set(t,e),e.then(()=>{this._refreshingKeys.delete(t)}).catch(()=>{this._refreshingKeys.delete(t)})}isRefreshing(t){return this._refreshingKeys.has(t)}invalidate(t){for(let e of(console.log("invalidating",t,this._cache.keys()),this._cache.keys()))e.startsWith(t)&&this._cache.delete(e)}constructor(){this._cache=new Map,this._defaultTtlSeconds=60,this._refreshingKeys=new Map}}!function(t){t.Props="props",t.Queue="queue",t.OptedOut="opted_out"}(o||(o={})),function(t){t.ChatMessage="chatmessage",t.Placeholder="placeholder"}(a||(a={})),I.escape=function(t){return t};class C{_transformToLangchainVariables(t){return this.escapeJsonForLangchain(t).replace(/\{\{(\w+)\}\}/g,"{$1}")}escapeJsonForLangchain(t){let e=[],r=[],n=0,i=t.length;for(;n<i;){let o=t[n];if("{"===o){if(n+1<i&&"{"===t[n+1]){e.push("{{"),n+=2;continue}let s=n+1;for(;s<i&&/\s/.test(t[s]);)s++;let o=s<i&&("'"===t[s]||'"'===t[s]);e.push(o?"{{":"{"),r.push(o),n+=1;continue}if("}"===o){var s;if(n+1<i&&"}"===t[n+1]){e.push("}}"),n+=2;continue}let o=null!=(s=r.pop())&&s;e.push(o?"}}":"}"),n+=1;continue}e.push(o),n+=1}return e.join("")}constructor(t,e=!1,r){this.name=t.name,this.version=t.version,this.config=t.config,this.labels=t.labels,this.tags=t.tags,this.isFallback=e,this.type=r,this.commitMessage=t.commitMessage}}class j extends C{compile(t,e){return I.render(this.promptResponse.prompt,null!=t?t:{})}getLangchainPrompt(t){return this._transformToLangchainVariables(this.prompt)}toJSON(){return JSON.stringify({name:this.name,prompt:this.prompt,version:this.version,isFallback:this.isFallback,tags:this.tags,labels:this.labels,type:this.type,config:this.config})}constructor(t,e=!1){super(t,e,"text"),this.promptResponse=t,this.prompt=t.prompt}}class L extends C{static normalizePrompt(t){return t.map(t=>"type"in t?t:{type:a.ChatMessage,...t})}compile(t,e){let r=[],n=null!=e?e:{};for(let t of this.prompt)if("type"in t&&t.type===a.Placeholder){let e=n[t.name];Array.isArray(e)&&e.length>0&&e.every(t=>"object"==typeof t&&"role"in t&&"content"in t)?r.push(...e):Array.isArray(e)&&0===e.length||(void 0!==e?r.push(JSON.stringify(e)):r.push(t))}else"role"in t&&"content"in t&&t.type===a.ChatMessage&&r.push({role:t.role,content:t.content});return r.map(e=>"object"==typeof e&&null!==e&&"role"in e&&"content"in e?{...e,content:I.render(e.content,null!=t?t:{})}:e)}getLangchainPrompt(t){var e;let r=[],n=null!=(e=null==t?void 0:t.placeholders)?e:{};for(let t of this.prompt)if("type"in t&&t.type===a.Placeholder){let e=n[t.name];Array.isArray(e)&&e.length>0&&e.every(t=>"object"==typeof t&&"role"in t&&"content"in t)?r.push(...e.map(t=>({role:t.role,content:this._transformToLangchainVariables(t.content)}))):Array.isArray(e)&&0===e.length||(void 0!==e?r.push(JSON.stringify(e)):r.push({variableName:t.name,optional:!1}))}else"role"in t&&"content"in t&&t.type===a.ChatMessage&&r.push({role:t.role,content:this._transformToLangchainVariables(t.content)});return r}toJSON(){return JSON.stringify({name:this.name,prompt:this.promptResponse.prompt.map(t=>{if("type"in t&&t.type===a.ChatMessage){let{type:e,...r}=t;return r}return t}),version:this.version,isFallback:this.isFallback,tags:this.tags,labels:this.labels,type:this.type,config:this.config})}constructor(t,e=!1){let r=L.normalizePrompt(t.prompt),n={...t,prompt:r};super(n,e,"chat"),this.promptResponse=n,this.prompt=r}}function M(t){return null==t?void 0:t.replace(/\/+$/,"")}async function R(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,{retryCount:n=3,retryDelay:i=5e3,retryCheck:s=()=>!0}=e,o=null;for(let e=0;e<n+1;e++){e>0&&(await new Promise(t=>setTimeout(t,i)),r("Retrying ".concat(e+1," of ").concat(n+1)));try{return await t()}catch(t){if(o=t,!s(t))throw t;r("Retriable error: ".concat(JSON.stringify(t)))}}throw o}function q(t){let e=new Date().getTime(),r=t&&t.performance&&t.performance.now&&1e3*t.performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){let n=16*Math.random();return e>0?(n=(e+n)%16|0,e=Math.floor(e/16)):(n=(r+n)%16|0,r=Math.floor(r/16)),("x"===t?n:3&n|8).toString(16)})}function k(){return new Date().toISOString()}function D(t,e){let r=setTimeout(t,e);return(null==r?void 0:r.unref)&&(null==r||r.unref()),r}function B(t){return void 0!==x&&x.env[t]?x.env[t]:"undefined"!=typeof globalThis?globalThis[t]:void 0}let G=t=>{let e=new URLSearchParams;return Object.entries(null!=t?t:{}).forEach(t=>{let[r,n]=t;null!=n&&(n instanceof Date?e.append(r,n.toISOString()):e.append(r,n.toString()))}),e.toString()};var F=Object.freeze({__proto__:null,assert:function(t,e){if(!t)throw Error(e)},configLangfuseSDK:function(t){var e;let r=!(arguments.length>1)||void 0===arguments[1]||arguments[1],{publicKey:n,secretKey:i,...s}=null!=t?t:{},o=null!=n?n:B("LANGFUSE_PUBLIC_KEY"),a=r?null!=i?i:B("LANGFUSE_SECRET_KEY"):void 0,u=null!=(e=s.baseUrl)?e:B("LANGFUSE_BASEURL"),c={...s,baseUrl:u};return{publicKey:o,...r?{secretKey:a}:void 0,...c}},currentISOTime:k,currentTimestamp:function(){return new Date().getTime()},encodeQueryParams:G,generateUUID:q,getEnv:B,removeTrailingSlash:M,retriable:R,safeSetTimeout:D});let J=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","TRIGGER_DEPLOYMENT_ID"],z=null,K=null,V=t=>import(t);void 0!==globalThis.Deno?Promise.all([V("node:fs"),V("node:crypto")]).then(t=>{let[e,r]=t;z=e,K=r}).catch():void 0!==x&&(null==(s=x.versions)?void 0:s.node)?Promise.all([V("fs"),V("crypto")]).then(t=>{let[e,r]=t;z=e,K=r}).catch():"undefined"!=typeof crypto&&(K=crypto);class H{readFile(t){try{if(!z)throw Error("File system support is not available in this environment");return z.readFileSync(t)}catch(e){console.error("Error reading file at path ".concat(t),e);return}}parseBase64DataUri(t){try{if(!t||"string"!=typeof t)throw Error("Data URI is not a string");if(!t.startsWith("data:"))throw Error("Data URI does not start with 'data:'");let[e,r]=t.slice(5).split(",",2);if(!e||!r)throw Error("Invalid URI");let n=e.split(";");if(!n.includes("base64"))throw Error("Data is not base64 encoded");let i=n[0];if(!i)throw Error("Content type is empty");return[A.from(r,"base64"),i]}catch(t){return console.error("Error parsing base64 data URI",t),[void 0,void 0]}}get contentLength(){var t;return null==(t=this._contentBytes)?void 0:t.length}get contentSha256Hash(){return this._contentBytes?K?K.createHash("sha256").update(this._contentBytes).digest("base64"):void console.error("Crypto support is not available in this environment"):void 0}toJSON(){return this._contentType&&this._source&&this._mediaId?"@@@langfuseMedia:type=".concat(this._contentType,"|id=").concat(this._mediaId,"|source=").concat(this._source,"@@@"):"<Upload handling failed for LangfuseMedia of type ".concat(this._contentType,">")}static parseReferenceString(t){let e="@@@langfuseMedia:";if(!t.startsWith(e))throw Error("Reference string does not start with '@@@langfuseMedia:type='");if(!t.endsWith("@@@"))throw Error("Reference string does not end with '@@@'");let r=t.slice(e.length,-3).split("|"),n={};for(let t of r){let[e,r]=t.split("=",2);n[e]=r}if(!("type"in n&&"id"in n&&"source"in n))throw Error("Missing required fields in reference string");return{mediaId:n.id,source:n.source,contentType:n.type}}static async resolveMediaReferences(t){let{obj:e,langfuseClient:r,maxDepth:n=10}=t;async function i(t,e){if(e>n)return t;if("string"==typeof t){let e=t.match(/@@@langfuseMedia:.+?@@@/g);if(!e)return t;let n=t,i=new Map;for(let[t,s]of(await Promise.all(e.map(async t=>{try{let e=H.parseReferenceString(t),n=await r.fetchMedia(e.mediaId),s=await r.fetch(n.url,{method:"GET",headers:{}});if(200!==s.status)throw Error("Failed to fetch media content");let o=A.from(await s.arrayBuffer()).toString("base64"),a="data:".concat(n.contentType,";base64,").concat(o);i.set(t,a)}catch(e){console.warn("Error fetching media content for reference string",t,e)}})),i.entries()))n=n.replaceAll(t,s);return n}return Array.isArray(t)?Promise.all(t.map(async t=>await i(t,e+1))):"object"==typeof t&&null!==t?Object.fromEntries(await Promise.all(Object.entries(t).map(async t=>{let[r,n]=t;return[r,await i(n,e+1)]}))):t}return i(e,0)}constructor(t){let{obj:e,base64DataUri:r,contentType:n,contentBytes:i,filePath:s}=t;if(this.obj=e,this._mediaId=void 0,r){let[t,e]=this.parseBase64DataUri(r);this._contentBytes=t,this._contentType=e,this._source="base64_data_uri"}else if(i&&n)this._contentBytes=i,this._contentType=n,this._source="bytes";else if(s&&n){if(!z)throw Error("File system support is not available in this environment");if(!z.existsSync(s))throw Error("File at path ".concat(s," does not exist"));this._contentBytes=this.readFile(s),this._contentType=this._contentBytes?n:void 0,this._source=this._contentBytes?"file":void 0}else console.error("base64DataUri, or contentBytes and contentType, or filePath must be provided to LangfuseMedia")}}let Q=B("LANGFUSE_MAX_EVENT_SIZE_BYTES")?Number(B("LANGFUSE_MAX_EVENT_SIZE_BYTES")):1e6,$=B("LANGFUSE_MAX_BATCH_SIZE_BYTES")?Number(B("LANGFUSE_MAX_BATCH_SIZE_BYTES")):25e5,Z=/^(?!langfuse)[a-z0-9_-]+$/,W=["langfuse-prompt-experiment"];class X extends Error{constructor(t,e){super("HTTP error while fetching Langfuse: "+t.status+" and body: "+e),this.response=t,this.name="LangfuseFetchHttpError"}}class Y extends Error{constructor(t){super("Network error while fetching Langfuse",t instanceof Error?{cause:t}:{}),this.error=t,this.name="LangfuseFetchNetworkError"}}function tt(t){return"object"==typeof t&&"LangfuseFetchHttpError"===t.name}function te(t){return"object"==typeof t&&"LangfuseFetchNetworkError"===t.name}function tr(t){return tt(t)||te(t)}let tn="https://langfuse.com/support",ti="Make sure to keep your SDK updated, refer to ".concat("https://www.npmjs.com/package/langfuse"," for details."),ts="This is an unusual occurrence and we are monitoring it closely. For help, please contact support: ".concat(tn,"."),to="Unexpected error occurred. Please check your request and contact support: ".concat(tn,"."),ta=new Map([[500,"Internal server error occurred. For help, please contact support: ".concat(tn)],[501,"Not implemented. Please check your request and contact support for help: ".concat(tn,".")],[502,"Bad gateway. ".concat(ts)],[503,"Service unavailable. ".concat(ts)],[504,"Gateway timeout. ".concat(ts)],[404,"Internal error occurred. ".concat(ts)],[400,"Bad request. Please check your request for any missing or incorrect parameters. Refer to our API docs: ".concat("https://api.reference.langfuse.com"," for details.")],[401,"Unauthorized. Please check your public/private host settings. Refer to our installation and setup guide: ".concat("https://langfuse.com/docs/sdk/typescript/guide"," for details on SDK configuration.")],[403,"Forbidden. Please check your access control settings. Refer to our RBAC docs: ".concat("https://langfuse.com/docs/rbac"," for details.")],[429,"Rate limit exceeded. For more information on rate limits please see: ".concat("https://langfuse.com/faq/all/api-limits")]]);function tu(t){tt(t)?console.error("[Langfuse SDK]",function(t){if(!t)return"".concat(to," ").concat(ti);let e=ta.get(t)||to;return"".concat(t,": ").concat(e," ").concat(ti)}(t.response.status),"Error details: ".concat(t)):te(t)?console.error("[Langfuse SDK] Network error: ",t):console.error("[Langfuse SDK] Unknown error:",t)}class tc{getSdkIntegration(){return this.sdkIntegration}getCommonEventProperties(){return{$lib:this.getLibraryId(),$lib_version:this.getLibraryVersion()}}on(t,e){return this._events.on(t,e)}debug(){var t;let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];null==(t=this.removeDebugCallback)||t.call(this),this.debugMode=e,e&&(this.removeDebugCallback=this.on("*",(t,e)=>{"error"!==t&&console.log("[Langfuse Debug]",t,JSON.stringify(e))}))}traceStateless(t){let{id:e,timestamp:r,release:n,...i}=t,s=null!=e?e:q(),o={id:s,release:null!=n?n:this.release,timestamp:null!=r?r:new Date,environment:this.environment,...i};return this.enqueue("trace-create",o),s}eventStateless(t){let{id:e,startTime:r,...n}=t,i=null!=e?e:q(),s={id:i,startTime:null!=r?r:new Date,environment:this.environment,...n};return this.enqueue("event-create",s),i}spanStateless(t){let{id:e,startTime:r,...n}=t,i=e||q(),s={id:i,startTime:null!=r?r:new Date,environment:this.environment,...n};return this.enqueue("span-create",s),i}generationStateless(t){let{id:e,startTime:r,prompt:n,...i}=t,s=n&&!n.isFallback?{promptName:n.name,promptVersion:n.version}:{},o=e||q(),a={id:o,startTime:null!=r?r:new Date,environment:this.environment,...s,...i};return this.enqueue("generation-create",a),o}scoreStateless(t){let{id:e,...r}=t,n=e||q(),i={id:n,environment:this.environment,...r};return this.enqueue("score-create",i),n}updateSpanStateless(t){return this.enqueue("span-update",t),t.id}updateGenerationStateless(t){let{prompt:e,...r}=t,n={...e&&!e.isFallback?{promptName:e.name,promptVersion:e.version}:{},...r};return this.enqueue("generation-update",n),t.id}async _getDataset(t){let e=encodeURIComponent(t);return this.fetchAndLogErrors("".concat(this.baseUrl,"/api/public/v2/datasets/").concat(e),this._getFetchOptions({method:"GET"}))}async _getDatasetItems(t){let e=new URLSearchParams;return Object.entries(null!=t?t:{}).forEach(t=>{let[r,n]=t;null!=n&&e.append(r,n.toString())}),this.fetchAndLogErrors("".concat(this.baseUrl,"/api/public/dataset-items?").concat(e),this._getFetchOptions({method:"GET"}))}async _fetchMedia(t){return this.fetchAndLogErrors("".concat(this.baseUrl,"/api/public/media/").concat(t),this._getFetchOptions({method:"GET"}))}async fetchTraces(t){let{data:e,meta:r}=await this.fetchAndLogErrors("".concat(this.baseUrl,"/api/public/traces?").concat(G(t)),this._getFetchOptions({method:"GET"}));return{data:e,meta:r}}async fetchTrace(t){return{data:await this.fetchAndLogErrors("".concat(this.baseUrl,"/api/public/traces/").concat(t),this._getFetchOptions({method:"GET"}))}}async fetchObservations(t){let{data:e,meta:r}=await this.fetchAndLogErrors("".concat(this.baseUrl,"/api/public/observations?").concat(G(t)),this._getFetchOptions({method:"GET"}));return{data:e,meta:r}}async fetchObservation(t){return{data:await this.fetchAndLogErrors("".concat(this.baseUrl,"/api/public/observations/").concat(t),this._getFetchOptions({method:"GET"}))}}async fetchSessions(t){let{data:e,meta:r}=await this.fetchAndLogErrors("".concat(this.baseUrl,"/api/public/sessions?").concat(G(t)),this._getFetchOptions({method:"GET"}));return{data:e,meta:r}}async getDatasetRun(t){let e=encodeURIComponent(t.datasetName),r=encodeURIComponent(t.runName);return this.fetchAndLogErrors("".concat(this.baseUrl,"/api/public/datasets/").concat(e,"/runs/").concat(r),this._getFetchOptions({method:"GET"}))}async getDatasetRuns(t,e){return this.fetchAndLogErrors("".concat(this.baseUrl,"/api/public/datasets/").concat(encodeURIComponent(t),"/runs?").concat(G(e)),this._getFetchOptions({method:"GET"}))}async createDatasetRunItem(t){return this.fetchAndLogErrors("".concat(this.baseUrl,"/api/public/dataset-run-items"),this._getFetchOptions({method:"POST",body:JSON.stringify(t)}))}async createDataset(t){return this.fetchAndLogErrors("".concat(this.baseUrl,"/api/public/datasets"),this._getFetchOptions({method:"POST",body:JSON.stringify("string"==typeof t?{name:t}:t)}))}async createDatasetItem(t){return this.fetchAndLogErrors("".concat(this.baseUrl,"/api/public/dataset-items"),this._getFetchOptions({method:"POST",body:JSON.stringify(t)}))}async getDatasetItem(t){return this.fetchAndLogErrors("".concat(this.baseUrl,"/api/public/dataset-items/").concat(t),this._getFetchOptions({method:"GET"}))}_parsePayload(t){try{return JSON.parse(t)}catch(e){return t}}async createPromptStateless(t){return this.fetchAndLogErrors("".concat(this.baseUrl,"/api/public/v2/prompts"),this._getFetchOptions({method:"POST",body:JSON.stringify(t)}))}async updatePromptStateless(t){return this.fetchAndLogErrors("".concat(this.baseUrl,"/api/public/v2/prompts/").concat(encodeURIComponent(t.name),"/versions/").concat(encodeURIComponent(t.version)),this._getFetchOptions({method:"PATCH",body:JSON.stringify(t)}))}async getPromptStateless(t,e,r,n,i){let s=encodeURIComponent(t),o=new URLSearchParams;if(e&&r)throw Error("Provide either version or label, not both.");e&&o.append("version",e.toString()),r&&o.append("label",r);let a="".concat(this.baseUrl,"/api/public/v2/prompts/").concat(s).concat(o.size?"?"+o:""),u=this._getBoundedMaxRetries({maxRetries:n,defaultMaxRetries:2,maxRetriesUpperBound:4}),c={...this._retryOptions,retryCount:u,retryDelay:500},l=t=>this._events.emit("retry",t+", "+a+", "+JSON.stringify(c));return R(async()=>{let t=await this.fetch(a,this._getFetchOptions({method:"GET",fetchTimeout:null!=i?i:this.requestTimeout})).catch(t=>{if("AbortError"===t.name)throw new Y("Fetch request timed out");throw new Y(t)});if(t.status>=500)throw new X(t,await t.text());let e=await t.json();return{fetchResult:200===t.status?"success":"failure",data:e}},c,l)}_getBoundedMaxRetries(t){var e,r;let n=Math.max(null!=(e=t.defaultMaxRetries)?e:2,0),i=Math.max(null!=(r=t.maxRetriesUpperBound)?r:4,0);return void 0===t.maxRetries?n:Math.min(Math.max(t.maxRetries,0),i)}enqueue(t,e){if(!this.enabled)return;let r=this.parseTraceId(t,e);if(r){var n;if(!(void 0===(n=this.sampleRate)||0!==n&&(n<0||n>1||isNaN(n)?(console.warn("Sample rate must be between 0 and 1. Ignoring setting."),!0):function(t){let e=0;for(let r=0;r<t.length;r++)e=31*e+t.charCodeAt(r)>>>0;return Math.abs(e=(e=((e=(e>>>16^e)*0x45d9f3b)>>>16^e)*0x45d9f3b)>>>16^e)/0x7fffffff}(r)<n)))return void this._events.emit("debug","Event with trace ID ".concat(r," is out of sample. Skipping."))}else this._events.emit("warning","Failed to parse traceID for sampling. Please open a Github issue in https://github.com/langfuse/langfuse/issues/new/choose");let i=this.processEnqueueEvent(t,e),s=q();this.pendingEventProcessingPromises[s]=i,i.catch(t=>{this._events.emit("error",t)}).finally(()=>{delete this.pendingEventProcessingPromises[s]})}async processEnqueueEvent(t,e){this.maskEventBodyInPlace(e),await this.processMediaInEvent(t,e);let r=this.truncateEventBody(e,Q);try{JSON.stringify(r)}catch(e){this._events.emit("error","Event Body for ".concat(t," is not JSON-serializable: ").concat(e));return}let n=this.getPersistedProperty(o.Queue)||[];n.push({id:q(),type:t,timestamp:k(),body:r,metadata:void 0}),this.setPersistedProperty(o.Queue,n),this._events.emit(t,r),n.length>=this.flushAt&&this.flush(),this.flushInterval&&!this._flushTimer&&(this._flushTimer=D(()=>this.flush(),this.flushInterval))}maskEventBodyInPlace(t){if(this.mask){for(let e of["input","output"])if(e in t)try{t[e]=this.mask({data:t[e]})}catch(r){this._events.emit("error","Error masking ".concat(e,": ").concat(r)),t[e]="<fully masked due to failed mask function>"}}}truncateEventBody(t,e){let r=this.getByteSize(t);if(r<=e)return t;this._events.emit("warning","Event Body is too large (".concat(r," bytes) and will be truncated"));let n=["input","output","metadata"].map(e=>({key:e,size:e in t?this.getByteSize(t[e]):0})).sort((t,e)=>e.size-t.size),i={...t},s=r;for(let{key:t,size:r}of n)s>e&&Object.prototype.hasOwnProperty.call(i,t)&&(i={...i,[t]:"<truncated due to size exceeding limit>"},this._events.emit("warning","Truncated ".concat(t," due to total size exceeding limit")),s-=r);return i}getByteSize(t){let e=JSON.stringify(t);return"undefined"!=typeof TextEncoder?new TextEncoder().encode(e).length:encodeURIComponent(e).replace(/%[A-F\d]{2}/g,"U").length}async processMediaInEvent(t,e){if(!e)return;let r=this.parseTraceId(t,e);if(!r)return void this._events.emit("warning","traceId is required for media upload");let n=(t.includes("generation")||t.includes("span"))&&e.id?e.id:void 0;await Promise.all(["input","output","metadata"].map(async t=>{if(e[t]){var i;e[t]=null!=(i=await this.findAndProcessMedia({data:e[t],traceId:r,observationId:n,field:t}).catch(t=>{this._events.emit("error","Error processing multimodal event: ".concat(t))}))?i:e[t]}}))}parseTraceId(t,e){return"traceId"in e?e.traceId:t.includes("trace")?e.id:void 0}async findAndProcessMedia(t){let{data:e,traceId:r,observationId:n,field:i}=t,s=new WeakMap,o=async(t,e)=>{if("string"==typeof t&&t.startsWith("data:")){let e=new H({base64DataUri:t});return await this.processMediaItem({media:e,traceId:r,observationId:n,field:i}),e}if("object"!=typeof t||null===t||s.has(t)||e>10)return t;if(s.set(t,!0),t instanceof H||"[object LangfuseMedia]"===Object.prototype.toString.call(t))return await this.processMediaItem({media:t,traceId:r,observationId:n,field:i}),t;if(Array.isArray(t))return await Promise.all(t.map(t=>o(t,e+1)));if("object"==typeof t&&null!==t){if("input_audio"in t&&"object"==typeof t.input_audio&&"data"in t.input_audio){let e=new H({base64DataUri:"data:audio/".concat(t.input_audio.format||"wav",";base64,").concat(t.input_audio.data)});return await this.processMediaItem({media:e,traceId:r,observationId:n,field:i}),{...t,input_audio:{...t.input_audio,data:e}}}if("audio"in t&&"object"==typeof t.audio&&"data"in t.audio){let e=new H({base64DataUri:"data:audio/".concat(t.audio.format||"wav",";base64,").concat(t.audio.data)});return await this.processMediaItem({media:e,traceId:r,observationId:n,field:i}),{...t,audio:{...t.audio,data:e}}}return Object.fromEntries(await Promise.all(Object.entries(t).map(async t=>{let[r,n]=t;return[r,await o(n,e+1)]})))}return t};return await o(e,1)}async processMediaItem(t){let{media:e,traceId:r,observationId:n,field:i}=t;try{if(!e.contentLength||!e._contentType||!e.contentSha256Hash||!e._contentBytes)return;let t={contentLength:e.contentLength,traceId:r,observationId:n,field:i,contentType:e._contentType,sha256Hash:e.contentSha256Hash},s=await this.fetch("".concat(this.baseUrl,"/api/public/media"),this._getFetchOptions({method:"POST",body:JSON.stringify(t)})),{uploadUrl:o,mediaId:a}=await s.json();if(e._mediaId=a,o){this._events.emit("debug","Uploading media ".concat(a));let t=Date.now(),r=await this.uploadMediaWithBackoff({uploadUrl:o,contentBytes:e._contentBytes,contentType:e._contentType,contentSha256Hash:e.contentSha256Hash,maxRetries:3,baseDelay:1e3});if(!r)throw Error("Media upload process failed");let n={uploadedAt:new Date().toISOString(),uploadHttpStatus:r.status,uploadHttpError:await r.text(),uploadTimeMs:Date.now()-t};await this.fetch("".concat(this.baseUrl,"/api/public/media/").concat(a),this._getFetchOptions({method:"PATCH",body:JSON.stringify(n)})),this._events.emit("debug","Media upload status reported for ".concat(a))}else this._events.emit("debug","Media ".concat(a," already uploaded"))}catch(t){this._events.emit("error","Error processing media item: ".concat(t))}}async uploadMediaWithBackoff(t){let{uploadUrl:e,contentType:r,contentSha256Hash:n,contentBytes:i,maxRetries:s,baseDelay:o}=t;for(let t=0;t<=s;t++)try{let o=await this.fetch(e,{method:"PUT",body:i,headers:{"Content-Type":r,"x-amz-checksum-sha256":n,"x-ms-blob-type":"BlockBlob"}});if(t<s&&200!==o.status&&201!==o.status)throw Error("Upload failed with status ".concat(o.status));return o}catch(n){if(t===s)throw n;let e=o*Math.pow(2,t),r=1e3*Math.random();await new Promise(t=>setTimeout(t,e+r))}}async flushAsync(){return await Promise.all(Object.values(this.pendingEventProcessingPromises)).catch(t=>{tu(t)}),new Promise((t,e)=>{try{this.flush((e,r)=>{e?(tu(e),t()):t(r)})}catch(t){console.error("[Langfuse SDK] Error while flushing Langfuse",t)}})}flush(t){this._flushTimer&&(clearTimeout(this._flushTimer),this._flushTimer=null);let e=this.getPersistedProperty(o.Queue)||[];if(!e.length)return null==t?void 0:t();let r=e.splice(0,this.flushAt),{processedItems:n,remainingItems:i}=this.processQueueItems(r,Q,$);this.setPersistedProperty(o.Queue,[...i,...e]);let s=q(),a=e=>{e&&this._events.emit("warning",e),null==t||t(e,r),this._events.emit("flush",r)};if(this.isLocalEventExportEnabled&&this.projectId){if(this.localEventExportMap.has(this.projectId)){var u;null==(u=this.localEventExportMap.get(this.projectId))||u.push(...r)}else this.localEventExportMap.set(this.projectId,[...r]);a();return}let c=JSON.stringify({batch:n,metadata:{batch_size:n.length,sdk_integration:this.sdkIntegration,sdk_version:this.getLibraryVersion(),sdk_variant:this.getLibraryId(),public_key:this.publicKey,sdk_name:"langfuse-js"}}),l="".concat(this.baseUrl,"/api/public/ingestion"),h=this._getFetchOptions({method:"POST",body:c}),f=this.fetchWithRetry(l,h).then(()=>a()).catch(t=>{a(t)});this.pendingIngestionPromises[s]=f,f.finally(()=>{delete this.pendingIngestionPromises[s]})}processQueueItems(t,e,r){let n=0,i=[],s=[];for(let o=0;o<t.length;o++)try{let a=new Blob([JSON.stringify(t[o])]).size;if(a>e){console.warn("Item exceeds size limit (size: ".concat(a,"), dropping item."));continue}if(n+a>=r){console.debug("hit batch size limit (size: ".concat(n+a,")")),s.push(...t.slice(o)),console.log("Remaining items: ".concat(s.length)),console.log("processes items: ".concat(i.length));break}n+=a,i.push(t[o])}catch(e){this._events.emit("error",e),s.push(...t.slice(o));break}return{processedItems:i,remainingItems:s}}_getFetchOptions(t){return{method:t.method,headers:{"Content-Type":"application/json","X-Langfuse-Sdk-Name":"langfuse-js","X-Langfuse-Sdk-Version":this.getLibraryVersion(),"X-Langfuse-Sdk-Variant":this.getLibraryId(),"X-Langfuse-Sdk-Integration":this.sdkIntegration,"X-Langfuse-Public-Key":this.publicKey,...this.additionalHeaders,...this.constructAuthorizationHeader(this.publicKey,this.secretKey)},body:t.body,...void 0!==t.fetchTimeout?{signal:AbortSignal.timeout(t.fetchTimeout)}:{}}}constructAuthorizationHeader(t,e){return void 0===e?{Authorization:"Bearer "+t}:{Authorization:"Basic "+("function"==typeof btoa?btoa(t+":"+e):A.from(t+":"+e).toString("base64"))}}async fetchWithRetry(t,e,r){var n;return null!=(n=AbortSignal).timeout||(n.timeout=function(t){let e=new AbortController;return setTimeout(()=>e.abort(),t),e.signal}),await R(async()=>{let r=null;try{r=await this.fetch(t,{signal:AbortSignal.timeout(this.requestTimeout),...e})}catch(t){throw new Y(t)}if(r.status<200||r.status>=400){let t=await r.json();throw new X(r,JSON.stringify(t))}let n=await r.json();if(207===r.status&&n.errors.length>0)throw new X(r,JSON.stringify(n.errors));return r},{...this._retryOptions,...r},r=>this._events.emit("retry",r+", "+t+", "+JSON.stringify(e)))}async fetchAndLogErrors(t,e){let r=await this.fetch(t,e),n=429===r.status?await r.text():await r.json();return(r.status<200||r.status>=400)&&tu(new X(r,JSON.stringify(n))),n}async shutdownAsync(){clearTimeout(this._flushTimer);try{await this.flushAsync(),await Promise.all(Object.values(this.pendingIngestionPromises).map(t=>t.catch(()=>{}))),await this.flushAsync()}catch(t){console.error("[Langfuse SDK] Error while shutting down Langfuse",t)}}async _exportLocalEvents(t){if(!this.isLocalEventExportEnabled)return this._events.emit("error","Local event exports are disabled, but _exportLocalEvents() was called."),[];{var e;clearTimeout(this._flushTimer),await this.flushAsync();let r=null!=(e=this.localEventExportMap.get(t))?e:[];return this.localEventExportMap.delete(t),r}}shutdown(){console.warn("shutdown() is deprecated. It does not wait for all events to be processed. Please use shutdownAsync() instead."),this.shutdownAsync()}async awaitAllQueuedAndPendingRequests(){clearTimeout(this._flushTimer),await this.flushAsync(),await Promise.all(Object.values(this.pendingIngestionPromises))}constructor(t){var e,r,n,i,s,o,a,u,c,l;this.additionalHeaders={},this.debugMode=!1,this.pendingEventProcessingPromises={},this.pendingIngestionPromises={},this.localEventExportMap=new Map,this._events=new P;let{publicKey:h,secretKey:f,enabled:p,_projectId:d,_isLocalEventExportEnabled:m,...g}=t;if(this._events.on("error",t=>{console.error("[Langfuse SDK] ".concat("string"==typeof t?t:JSON.stringify(t)))}),this.enabled=!1!==p,this.publicKey=null!=h?h:"",this.secretKey=f,this.baseUrl=M((null==g?void 0:g.baseUrl)||"https://cloud.langfuse.com"),this.additionalHeaders=(null==g?void 0:g.additionalHeaders)||{},this.flushAt=(null==g?void 0:g.flushAt)?Math.max(null==g?void 0:g.flushAt,1):15,this.flushInterval=null!=(e=null==g?void 0:g.flushInterval)?e:1e4,this.release=null!=(i=null!=(n=null!=(r=null==g?void 0:g.release)?r:B("LANGFUSE_RELEASE"))?n:function(){for(let t of J){let e=B(t);if(e)return e}}())?i:void 0,this.mask=null==g?void 0:g.mask,this.sampleRate=null!=(s=null==g?void 0:g.sampleRate)?s:B("LANGFUSE_SAMPLE_RATE")?Number(B("LANGFUSE_SAMPLE_RATE")):void 0,this.sampleRate&&this._events.emit("debug","Langfuse trace sampling enabled with sampleRate ".concat(this.sampleRate,".")),this.environment=null!=(o=null==g?void 0:g.environment)?o:B("LANGFUSE_TRACING_ENVIRONMENT"),this.environment&&!(Z.test(this.environment)||W.includes(this.environment))&&this._events.emit("error","Invalid tracing environment set: ".concat(this.environment," . Environment must match regex ").concat(Z,". Events will be rejected by Langfuse server.")),this._retryOptions={retryCount:null!=(a=null==g?void 0:g.fetchRetryCount)?a:3,retryDelay:null!=(u=null==g?void 0:g.fetchRetryDelay)?u:3e3,retryCheck:tr},this.requestTimeout=null!=(c=null==g?void 0:g.requestTimeout)?c:5e3,this.sdkIntegration=null!=(l=null==g?void 0:g.sdkIntegration)?l:"DEFAULT",this.isLocalEventExportEnabled=null!=m&&m,this.isLocalEventExportEnabled&&!d){this._events.emit("error","Local event export is enabled, but no project ID was provided. Disabling local export."),this.isLocalEventExportEnabled=!1;return}if(!this.isLocalEventExportEnabled&&d){this._events.emit("error","Local event export is disabled, but a project ID was provided. Disabling local export."),this.isLocalEventExportEnabled=!1;return}this.projectId=d}}class tl extends tc{trace(t){let e=this.traceStateless(null!=t?t:{}),r=new tf(this,e);if(B("DEFER")&&t)try{let n=B("__deferRuntime");n&&n.langfuseTraces([{id:e,name:t.name||"",url:r.getTraceUrl()}])}catch(t){}return r}span(t){let e=t.traceId||this.traceStateless({name:t.name});return new td(this,this.spanStateless({...t,traceId:e}),e)}generation(t){let e=t.traceId||this.traceStateless({name:t.name});return new tm(this,this.generationStateless({...t,traceId:e}),e)}event(t){let e=t.traceId||this.traceStateless({name:t.name});return new tg(this,this.eventStateless({...t,traceId:e}),e)}score(t){return this.scoreStateless(t),this}async getDataset(t,e){var r,n,i;let s=await this._getDataset(t),o=[],a=1;for(;;){let n=await this._getDatasetItems({datasetName:t,limit:null!=(r=null==e?void 0:e.fetchItemsPageSize)?r:50,page:a});if(o.push(...n.data),n.meta.totalPages<=a)break;a++}return{...s,description:null!=(n=s.description)?n:void 0,metadata:null!=(i=s.metadata)?i:void 0,items:o.map(t=>({...t,link:async(e,r,n)=>(await this.awaitAllQueuedAndPendingRequests(),await this.createDatasetRunItem({runName:r,datasetItemId:t.id,observationId:e.observationId,traceId:e.traceId,runDescription:null==n?void 0:n.description,metadata:null==n?void 0:n.metadata}))}))}}async createPrompt(t){var e,r;let n=null!=(e=t.labels)?e:[],i="chat"===t.type?await this.createPromptStateless({...t,prompt:t.prompt.map(t=>"type"in t&&t.type===a.Placeholder?{type:a.Placeholder,name:t.name}:{type:a.ChatMessage,...t}),labels:t.isActive?[...new Set([...n,"production"])]:n}):await this.createPromptStateless({...t,type:null!=(r=t.type)?r:"text",labels:t.isActive?[...new Set([...n,"production"])]:n});return"chat"===i.type?new L(i):new j(i)}async updatePrompt(t){let e=await this.updatePromptStateless(t);return this._promptCache.invalidate(t.name),e}async getPrompt(t,e,r){let n=this._getPromptCacheKey({name:t,version:e,label:null==r?void 0:r.label}),i=this._promptCache.getIncludingExpired(n);if(!i||(null==r?void 0:r.cacheTtlSeconds)===0)try{return await this._fetchPromptAndUpdateCache({name:t,version:e,label:null==r?void 0:r.label,cacheTtlSeconds:null==r?void 0:r.cacheTtlSeconds,maxRetries:null==r?void 0:r.maxRetries,fetchTimeout:null==r?void 0:r.fetchTimeoutMs})}catch(n){if(null==r?void 0:r.fallback){let n={name:t,version:null!=e?e:0,labels:r.label?[r.label]:[],cacheTtlSeconds:null==r?void 0:r.cacheTtlSeconds,config:{},tags:[]};if("chat"===r.type)return new L({...n,type:"chat",prompt:r.fallback.map(t=>({type:a.ChatMessage,...t}))},!0);return new j({...n,type:"text",prompt:r.fallback},!0)}throw n}if(i.isExpired&&!this._promptCache.isRefreshing(n)){let i=this._fetchPromptAndUpdateCache({name:t,version:e,label:null==r?void 0:r.label,cacheTtlSeconds:null==r?void 0:r.cacheTtlSeconds,maxRetries:null==r?void 0:r.maxRetries,fetchTimeout:null==r?void 0:r.fetchTimeoutMs}).catch(()=>{console.warn("Failed to refresh prompt cache '".concat(n,"', stale cache will be used until next refresh succeeds."))});this._promptCache.addRefreshingPromise(n,i)}return i.value}_getPromptCacheKey(t){let{name:e,version:r,label:n}=t,i=[e];return void 0!==r?i.push("version:"+r.toString()):void 0!==n?i.push("label:"+n):i.push("label:production"),i.join("-")}async _fetchPromptAndUpdateCache(t){let e=this._getPromptCacheKey(t);try{let n,{name:i,version:s,cacheTtlSeconds:o,label:a,maxRetries:u,fetchTimeout:c}=t,{data:l,fetchResult:h}=await this.getPromptStateless(i,s,a,u,c);if("failure"===h){var r;throw Error(null!=(r=l.message)?r:"Internal error while fetching prompt")}return n="chat"===l.type?new L(l):new j(l),this._promptCache.set(e,n,o),n}catch(t){throw console.error("[Langfuse SDK] Error while fetching prompt '".concat(e,"':"),t),t}}async fetchMedia(t){return await this._fetchMedia(t)}async resolveMediaReferences(t){let{obj:e,...r}=t;return H.resolveMediaReferences({...r,langfuseClient:this,obj:e})}_updateSpan(t){return this.updateSpanStateless(t),this}_updateGeneration(t){return this.updateGenerationStateless(t),this}constructor(t){let{publicKey:e,secretKey:r,enabled:n,_isLocalEventExportEnabled:i}=t,s=!1!==n;i?s=!0:r?e||(s=!1,!1!==n&&console.warn("Langfuse public key was not passed to constructor or not set as 'LANGFUSE_PUBLIC_KEY' environment variable. No observability data will be sent to Langfuse.")):(s=!1,!1!==n&&console.warn("Langfuse secret key was not passed to constructor or not set as 'LANGFUSE_SECRET_KEY' environment variable. No observability data will be sent to Langfuse.")),super({...t,enabled:s}),this._promptCache=new U}}class th{event(t){return this.client.event({...t,traceId:this.traceId,parentObservationId:this.observationId})}span(t){return this.client.span({...t,traceId:this.traceId,parentObservationId:this.observationId})}generation(t){return this.client.generation({...t,traceId:this.traceId,parentObservationId:this.observationId})}score(t){return this.client.score({...t,traceId:this.traceId,observationId:this.observationId}),this}getTraceUrl(){return"".concat(this.client.baseUrl,"/trace/").concat(this.traceId)}constructor({client:t,id:e,traceId:r,observationId:n}){this.client=t,this.id=e,this.traceId=r,this.observationId=n}}class tf extends th{update(t){return this.client.trace({...t,id:this.id}),this}constructor(t,e){super({client:t,id:e,traceId:e,observationId:null})}}class tp extends th{constructor(t,e,r){super({client:t,id:e,traceId:r,observationId:e})}}class td extends tp{update(t){return this.client._updateSpan({...t,id:this.id,traceId:this.traceId}),this}end(t){return this.client._updateSpan({...t,id:this.id,traceId:this.traceId,endTime:new Date}),this}constructor(t,e,r){super(t,e,r)}}class tm extends tp{update(t){return this.client._updateGeneration({...t,id:this.id,traceId:this.traceId}),this}end(t){return this.client._updateGeneration({...t,id:this.id,traceId:this.traceId,endTime:new Date}),this}constructor(t,e,r){super(t,e,r)}}class tg extends tp{constructor(t,e,r){super(t,e,r)}}let ty={getItem(t){try{let e=t+"=",r=document.cookie.split(";");for(let t=0;t<r.length;t++){let n=r[t];for(;" "==n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(e))return decodeURIComponent(n.substring(e.length,n.length))}}catch(t){}return null},setItem(t,e){try{let r=t+"="+encodeURIComponent(e)+"; path=/";document.cookie=r}catch(t){return}},removeItem(t){try{ty.setItem(t,"")}catch(t){return}},clear(){document.cookie=""},getAllKeys(){let t=document.cookie.split(";"),e=[];for(let r=0;r<t.length;r++){let n=t[r];for(;" "==n.charAt(0);)n=n.substring(1,n.length);e.push(n.split("=")[0])}return e}},tv=t=>({getItem:e=>t.getItem(e),setItem(e,r){t.setItem(e,r)},removeItem(e){t.removeItem(e)},clear(){t.clear()},getAllKeys(){let t=[];for(let e in localStorage)t.push(e);return t}}),tb=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"__mplssupport__";if(!window)return!1;try{if(t.setItem(e,"xyz"),"xyz"!==t.getItem(e))return!1;return t.removeItem(e),!0}catch(t){return!1}},tw=()=>{let t={};return{getItem:e=>t[e],setItem(e,r){t[e]=null!==r?r:void 0},removeItem(e){delete t[e]},clear(){for(let e in t)delete t[e]},getAllKeys(){let e=[];for(let r in t)e.push(r);return e}}},tE=(t,e)=>{if(e){if(!localStorage){let t=tv(e.localStorage);n=tb(t)?t:void 0}if(!i){let t=tv(e.sessionStorage);i=tb(t)?t:void 0}}switch(t){case"cookie":return ty||n||i||tw();case"localStorage":return n||i||tw();case"sessionStorage":return i||tw();default:return tw()}};!function(t){t.Json="application/json",t.FormData="multipart/form-data",t.UrlEncoded="application/x-www-form-urlencoded",t.Text="text/plain"}(u||(u={}));class tT{encodeQueryParam(t,e){let r=encodeURIComponent(t);return"".concat(r,"=").concat(encodeURIComponent("number"==typeof e?e:"".concat(e)))}addQueryParam(t,e){return this.encodeQueryParam(e,t[e])}addArrayQueryParam(t,e){return t[e].map(t=>this.encodeQueryParam(e,t)).join("&")}toQueryString(t){let e=t||{};return Object.keys(e).filter(t=>void 0!==e[t]).map(t=>Array.isArray(e[t])?this.addArrayQueryParam(e,t):this.addQueryParam(e,t)).join("&")}addQueryParams(t){let e=this.toQueryString(t);return e?"?".concat(e):""}mergeRequestParams(t,e){return{...this.baseApiParams,...t,...e||{},headers:{...this.baseApiParams.headers||{},...t.headers||{},...e&&e.headers||{}}}}constructor(t={}){this.baseUrl="",this.securityData=null,this.abortControllers=new Map,this.customFetch=function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return fetch(...e)},this.baseApiParams={credentials:"same-origin",headers:{},redirect:"follow",referrerPolicy:"no-referrer"},this.setSecurityData=t=>{this.securityData=t},this.contentFormatters={[u.Json]:t=>null!==t&&("object"==typeof t||"string"==typeof t)?JSON.stringify(t):t,[u.Text]:t=>null!==t&&"string"!=typeof t?JSON.stringify(t):t,[u.FormData]:t=>Object.keys(t||{}).reduce((e,r)=>{let n=t[r];return e.append(r,n instanceof Blob?n:"object"==typeof n&&null!==n?JSON.stringify(n):"".concat(n)),e},new FormData),[u.UrlEncoded]:t=>this.toQueryString(t)},this.createAbortSignal=t=>{if(this.abortControllers.has(t)){let e=this.abortControllers.get(t);return e?e.signal:void 0}let e=new AbortController;return this.abortControllers.set(t,e),e.signal},this.abortRequest=t=>{let e=this.abortControllers.get(t);e&&(e.abort(),this.abortControllers.delete(t))},this.request=async t=>{let{body:e,secure:r,path:n,type:i,query:s,format:o,baseUrl:a,cancelToken:c,...l}=t,h=("boolean"==typeof r?r:this.baseApiParams.secure)&&this.securityWorker&&await this.securityWorker(this.securityData)||{},f=this.mergeRequestParams(l,h),p=s&&this.toQueryString(s),d=this.contentFormatters[i||u.Json],m=o||f.format;return this.customFetch("".concat(a||this.baseUrl||"").concat(n).concat(p?"?".concat(p):""),{...f,headers:{...f.headers||{},...i&&i!==u.FormData?{"Content-Type":i}:{}},signal:(c?this.createAbortSignal(c):f.signal)||null,body:null==e?null:d(e)}).then(async t=>{let e=t.clone();e.data=null,e.error=null;let r=m?await t[m]().then(t=>(e.ok?e.data=t:e.error=t,e)).catch(t=>(e.error=t,e)):e;if(c&&this.abortControllers.delete(c),!t.ok)throw r;return r.data})},Object.assign(this,t)}}class t_ extends tT{constructor(){var t;super(...arguments),t=this,this.api={annotationQueuesCreateQueueItem:function(e,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return t.request({path:"/api/public/annotation-queues/".concat(e,"/items"),method:"POST",body:r,secure:!0,type:u.Json,format:"json",...n})},annotationQueuesDeleteQueueItem:function(e,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return t.request({path:"/api/public/annotation-queues/".concat(e,"/items/").concat(r),method:"DELETE",secure:!0,format:"json",...n})},annotationQueuesGetQueue:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/annotation-queues/".concat(e),method:"GET",secure:!0,format:"json",...r})},annotationQueuesGetQueueItem:function(e,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return t.request({path:"/api/public/annotation-queues/".concat(e,"/items/").concat(r),method:"GET",secure:!0,format:"json",...n})},annotationQueuesListQueueItems:function(e){let{queueId:r,...n}=e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/annotation-queues/".concat(r,"/items"),method:"GET",query:n,secure:!0,format:"json",...i})},annotationQueuesListQueues:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/annotation-queues",method:"GET",query:e,secure:!0,format:"json",...r})},annotationQueuesUpdateQueueItem:function(e,r,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return t.request({path:"/api/public/annotation-queues/".concat(e,"/items/").concat(r),method:"PATCH",body:n,secure:!0,type:u.Json,format:"json",...i})},commentsCreate:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/comments",method:"POST",body:e,secure:!0,type:u.Json,format:"json",...r})},commentsGet:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/comments",method:"GET",query:e,secure:!0,format:"json",...r})},commentsGetById:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/comments/".concat(e),method:"GET",secure:!0,format:"json",...r})},datasetItemsCreate:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/dataset-items",method:"POST",body:e,secure:!0,type:u.Json,format:"json",...r})},datasetItemsDelete:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/dataset-items/".concat(e),method:"DELETE",secure:!0,format:"json",...r})},datasetItemsGet:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/dataset-items/".concat(e),method:"GET",secure:!0,format:"json",...r})},datasetItemsList:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/dataset-items",method:"GET",query:e,secure:!0,format:"json",...r})},datasetRunItemsCreate:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/dataset-run-items",method:"POST",body:e,secure:!0,type:u.Json,format:"json",...r})},datasetRunItemsList:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/dataset-run-items",method:"GET",query:e,secure:!0,...r})},datasetsCreate:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/v2/datasets",method:"POST",body:e,secure:!0,type:u.Json,format:"json",...r})},datasetsDeleteRun:function(e,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return t.request({path:"/api/public/datasets/".concat(e,"/runs/").concat(r),method:"DELETE",secure:!0,format:"json",...n})},datasetsGet:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/v2/datasets/".concat(e),method:"GET",secure:!0,format:"json",...r})},datasetsGetRun:function(e,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return t.request({path:"/api/public/datasets/".concat(e,"/runs/").concat(r),method:"GET",secure:!0,format:"json",...n})},datasetsGetRuns:function(e){let{datasetName:r,...n}=e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/datasets/".concat(r,"/runs"),method:"GET",query:n,secure:!0,format:"json",...i})},datasetsList:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/v2/datasets",method:"GET",query:e,secure:!0,format:"json",...r})},healthHealth:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.request({path:"/api/public/health",method:"GET",format:"json",...e})},ingestionBatch:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/ingestion",method:"POST",body:e,secure:!0,type:u.Json,format:"json",...r})},mediaGet:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/media/".concat(e),method:"GET",secure:!0,format:"json",...r})},mediaGetUploadUrl:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/media",method:"POST",body:e,secure:!0,type:u.Json,format:"json",...r})},mediaPatch:function(e,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return t.request({path:"/api/public/media/".concat(e),method:"PATCH",body:r,secure:!0,type:u.Json,...n})},metricsMetrics:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/metrics",method:"GET",query:e,secure:!0,format:"json",...r})},modelsCreate:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/models",method:"POST",body:e,secure:!0,type:u.Json,format:"json",...r})},modelsDelete:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/models/".concat(e),method:"DELETE",secure:!0,...r})},modelsGet:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/models/".concat(e),method:"GET",secure:!0,format:"json",...r})},modelsList:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/models",method:"GET",query:e,secure:!0,format:"json",...r})},observationsGet:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/observations/".concat(e),method:"GET",secure:!0,format:"json",...r})},observationsGetMany:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/observations",method:"GET",query:e,secure:!0,format:"json",...r})},organizationsGetOrganizationMemberships:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.request({path:"/api/public/organizations/memberships",method:"GET",secure:!0,format:"json",...e})},organizationsGetOrganizationProjects:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.request({path:"/api/public/organizations/projects",method:"GET",secure:!0,format:"json",...e})},organizationsGetProjectMemberships:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/projects/".concat(e,"/memberships"),method:"GET",secure:!0,format:"json",...r})},organizationsUpdateOrganizationMembership:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/organizations/memberships",method:"PUT",body:e,secure:!0,type:u.Json,format:"json",...r})},organizationsUpdateProjectMembership:function(e,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return t.request({path:"/api/public/projects/".concat(e,"/memberships"),method:"PUT",body:r,secure:!0,type:u.Json,format:"json",...n})},projectsCreate:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/projects",method:"POST",body:e,secure:!0,type:u.Json,format:"json",...r})},projectsCreateApiKey:function(e,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return t.request({path:"/api/public/projects/".concat(e,"/apiKeys"),method:"POST",body:r,secure:!0,type:u.Json,format:"json",...n})},projectsDelete:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/projects/".concat(e),method:"DELETE",secure:!0,format:"json",...r})},projectsDeleteApiKey:function(e,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return t.request({path:"/api/public/projects/".concat(e,"/apiKeys/").concat(r),method:"DELETE",secure:!0,format:"json",...n})},projectsGet:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.request({path:"/api/public/projects",method:"GET",secure:!0,format:"json",...e})},projectsGetApiKeys:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/projects/".concat(e,"/apiKeys"),method:"GET",secure:!0,format:"json",...r})},projectsUpdate:function(e,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return t.request({path:"/api/public/projects/".concat(e),method:"PUT",body:r,secure:!0,type:u.Json,format:"json",...n})},promptsCreate:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/v2/prompts",method:"POST",body:e,secure:!0,type:u.Json,format:"json",...r})},promptsGet:function(e){let{promptName:r,...n}=e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/v2/prompts/".concat(r),method:"GET",query:n,secure:!0,format:"json",...i})},promptsList:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/v2/prompts",method:"GET",query:e,secure:!0,format:"json",...r})},promptVersionUpdate:function(e,r,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return t.request({path:"/api/public/v2/prompts/".concat(e,"/versions/").concat(r),method:"PATCH",body:n,secure:!0,type:u.Json,format:"json",...i})},scimCreateUser:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/scim/Users",method:"POST",body:e,secure:!0,type:u.Json,format:"json",...r})},scimDeleteUser:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/scim/Users/".concat(e),method:"DELETE",secure:!0,format:"json",...r})},scimGetResourceTypes:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.request({path:"/api/public/scim/ResourceTypes",method:"GET",secure:!0,format:"json",...e})},scimGetSchemas:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.request({path:"/api/public/scim/Schemas",method:"GET",secure:!0,format:"json",...e})},scimGetServiceProviderConfig:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.request({path:"/api/public/scim/ServiceProviderConfig",method:"GET",secure:!0,format:"json",...e})},scimGetUser:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/scim/Users/".concat(e),method:"GET",secure:!0,format:"json",...r})},scimListUsers:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/scim/Users",method:"GET",query:e,secure:!0,format:"json",...r})},scoreConfigsCreate:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/score-configs",method:"POST",body:e,secure:!0,type:u.Json,format:"json",...r})},scoreConfigsGet:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/score-configs",method:"GET",query:e,secure:!0,format:"json",...r})},scoreConfigsGetById:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/score-configs/".concat(e),method:"GET",secure:!0,format:"json",...r})},scoreCreate:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/scores",method:"POST",body:e,secure:!0,type:u.Json,format:"json",...r})},scoreDelete:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/scores/".concat(e),method:"DELETE",secure:!0,...r})},scoreV2Get:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/v2/scores",method:"GET",query:e,secure:!0,format:"json",...r})},scoreV2GetById:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/v2/scores/".concat(e),method:"GET",secure:!0,format:"json",...r})},sessionsGet:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/sessions/".concat(e),method:"GET",secure:!0,format:"json",...r})},sessionsList:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/sessions",method:"GET",query:e,secure:!0,format:"json",...r})},traceDelete:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/traces/".concat(e),method:"DELETE",secure:!0,format:"json",...r})},traceDeleteMultiple:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/traces",method:"DELETE",body:e,secure:!0,type:u.Json,format:"json",...r})},traceGet:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/traces/".concat(e),method:"GET",secure:!0,format:"json",...r})},traceList:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.request({path:"/api/public/traces",method:"GET",query:e,secure:!0,format:"json",...r})}}}}class tS extends tl{getPersistedProperty(t){return this._storageCache||(this._storageCache=JSON.parse(this._storage.getItem(this._storageKey)||"{}")||{}),this._storageCache[t]}setPersistedProperty(t,e){this._storageCache||(this._storageCache=JSON.parse(this._storage.getItem(this._storageKey)||"{}")||{}),null===e?delete this._storageCache[t]:this._storageCache[t]=e,this._storage.setItem(this._storageKey,JSON.stringify(this._storageCache))}fetch(t,e){return fetch(t,e)}getLibraryId(){return"langfuse"}getLibraryVersion(){return"3.38.4"}getCustomUserAgent(){}constructor(t){let e=F.configLangfuseSDK(t);super(e),"undefined"!=typeof window&&"Deno"in window==!1?(this._storageKey=(null==t?void 0:t.persistence_name)?"lf_".concat(t.persistence_name):"lf_".concat(e.publicKey,"_langfuse"),this._storage=tE((null==t?void 0:t.persistence)||"localStorage",window)):(this._storageKey="lf_".concat(e.publicKey,"_langfuse"),this._storage=tE("memory",void 0)),this.api=new t_({baseUrl:this.baseUrl,baseApiParams:{headers:{"X-Langfuse-Sdk-Name":"langfuse-js","X-Langfuse-Sdk-Version":this.getLibraryVersion(),"X-Langfuse-Sdk-Variant":this.getLibraryId(),"X-Langfuse-Sdk-Integration":this.sdkIntegration,"X-Langfuse-Public-Key":this.publicKey,...this.additionalHeaders,...this.constructAuthorizationHeader(this.publicKey,this.secretKey)}}}).api}}class tI{static getInstance(t){return tI.instance||(tI.instance=new tS(t)),tI.instance}}tI.instance=null;t=>{if("prompt_tokens"in t){let{prompt_tokens:e,completion_tokens:r,total_tokens:n,completion_tokens_details:i,prompt_tokens_details:s}=t;return{input:e,output:r,total:n,...Object.fromEntries(Object.entries(null!=s?s:{}).map(t=>{let[e,r]=t;return["input_".concat(e),r]})),...Object.fromEntries(Object.entries(null!=i?i:{}).map(t=>{let[e,r]=t;return["output_".concat(e),r]}))}}if("input_tokens"in t){let{input_tokens:e,output_tokens:r,total_tokens:n,input_tokens_details:i,output_tokens_details:s}=t;return{input:e,output:r,total:n,...Object.fromEntries(Object.entries(null!=i?i:{}).map(t=>{let[e,r]=t;return["input_".concat(e),r]})),...Object.fromEntries(Object.entries(null!=s?s:{}).map(t=>{let[e,r]=t;return["output_".concat(e),r]}))}}}},9072:(t,e,r)=>{t.exports=r(9570)},9570:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0});let{Decimal:n,objectEnumValues:i,makeStrictEnum:s,Public:o,getRuntime:a,skip:u}=r(2215),c={};e.Prisma=c,e.$Enums={},c.prismaVersion={client:"6.16.3",engine:"bb420e667c1820a8c05a38023385f6cc7ef8e83a"},c.PrismaClientKnownRequestError=()=>{let t=a().prettyName;throw Error(`PrismaClientKnownRequestError is unable to run in this browser environment, or has been bundled for the browser (running in ${t}).
In case this error is unexpected for you, please report it in https://pris.ly/prisma-prisma-bug-report`)},c.PrismaClientUnknownRequestError=()=>{let t=a().prettyName;throw Error(`PrismaClientUnknownRequestError is unable to run in this browser environment, or has been bundled for the browser (running in ${t}).
In case this error is unexpected for you, please report it in https://pris.ly/prisma-prisma-bug-report`)},c.PrismaClientRustPanicError=()=>{let t=a().prettyName;throw Error(`PrismaClientRustPanicError is unable to run in this browser environment, or has been bundled for the browser (running in ${t}).
In case this error is unexpected for you, please report it in https://pris.ly/prisma-prisma-bug-report`)},c.PrismaClientInitializationError=()=>{let t=a().prettyName;throw Error(`PrismaClientInitializationError is unable to run in this browser environment, or has been bundled for the browser (running in ${t}).
In case this error is unexpected for you, please report it in https://pris.ly/prisma-prisma-bug-report`)},c.PrismaClientValidationError=()=>{let t=a().prettyName;throw Error(`PrismaClientValidationError is unable to run in this browser environment, or has been bundled for the browser (running in ${t}).
In case this error is unexpected for you, please report it in https://pris.ly/prisma-prisma-bug-report`)},c.Decimal=n,c.sql=()=>{let t=a().prettyName;throw Error(`sqltag is unable to run in this browser environment, or has been bundled for the browser (running in ${t}).
In case this error is unexpected for you, please report it in https://pris.ly/prisma-prisma-bug-report`)},c.empty=()=>{let t=a().prettyName;throw Error(`empty is unable to run in this browser environment, or has been bundled for the browser (running in ${t}).
In case this error is unexpected for you, please report it in https://pris.ly/prisma-prisma-bug-report`)},c.join=()=>{let t=a().prettyName;throw Error(`join is unable to run in this browser environment, or has been bundled for the browser (running in ${t}).
In case this error is unexpected for you, please report it in https://pris.ly/prisma-prisma-bug-report`)},c.raw=()=>{let t=a().prettyName;throw Error(`raw is unable to run in this browser environment, or has been bundled for the browser (running in ${t}).
In case this error is unexpected for you, please report it in https://pris.ly/prisma-prisma-bug-report`)},c.validator=o.validator,c.getExtensionContext=()=>{let t=a().prettyName;throw Error(`Extensions.getExtensionContext is unable to run in this browser environment, or has been bundled for the browser (running in ${t}).
In case this error is unexpected for you, please report it in https://pris.ly/prisma-prisma-bug-report`)},c.defineExtension=()=>{let t=a().prettyName;throw Error(`Extensions.defineExtension is unable to run in this browser environment, or has been bundled for the browser (running in ${t}).
In case this error is unexpected for you, please report it in https://pris.ly/prisma-prisma-bug-report`)},c.DbNull=i.instances.DbNull,c.JsonNull=i.instances.JsonNull,c.AnyNull=i.instances.AnyNull,c.NullTypes={DbNull:i.classes.DbNull,JsonNull:i.classes.JsonNull,AnyNull:i.classes.AnyNull},e.Prisma.TransactionIsolationLevel=s({Serializable:"Serializable"}),e.Prisma.CharacterScalarFieldEnum={id:"id",system:"system",prompt:"prompt",character:"character",isNpc:"isNpc",createdAt:"createdAt",updatedAt:"updatedAt"},e.Prisma.SortOrder={asc:"asc",desc:"desc"},e.Prisma.JsonNullValueInput={JsonNull:c.JsonNull},e.Prisma.JsonNullValueFilter={DbNull:c.DbNull,JsonNull:c.JsonNull,AnyNull:c.AnyNull},e.Prisma.QueryMode={default:"default",insensitive:"insensitive"},e.Prisma.ModelName={Character:"Character"};class l{constructor(){return new Proxy(this,{get(t,e){let r=a();throw Error((r.isEdge?`PrismaClient is not configured to run in ${r.prettyName}. In order to run Prisma Client on edge runtime, either:
- Use Prisma Accelerate: https://pris.ly/d/accelerate
- Use Driver Adapters: https://pris.ly/d/driver-adapters
`:"PrismaClient is unable to run in this browser environment, or has been bundled for the browser (running in `"+r.prettyName+"`).")+`
If this is unexpected, please open an issue: https://pris.ly/prisma-prisma-bug-report`)}})}}e.PrismaClient=l,Object.assign(e,c)}}]);