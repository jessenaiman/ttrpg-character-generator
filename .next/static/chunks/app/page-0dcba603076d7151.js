(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2679:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>ec});var r,s=a(5155),n=a(2115),c=function(e){return e.DND5E="dnd5e",e.PF2E="pf2e",e.BLADES="blades",e}({}),i=a(9072);let o=null!=(r=globalThis.prisma)?r:new i.PrismaClient({log:["query"]});class l{static async getAllCharacters(){try{return await o.character.findMany({orderBy:{createdAt:"desc"}})}catch(e){throw console.error("Error fetching characters:",e),e}}static async getCharactersBySystem(e){try{return await o.character.findMany({where:{system:e},orderBy:{createdAt:"desc"}})}catch(e){throw console.error("Error fetching characters by system:",e),e}}static async getCharactersByNpcStatus(e){try{return await o.character.findMany({where:{isNpc:e},orderBy:{createdAt:"desc"}})}catch(e){throw console.error("Error fetching characters by NPC status:",e),e}}static async getCharacterById(e){try{return await o.character.findUnique({where:{id:e}})}catch(e){throw console.error("Error fetching character by ID:",e),e}}static async addCharacter(e){try{return await o.character.create({data:e})}catch(e){throw console.error("Error adding character:",e),e}}static async updateCharacter(e,t){try{return await o.character.update({where:{id:e},data:t})}catch(e){throw console.error("Error updating character:",e),e}}static async deleteCharacter(e){try{await o.character.delete({where:{id:e}})}catch(e){throw console.error("Error deleting character:",e),e}}static async searchCharacters(e){try{return await o.character.findMany({where:{OR:[{prompt:{contains:e,mode:"insensitive"}},{character:{path:["name"],string_contains:e}}]},orderBy:{createdAt:"desc"}})}catch(e){throw console.error("Error searching characters:",e),e}}static async getCharacterCount(){try{return await o.character.count()}catch(e){throw console.error("Error getting character count:",e),e}}static async clearAllCharacters(){try{await o.character.deleteMany()}catch(e){throw console.error("Error clearing all characters:",e),e}}}var d=a(2014),h=a(5704);if(!h.env.API_KEY)throw Error("API_KEY environment variable not set");let m=new d.M4({apiKey:h.env.API_KEY}),p={type:d.ZU.OBJECT,properties:{name:{type:d.ZU.STRING},bonus:{type:d.ZU.STRING},damage:{type:d.ZU.STRING}},required:["name","bonus","damage"]},u={type:d.ZU.ARRAY,items:{type:d.ZU.STRING},description:"A list of 3-5 bullet points describing the character's physical appearance and clothing."},x={name:{type:d.ZU.STRING},appearance:u,personality:{type:d.ZU.ARRAY,items:{type:d.ZU.STRING},description:"A list of 3-5 bullet points describing the character's actionable personality traits."},backstory:{type:d.ZU.ARRAY,items:{type:d.ZU.STRING},description:"A list of 3-5 bullet points summarizing the character's key backstory elements."},equipment:{type:d.ZU.ARRAY,items:{type:d.ZU.STRING}}},g={type:d.ZU.OBJECT,properties:{...x,race:{type:d.ZU.STRING},class:{type:d.ZU.STRING},background:{type:d.ZU.STRING},alignment:{type:d.ZU.STRING},hitPoints:{type:d.ZU.INTEGER,description:"Character's total hit points at level 1."},armorClass:{type:d.ZU.INTEGER,description:"Character's armor class."},speed:{type:d.ZU.STRING,description:"Character's speed, e.g., '30 ft'."},stats:{type:d.ZU.OBJECT,properties:{strength:{type:d.ZU.INTEGER},dexterity:{type:d.ZU.INTEGER},constitution:{type:d.ZU.INTEGER},intelligence:{type:d.ZU.INTEGER},wisdom:{type:d.ZU.INTEGER},charisma:{type:d.ZU.INTEGER}},required:["strength","dexterity","constitution","intelligence","wisdom","charisma"]},skills:{type:d.ZU.ARRAY,items:{type:d.ZU.STRING},description:"List of skills the character is proficient in."},proficiencies:{type:d.ZU.OBJECT,properties:{weapons:{type:d.ZU.ARRAY,items:{type:d.ZU.STRING}},armor:{type:d.ZU.ARRAY,items:{type:d.ZU.STRING}},tools:{type:d.ZU.ARRAY,items:{type:d.ZU.STRING}}},required:["weapons","armor","tools"]},attacks:{type:d.ZU.ARRAY,items:p}},required:["name","race","class","background","alignment","hitPoints","armorClass","speed","stats","skills","proficiencies","attacks","backstory","appearance","personality","equipment"]},y={type:d.ZU.OBJECT,properties:{...x,ancestry:{type:d.ZU.STRING},heritage:{type:d.ZU.STRING},background:{type:d.ZU.STRING},class:{type:d.ZU.STRING},alignment:{type:d.ZU.STRING},hitPoints:{type:d.ZU.INTEGER,description:"Character's total hit points at level 1."},armorClass:{type:d.ZU.INTEGER,description:"Character's armor class."},speed:{type:d.ZU.STRING,description:"Character's speed, e.g., '25 ft'."},attributes:{type:d.ZU.OBJECT,properties:{strength:{type:d.ZU.INTEGER},dexterity:{type:d.ZU.INTEGER},constitution:{type:d.ZU.INTEGER},intelligence:{type:d.ZU.INTEGER},wisdom:{type:d.ZU.INTEGER},charisma:{type:d.ZU.INTEGER}},required:["strength","dexterity","constitution","intelligence","wisdom","charisma"]},skills:{type:d.ZU.ARRAY,items:{type:d.ZU.OBJECT,properties:{name:{type:d.ZU.STRING},rank:{type:d.ZU.STRING,description:"e.g., Trained, Expert"}},required:["name","rank"]}},attacks:{type:d.ZU.ARRAY,items:p}},required:["name","ancestry","heritage","background","class","alignment","hitPoints","armorClass","speed","attributes","skills","attacks","backstory","appearance","personality","equipment"]},b={type:d.ZU.OBJECT,properties:{...x,playbook:{type:d.ZU.STRING},heritage:{type:d.ZU.STRING},background:{type:d.ZU.STRING},vice:{type:d.ZU.STRING,description:"The character's vice, e.g., 'Gambling' or 'Luxury'."},purveyor:{type:d.ZU.STRING,description:"The character's preferred purveyor for their vice."},aliases:{type:d.ZU.ARRAY,items:{type:d.ZU.STRING}},drives:{type:d.ZU.ARRAY,items:{type:d.ZU.STRING},description:"A list of 3-5 bullet points describing the character's core motivations, goals, or methods."},attributes:{type:d.ZU.OBJECT,properties:{insight:{type:d.ZU.INTEGER},prowess:{type:d.ZU.INTEGER},resolve:{type:d.ZU.INTEGER}},required:["insight","prowess","resolve"]},actionRatings:{type:d.ZU.ARRAY,items:{type:d.ZU.OBJECT,properties:{action:{type:d.ZU.STRING,description:"The name of the action, e.g., Hunt, Study, Prowl."},rating:{type:d.ZU.INTEGER,description:"The rating for the action, from 0 to 4."}},required:["action","rating"]},description:"A list of the character's action ratings."},specialAbilities:{type:d.ZU.ARRAY,items:{type:d.ZU.STRING}},friends:{type:d.ZU.ARRAY,items:{type:d.ZU.STRING}},gear:{type:d.ZU.ARRAY,items:{type:d.ZU.OBJECT,properties:{name:{type:d.ZU.STRING},load:{type:d.ZU.INTEGER}},required:["name","load"]},description:"Character's standard gear items."},harm:{type:d.ZU.OBJECT,properties:{level3:{type:d.ZU.STRING,description:"Description of Level 3 Harm taken. Empty string if none."},level2:{type:d.ZU.STRING,description:"Description of Level 2 Harm taken. Empty string if none."},level1:{type:d.ZU.STRING,description:"Description of Level 1 Harm taken. Empty string if none."}},required:["level3","level2","level1"]}},required:["name","playbook","heritage","background","vice","purveyor","appearance","aliases","attributes","actionRatings","specialAbilities","friends","gear","harm","drives"]},f={type:d.ZU.OBJECT,properties:{character:g,npcs:{type:d.ZU.ARRAY,items:g,description:"Array of NPCs related to the main character"}},required:["character","npcs"]},j={type:d.ZU.OBJECT,properties:{character:y,npcs:{type:d.ZU.ARRAY,items:y,description:"Array of NPCs related to the main character"}},required:["character","npcs"]},v={type:d.ZU.OBJECT,properties:{character:b,npcs:{type:d.ZU.ARRAY,items:b,description:"Array of NPCs related to the main character"}},required:["character","npcs"]},w={[c.DND5E]:{name:"Dungeons & Dragons 5th Edition",schema:g,schemaWithNpcs:f},[c.PF2E]:{name:"Pathfinder 2nd Edition",schema:y,schemaWithNpcs:j},[c.BLADES]:{name:"Blades in the Dark",schema:b,schemaWithNpcs:v}},N=new Map,k=async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=w[e],s="".concat(e,":").concat(t,":").concat(a);if(N.has(s))return N.get(s);let n="You are an expert TTRPG creator specializing in ".concat(r.name,". Your goal is to generate a rich, thematic, and mechanically sound level 1 character based on a user prompt. Adhere strictly to the provided JSON schema. For personality, backstory, and appearance fields, provide 3-5 distinct, actionable bullet points."),c='Based on the following concept: "'.concat(t,'", generate a complete level 1 character for the ').concat(r.name," roleplaying game. Fill out all the fields in the JSON schema with creative and appropriate details."),i=r.schema;a&&(n="You are an expert TTRPG creator specializing in ".concat(r.name,". Generate a main character and up to 3 related NPCs based on the user's concept. The NPCs should connect directly to the main character's backstory, creating interesting plot hooks. Adhere strictly to the provided JSON schema."),c='Based on the following concept: "'.concat(t,'", generate a complete level 1 character along with 1-3 related NPCs for the ').concat(r.name," roleplaying game. The NPCs should connect directly to the main character's backstory, creating interesting plot hooks. Fill out all the fields in the JSON schema with creative and appropriate details."),i=r.schemaWithNpcs);let o=(await m.models.generateContent({model:"gemini-2.5-flash",contents:c,config:{systemInstruction:n,responseMimeType:"application/json",responseSchema:i}})).text.trim();try{let e=JSON.parse(o);return N.set(s,e),e}catch(e){throw console.error("Failed to parse JSON response:",o,e),Error("Received an invalid format from the API.")}},A=async(e,t)=>(await k(e,t,!1)).character,R=async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=await k(e,t,!0);return{character:r.character,npcs:r.npcs?r.npcs.slice(0,a):[]}},C=()=>(0,s.jsxs)("header",{className:"text-center mb-8",children:[(0,s.jsx)("h1",{className:"text-4xl sm:text-5xl md:text-6xl text-amber-300 font-title tracking-wider",children:"TTRPG Character Generator"}),(0,s.jsx)("p",{className:"text-gray-400 mt-2 text-lg",children:"Bring your heroes and villains to life with a spark of AI."})]}),E=e=>{let{systems:t,selectedSystem:a,onSelectSystem:r}=e;return(0,s.jsx)("div",{className:"flex justify-center space-x-2 sm:space-x-4 mb-8 bg-gray-800 p-2 rounded-lg shadow-lg",children:t.map(e=>(0,s.jsx)("button",{onClick:()=>r(e.id),className:"font-title px-4 py-2 rounded-md text-sm sm:text-base transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-amber-400\n            ".concat(a===e.id?"bg-amber-500 text-gray-900 shadow-md scale-105":"bg-gray-700 text-gray-300 hover:bg-gray-600"),children:e.name},e.id))})},U={[c.DND5E]:["A stoic half-orc barbarian who is afraid of the dark","A cunning tiefling rogue with a heart of gold","A grizzled dwarven cleric who has lost their faith","An elven wizard obsessed with forbidden knowledge","A charismatic human bard who is secretly a spy","A gnome artificer whose inventions always have a chaotic side-effect","A dragonborn sorcerer struggling to control their innate magical powers","A halfling monk who seeks enlightenment through perfecting the ultimate sandwich","A fallen aasimar paladin trying to redeem a cursed family name"],[c.PF2E]:["A Leshy druid who wants to see the world beyond their forest","An automaton champion searching for their creator's purpose","A goblin witch who speaks to an unusually intelligent toad","A human gunslinger seeking revenge on a notorious outlaw","An elf magus who blends swordplay and arcane might seamlessly","A dwarf investigator who solves crimes with meticulous detail","A catfolk swashbuckler with unmatched panache and flair","A fetchling thaumaturge who uses esoteric trinkets to fight evil","A gnome inventor with a clockwork companion that's slightly malfunctioning"],[c.BLADES]:["A Cutter who uses their imposing presence to settle scores in the Crows Foot district","A Leech, the only doctor in Silkshore who will patch up scoundrels, for a price","A Lurk who can navigate the rooftops of Duskvol like a ghost","A Slide whose silver tongue has gotten them into and out of trouble with every noble house","A Spider, weaving a web of contacts and secrets from a hidden lair in Charterhall","A Whisper who communes with the ghosts of the city to uncover forgotten paths","A Hound, a deadly shot who tracks targets through the smoggy streets with a loyal pet","A Tycherosi expert on ancient artifacts, fencing them on the black market","A Skovlander refugee turned bare-knuckle boxer in the fighting pits"]},T=e=>{let{onGenerate:t,onGenerateWithNpcs:a,isLoading:r,selectedSystem:c}=e,[i,o]=(0,n.useState)(""),[l,d]=(0,n.useState)([]),h=(0,n.useCallback)(()=>{let e=[...U[c]].sort(()=>.5-Math.random());o(e[0]||""),d(e.slice(1,4))},[c]);return(0,n.useEffect)(()=>{h()},[c,h]),(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault(),t(i)},className:"space-y-4",children:[(0,s.jsx)("textarea",{value:i,onChange:e=>o(e.target.value),className:"w-full h-28 p-4 bg-gray-800 border-2 border-gray-600 rounded-lg text-gray-200 focus:ring-amber-400 focus:border-amber-400 transition-colors duration-300 resize-none",disabled:r,"aria-label":"Character concept"}),(0,s.jsxs)("div",{className:"pb-2",children:[(0,s.jsx)("p",{className:"text-sm text-gray-400 mb-2",children:"Or, try one of these ideas:"}),(0,s.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:l.map((e,t)=>(0,s.jsx)("button",{type:"button",onClick:()=>o(e),disabled:r,className:"text-left p-3 bg-gray-700/50 border border-gray-600 rounded-lg text-sm text-gray-400 hover:bg-gray-700 hover:text-gray-300 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:e},t))}),(0,s.jsx)("div",{className:"flex justify-end mt-2",children:(0,s.jsxs)("button",{type:"button",onClick:h,disabled:r,className:"flex items-center space-x-2 text-sm text-amber-400 hover:text-amber-300 disabled:text-gray-500 transition-colors",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.899 2.186l-1.42.474a5.002 5.002 0 00-8.475-1.588V5a1 1 0 01-2 0V3a1 1 0 011-1zm12 15a1 1 0 01-1-1v-2.101a7.002 7.002 0 01-11.899-2.186l1.42-.474a5.002 5.002 0 008.475 1.588V15a1 1 0 012 0v2a1 1 0 01-1 1z",clipRule:"evenodd"})}),(0,s.jsx)("span",{children:"More Ideas"})]})})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("button",{type:"submit",disabled:r,className:"w-full font-title text-xl bg-amber-600 text-gray-900 font-bold py-3 px-6 rounded-lg hover:bg-amber-500 transition-all duration-300 disabled:bg-gray-600 disabled:cursor-not-allowed flex items-center justify-center shadow-lg transform hover:scale-105",children:r?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Generating..."]}):"Generate Character"}),a&&(0,s.jsx)("button",{type:"button",onClick:e=>{e.preventDefault(),a(i)},disabled:r||!i,className:"w-full font-title text-lg bg-purple-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-purple-500 transition-all duration-300 disabled:bg-gray-600 disabled:cursor-not-allowed flex items-center justify-center shadow-lg transform hover:scale-105",children:r?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Generating with NPCs..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})}),"Generate with NPCs"]})})]})]})},S=()=>(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-2 inline-block text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})}),Z=()=>(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-2 inline-block text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})}),I=()=>(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-2 inline-block text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),G=()=>(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-2 inline-block text-gray-400",viewBox:"0 0 20 20",fill:"currentColor",children:[(0,s.jsx)("path",{d:"M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"}),(0,s.jsx)("path",{fillRule:"evenodd",d:"M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z",clipRule:"evenodd"})]}),P=()=>(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-2 inline-block text-gray-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M18 8a6 6 0 01-7.743 5.743L10 14l-1 1-1 1H6v2H4v-4l4.257-4.257A6 6 0 1118 8zm-6-4a4 4 0 100 8 4 4 0 000-8z",clipRule:"evenodd"})}),B=()=>(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z",clipRule:"evenodd"})}),D=()=>(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M5 4v3H4a2 2 0 00-2 2v3a2 2 0 002 2h1v3a2 2 0 002 2h6a2 2 0 002-2v-3h1a2 2 0 002-2V9a2 2 0 00-2-2h-1V4a2 2 0 00-2-2H7a2 2 0 00-2 2zm8 0H7v3h6V4zm0 8H7v4h6v-4z",clipRule:"evenodd"})}),L=()=>(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 9.707a1 1 0 011.414 0L9 11.086V3a1 1 0 112 0v8.086l1.293-1.379a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd"})}),Y=()=>(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{d:"M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"})}),z=()=>(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM14.657 2.929a1 1 0 011.414 0A9.972 9.972 0 0119 10a9.972 9.972 0 01-2.929 7.071 1 1 0 01-1.414-1.414A7.971 7.971 0 0017 10c0-2.21-.894-4.208-2.343-5.657a1 1 0 010-1.414zm-2.829 2.828a1 1 0 011.415 0A5.983 5.983 0 0115 10a5.984 5.984 0 01-1.757 4.243 1 1 0 01-1.415-1.415A3.984 3.984 0 0013 10a3.983 3.983 0 00-1.172-2.828 1 1 0 010-1.415z",clipRule:"evenodd"})}),M=e=>{let{children:t,storedCharacter:a,onBack:r}=e,{character:i,id:o}=a,[l,d]=(0,n.useState)(null),h=(e=>{if("name"in e){if("race"in e&&"class"in e)return{name:e.name,details:"".concat(e.race," ").concat(e.class," | ").concat(e.background," | ").concat(e.alignment)};if("ancestry"in e&&"class"in e)return{name:e.name,details:"".concat(e.ancestry," ").concat(e.class," | ").concat(e.background," | ").concat(e.alignment)};if("playbook"in e)return{name:e.name,details:"".concat(e.playbook," | ").concat(e.heritage," | ").concat(e.background)}}return{name:"Unknown Character",details:""}})(i);return(0,n.useEffect)(()=>{let e=(e=>{let t=[];return"name"in e&&e.name&&t.push(e.name),"race"in e&&"class"in e?t.push("a ".concat(e.race," ").concat(e.class)):"ancestry"in e&&"class"in e?t.push("a ".concat(e.ancestry," ").concat(e.class)):"playbook"in e&&t.push("a gritty ".concat(e.playbook)),"appearance"in e&&e.appearance&&Array.isArray(e.appearance)&&t.push(e.appearance.join(", ")),"A fantasy portrait of ".concat(t.join(", "),". Digital painting, detailed, character concept art, fantasy illustration.")})(i),t=o.split("").reduce((e,t)=>e+t.charCodeAt(0),0),a=encodeURIComponent(e);d("https://image.pollinations.ai/prompt/".concat(a,"?width=512&height=512&seed=").concat(t,"&model=flux"))},[i,o]),(0,s.jsxs)("div",{className:"bg-gray-800 p-4 sm:p-6 rounded-xl border-2 border-amber-900/50 shadow-2xl animate-fade-in print-container",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6 no-print",children:[(0,s.jsxs)("button",{onClick:r,className:"font-title bg-gray-700 text-amber-300 py-2 px-4 rounded-lg hover:bg-gray-600 transition-colors duration-300 flex items-center space-x-2","aria-label":"Return to character list",children:[(0,s.jsx)(B,{}),(0,s.jsx)("span",{children:"New/View Characters"})]}),(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsxs)("button",{onClick:()=>{(e=>{let{character:t,system:a}=e,r="",s="character";switch(a){case c.DND5E:r=(e=>'---\ntitle: "'.concat(e.name,'"\nsystem: "D&D 5e"\nrace: "').concat(e.race,'"\nclass: "').concat(e.class,'"\nbackground: "').concat(e.background,'"\nalignment: "').concat(e.alignment,'"\n---\n\n# ').concat(e.name,"\n*").concat(e.alignment," ").concat(e.race," ").concat(e.class,"*\n\n## Vitals\n| Armor Class | Hit Points | Speed |\n|:-----------:|:----------:|:-----:|\n| ").concat(e.armorClass," | ").concat(e.hitPoints," | ").concat(e.speed," |\n\n## Ability Scores\n| STR | DEX | CON | INT | WIS | CHA |\n|:---:|:---:|:---:|:---:|:---:|:---:|\n| ").concat(e.stats.strength," | ").concat(e.stats.dexterity," | ").concat(e.stats.constitution," | ").concat(e.stats.intelligence," | ").concat(e.stats.wisdom," | ").concat(e.stats.charisma," |\n\n## Skills & Proficiencies\n**Skills:** ").concat(e.skills.join(", "),"\n\n**Armor:** ").concat(e.proficiencies.armor.join(", "),"\n**Weapons:** ").concat(e.proficiencies.weapons.join(", "),"\n**Tools:** ").concat(e.proficiencies.tools.join(", "),"\n\n## Attacks\n").concat(e.attacks.map(e=>"- **".concat(e.name,":** ").concat(e.bonus," to hit, ").concat(e.damage,".")).join("\n"),"\n\n## Appearance\n").concat(e.appearance.map(e=>"- ".concat(e)).join("\n"),"\n\n## Personality\n").concat(e.personality.map(e=>"- ".concat(e)).join("\n"),"\n\n## Backstory\n").concat(e.backstory.map(e=>"- ".concat(e)).join("\n"),"\n\n## Equipment\n").concat(e.equipment.map(e=>"- ".concat(e)).join("\n"),"\n"))(t),s=t.name;break;case c.PF2E:r=(e=>'---\ntitle: "'.concat(e.name,'"\nsystem: "Pathfinder 2e"\nancestry: "').concat(e.ancestry,'"\nheritage: "').concat(e.heritage,'"\nclass: "').concat(e.class,'"\nbackground: "').concat(e.background,'"\nalignment: "').concat(e.alignment,'"\n---\n\n# ').concat(e.name,"\n*").concat(e.alignment," ").concat(e.ancestry," ").concat(e.class,"*\n\n## Vitals\n| Armor Class | Hit Points | Speed |\n|:-----------:|:----------:|:-----:|\n| ").concat(e.armorClass," | ").concat(e.hitPoints," | ").concat(e.speed," |\n\n## Attributes\n| STR | DEX | CON | INT | WIS | CHA |\n|:---:|:---:|:---:|:---:|:---:|:---:|\n| ").concat(e.attributes.strength," | ").concat(e.attributes.dexterity," | ").concat(e.attributes.constitution," | ").concat(e.attributes.intelligence," | ").concat(e.attributes.wisdom," | ").concat(e.attributes.charisma," |\n\n## Skills\n").concat(e.skills.map(e=>"- ".concat(e.name," (").concat(e.rank,")")).join("\n"),"\n\n## Attacks\n").concat(e.attacks.map(e=>"- **".concat(e.name,":** ").concat(e.bonus," to hit, ").concat(e.damage,".")).join("\n"),"\n\n## Appearance\n").concat(e.appearance.map(e=>"- ".concat(e)).join("\n"),"\n\n## Personality\n").concat(e.personality.map(e=>"- ".concat(e)).join("\n"),"\n\n## Backstory\n").concat(e.backstory.map(e=>"- ".concat(e)).join("\n"),"\n\n## Equipment\n").concat(e.equipment.map(e=>"- ".concat(e)).join("\n"),"\n"))(t),s=t.name;break;case c.BLADES:r=(e=>'---\ntitle: "'.concat(e.name,'"\nsystem: "Blades in the Dark"\nplaybook: "').concat(e.playbook,'"\nheritage: "').concat(e.heritage,'"\nbackground: "').concat(e.background,'"\nvice: "').concat(e.vice,'"\n---\n\n# ').concat(e.name,"\n*A ").concat(e.heritage," ").concat(e.playbook," from a ").concat(e.background," background.*\n\n**Vice:** ").concat(e.vice," (Purveyor: ").concat(e.purveyor,")\n**Aliases:** ").concat(e.aliases.join(", "),"\n\n## Attributes\n| Insight | Prowess | Resolve |\n|:-------:|:-------:|:-------:|\n| ").concat(e.attributes.insight," | ").concat(e.attributes.prowess," | ").concat(e.attributes.resolve," |\n\n## Action Ratings\n").concat(e.actionRatings.map(e=>"- **".concat(e.action,":** ").concat(e.rating)).join("\n"),"\n\n## Appearance\n").concat(e.appearance.map(e=>"- ".concat(e)).join("\n"),"\n\n## Drives\n").concat(e.drives.map(e=>"- ".concat(e)).join("\n"),"\n\n## Special Abilities\n").concat(e.specialAbilities.map(e=>"- ".concat(e)).join("\n"),"\n\n## Friends / Rivals\n").concat(e.friends.map(e=>"- ".concat(e)).join("\n"),"\n\n## Gear\n").concat(e.gear.map(e=>"- ".concat(e.name," (Load ").concat(e.load,")")).join("\n"),"\n\n## Harm\n- **Level 3:** ").concat(e.harm.level3||" ","\n- **Level 2:** ").concat(e.harm.level2||" ","\n- **Level 1:** ").concat(e.harm.level1||" ","\n"))(t),s=t.name;break;default:console.error("Unknown system for MDX export");return}let n=new Blob([r],{type:"text/markdown;charset=utf-8"}),i=URL.createObjectURL(n),o=document.createElement("a");o.setAttribute("href",i),o.setAttribute("download","".concat(s.replace(/[^a-z0-9]/gi,"_").toLowerCase(),".mdx")),document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(i)})(a)},className:"font-title bg-gray-700 text-amber-300 py-2 px-4 rounded-lg hover:bg-gray-600 transition-colors duration-300 flex items-center space-x-2","aria-label":"Export character as MDX file",children:[(0,s.jsx)(L,{}),(0,s.jsx)("span",{children:"Export MDX"})]}),(0,s.jsxs)("button",{onClick:()=>{window.print()},className:"font-title bg-gray-700 text-amber-300 py-2 px-4 rounded-lg hover:bg-gray-600 transition-colors duration-300 flex items-center space-x-2","aria-label":"Print character sheet",children:[(0,s.jsx)(D,{}),(0,s.jsx)("span",{children:"Print"})]})]})]}),(0,s.jsxs)("div",{className:"flex flex-col md:flex-row gap-6 text-center md:text-left items-center mb-4 border-b-2 border-amber-900/50 pb-4 print-border-gray",children:[l&&(0,s.jsx)("img",{src:l,alt:"Portrait of ".concat(h.name),className:"w-32 h-32 rounded-full object-cover border-4 border-amber-800/50 shadow-lg no-print flex-shrink-0"}),(0,s.jsxs)("div",{className:"flex-grow",children:[(0,s.jsx)("h2",{className:"font-title text-3xl sm:text-4xl text-amber-300 print-text-black",children:h.name}),(0,s.jsx)("p",{className:"text-gray-400 print-text-black",children:h.details})]})]}),(0,s.jsx)("div",{className:"print-friendly-sheet",children:t})]})},q=e=>{let{label:t,value:a,modifier:r}=e;return(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center bg-gray-900 p-3 rounded-lg border border-gray-600 text-center shadow-inner print-bg-white print-border-gray",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-amber-300 print-text-black",children:a}),(0,s.jsx)("div",{className:"text-xs uppercase tracking-widest text-gray-400 print-text-black",children:t}),void 0!==r&&(0,s.jsx)("div",{className:"mt-1 text-lg font-bold print-text-black",children:r>=0?"+".concat(r):r})]})},H=e=>{let{title:t,children:a,className:r=""}=e;return(0,s.jsxs)("div",{className:"bg-gray-800/50 p-4 rounded-lg border border-gray-700 shadow-lg print-bg-white print-border-gray ".concat(r),children:[(0,s.jsx)("h3",{className:"font-title text-xl text-amber-400 border-b-2 border-amber-800/50 pb-2 mb-3 print-text-black print-border-gray",children:t}),a]})},O=e=>{let{label:t,value:a,className:r}=e;return(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center bg-gray-900 p-2 rounded-lg border border-gray-600 text-center shadow-inner print-bg-white print-border-gray ".concat(r),children:[(0,s.jsx)("div",{className:"text-xs uppercase tracking-widest text-gray-400 print-text-black",children:t}),(0,s.jsx)("div",{className:"text-xl font-bold text-amber-300 print-text-black",children:a})]})},F=e=>{let{icon:t,children:a}=e;return(0,s.jsxs)("li",{className:"flex items-start text-gray-300 print-text-black",children:[(0,s.jsx)("span",{className:"flex-shrink-0 w-5 h-5 mt-0.5",children:t}),(0,s.jsx)("span",{className:"ml-2",children:a})]})},J=e=>{let{children:t}=e;return(0,s.jsx)("span",{className:"inline-block bg-gray-700 text-gray-300 text-xs font-medium mr-2 mb-2 px-2.5 py-1 rounded-full print-border-gray border print-bg-white print-text-black",children:t})},W=e=>{let{character:t}=e,a=e=>Math.floor((e-10)/2);return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-3 sm:grid-cols-6 gap-2",children:[(0,s.jsx)(q,{label:"STR",value:t.stats.strength,modifier:a(t.stats.strength)}),(0,s.jsx)(q,{label:"DEX",value:t.stats.dexterity,modifier:a(t.stats.dexterity)}),(0,s.jsx)(q,{label:"CON",value:t.stats.constitution,modifier:a(t.stats.constitution)}),(0,s.jsx)(q,{label:"INT",value:t.stats.intelligence,modifier:a(t.stats.intelligence)}),(0,s.jsx)(q,{label:"WIS",value:t.stats.wisdom,modifier:a(t.stats.wisdom)}),(0,s.jsx)(q,{label:"CHA",value:t.stats.charisma,modifier:a(t.stats.charisma)})]}),(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,s.jsx)(O,{label:"Armor Class",value:t.armorClass}),(0,s.jsx)(O,{label:"Hit Points",value:t.hitPoints}),(0,s.jsx)(O,{label:"Speed",value:t.speed})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)(H,{title:"Skills & Proficiencies",children:[(0,s.jsx)("h4",{className:"font-bold text-gray-400 mb-2 print-text-black",children:"Proficient Skills"}),(0,s.jsx)("div",{className:"flex flex-wrap",children:t.skills.map(e=>(0,s.jsx)(J,{children:e},e))}),(0,s.jsx)("h4",{className:"font-bold text-gray-400 mt-4 mb-2 print-text-black",children:"Other Proficiencies"}),(0,s.jsxs)("ul",{className:"space-y-2 text-sm",children:[(0,s.jsxs)(F,{icon:(0,s.jsx)(Z,{}),children:[(0,s.jsx)("b",{children:"Armor:"})," ",t.proficiencies.armor.join(", ")]}),(0,s.jsxs)(F,{icon:(0,s.jsx)(S,{}),children:[(0,s.jsx)("b",{children:"Weapons:"})," ",t.proficiencies.weapons.join(", ")]}),(0,s.jsxs)(F,{icon:(0,s.jsx)(I,{}),children:[(0,s.jsx)("b",{children:"Tools:"})," ",t.proficiencies.tools.join(", ")]})]})]}),(0,s.jsxs)(H,{title:"Attacks & Equipment",children:[(0,s.jsx)("h4",{className:"font-bold text-gray-400 mb-2 print-text-black",children:"Attacks"}),(0,s.jsx)("div",{className:"space-y-2 mb-4",children:t.attacks.map((e,t)=>(0,s.jsxs)("div",{className:"text-sm text-gray-300 print-text-black",children:[(0,s.jsxs)("span",{className:"font-bold",children:[e.name,":"]})," ",e.bonus," to hit, ",e.damage,"."]},t))}),(0,s.jsx)("h4",{className:"font-bold text-gray-400 mt-4 mb-2 print-text-black",children:"Equipment"}),(0,s.jsx)("ul",{className:"list-inside text-gray-300 text-sm space-y-2",children:t.equipment.map((e,t)=>(0,s.jsx)(F,{icon:(0,s.jsx)(P,{}),children:e},t))})]}),(0,s.jsx)(H,{title:"Appearance",children:(0,s.jsx)("ul",{className:"space-y-2 text-sm",children:t.appearance.map((e,t)=>(0,s.jsx)(F,{icon:(0,s.jsx)(G,{}),children:e},t))})}),(0,s.jsx)(H,{title:"Personality",children:(0,s.jsx)("ul",{className:"space-y-2 text-sm",children:t.personality.map((e,t)=>(0,s.jsx)(F,{icon:(0,s.jsx)(G,{}),children:e},t))})}),(0,s.jsx)("div",{className:"md:col-span-2",children:(0,s.jsx)(H,{title:"Backstory",children:(0,s.jsx)("ul",{className:"space-y-2 text-sm",children:t.backstory.map((e,t)=>(0,s.jsx)(F,{icon:(0,s.jsx)(G,{}),children:e},t))})})})]})]})},V=e=>{let{character:t}=e,a=e=>Math.floor((e-10)/2);return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-3 sm:grid-cols-6 gap-2",children:[(0,s.jsx)(q,{label:"STR",value:t.attributes.strength,modifier:a(t.attributes.strength)}),(0,s.jsx)(q,{label:"DEX",value:t.attributes.dexterity,modifier:a(t.attributes.dexterity)}),(0,s.jsx)(q,{label:"CON",value:t.attributes.constitution,modifier:a(t.attributes.constitution)}),(0,s.jsx)(q,{label:"INT",value:t.attributes.intelligence,modifier:a(t.attributes.intelligence)}),(0,s.jsx)(q,{label:"WIS",value:t.attributes.wisdom,modifier:a(t.attributes.wisdom)}),(0,s.jsx)(q,{label:"CHA",value:t.attributes.charisma,modifier:a(t.attributes.charisma)})]}),(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,s.jsx)(O,{label:"Armor Class",value:t.armorClass}),(0,s.jsx)(O,{label:"Hit Points",value:t.hitPoints}),(0,s.jsx)(O,{label:"Speed",value:t.speed})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsx)(H,{title:"Skills",children:(0,s.jsx)("div",{className:"flex flex-wrap",children:t.skills.map(e=>(0,s.jsxs)(J,{children:[e.name," (",e.rank,")"]},e.name))})}),(0,s.jsxs)(H,{title:"Attacks & Equipment",children:[(0,s.jsx)("h4",{className:"font-bold text-gray-400 mb-2 print-text-black",children:"Attacks"}),(0,s.jsx)("div",{className:"space-y-2 mb-4",children:t.attacks.map((e,t)=>(0,s.jsxs)("div",{className:"text-sm text-gray-300 print-text-black",children:[(0,s.jsxs)("span",{className:"font-bold",children:[e.name,":"]})," ",e.bonus," to hit, ",e.damage,"."]},t))}),(0,s.jsx)("h4",{className:"font-bold text-gray-400 mt-4 mb-2 print-text-black",children:"Equipment"}),(0,s.jsx)("ul",{className:"list-inside text-gray-300 text-sm space-y-2",children:t.equipment.map((e,t)=>(0,s.jsx)(F,{icon:(0,s.jsx)(P,{}),children:e},t))})]}),(0,s.jsx)(H,{title:"Appearance",children:(0,s.jsx)("ul",{className:"space-y-2 text-sm",children:t.appearance.map((e,t)=>(0,s.jsx)(F,{icon:(0,s.jsx)(G,{}),children:e},t))})}),(0,s.jsx)(H,{title:"Personality",children:(0,s.jsx)("ul",{className:"space-y-2 text-sm",children:t.personality.map((e,t)=>(0,s.jsx)(F,{icon:(0,s.jsx)(G,{}),children:e},t))})}),(0,s.jsx)("div",{className:"md:col-span-2",children:(0,s.jsx)(H,{title:"Backstory",children:(0,s.jsx)("ul",{className:"space-y-2 text-sm",children:t.backstory.map((e,t)=>(0,s.jsx)(F,{icon:(0,s.jsx)(G,{}),children:e},t))})})})]})]})},_=e=>{let{harm:t}=e;return(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"border border-gray-600 p-2 rounded bg-gray-900 print-bg-white print-border-gray",children:[(0,s.jsx)("label",{className:"text-xs uppercase text-gray-400 print-text-black",children:"Level 3 Harm (Fatal)"}),(0,s.jsx)("p",{className:"text-sm text-red-400 h-6 print-text-black",children:t.level3||" "})]}),(0,s.jsxs)("div",{className:"border border-gray-600 p-2 rounded bg-gray-900 print-bg-white print-border-gray",children:[(0,s.jsx)("label",{className:"text-xs uppercase text-gray-400 print-text-black",children:"Level 2 Harm (Severe)"}),(0,s.jsx)("p",{className:"text-sm text-orange-400 h-6 print-text-black",children:t.level2||" "})]}),(0,s.jsxs)("div",{className:"border border-gray-600 p-2 rounded bg-gray-900 print-bg-white print-border-gray",children:[(0,s.jsx)("label",{className:"text-xs uppercase text-gray-400 print-text-black",children:"Level 1 Harm (Less Severe)"}),(0,s.jsx)("p",{className:"text-sm text-yellow-400 h-6 print-text-black",children:t.level1||" "})]})]})},K=e=>{let{character:t}=e;return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,s.jsx)(q,{label:"Insight",value:t.attributes.insight}),(0,s.jsx)(q,{label:"Prowess",value:t.attributes.prowess}),(0,s.jsx)(q,{label:"Resolve",value:t.attributes.resolve})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)(H,{title:"Core Info",className:"md:col-span-1",children:[(0,s.jsxs)("p",{className:"text-sm",children:[(0,s.jsx)("strong",{className:"text-gray-400 print-text-black",children:"Heritage:"})," ",t.heritage]}),(0,s.jsxs)("p",{className:"text-sm",children:[(0,s.jsx)("strong",{className:"text-gray-400 print-text-black",children:"Background:"})," ",t.background]}),(0,s.jsxs)("p",{className:"text-sm",children:[(0,s.jsx)("strong",{className:"text-gray-400 print-text-black",children:"Vice:"})," ",t.vice," (",t.purveyor,")"]}),(0,s.jsxs)("p",{className:"text-sm",children:[(0,s.jsx)("strong",{className:"text-gray-400 print-text-black",children:"Aliases:"})," ",t.aliases.join(", ")]})]}),(0,s.jsx)(H,{title:"Action Ratings",className:"md:col-span-2",children:(0,s.jsx)("div",{className:"columns-2 md:columns-3 text-sm",children:t.actionRatings.map(e=>{let{action:t,rating:a}=e;return(0,s.jsxs)("p",{className:"mb-1",children:[(0,s.jsxs)("strong",{className:"text-gray-400 print-text-black",children:[t,":"]})," ","●".repeat(a),"○".repeat(4-a)]},t)})})}),(0,s.jsx)(H,{title:"Appearance",className:"md:col-span-3",children:(0,s.jsx)("ul",{className:"space-y-2 text-sm",children:t.appearance.map((e,t)=>(0,s.jsx)(F,{icon:(0,s.jsx)(G,{}),children:e},t))})}),(0,s.jsx)(H,{title:"Drives",className:"md:col-span-3",children:(0,s.jsx)("ul",{className:"space-y-2 text-sm",children:t.drives.map((e,t)=>(0,s.jsx)(F,{icon:(0,s.jsx)(G,{}),children:e},t))})}),(0,s.jsx)(H,{title:"Special Abilities",className:"md:col-span-2",children:(0,s.jsx)("ul",{className:"text-sm space-y-2",children:t.specialAbilities.map((e,t)=>(0,s.jsx)(F,{icon:(0,s.jsx)(G,{}),children:e},t))})}),(0,s.jsx)(H,{title:"Harm",children:(0,s.jsx)(_,{harm:t.harm})}),(0,s.jsx)(H,{title:"Friends / Rivals",children:(0,s.jsx)("ul",{className:"list-disc list-inside text-gray-300 text-sm space-y-1 print-text-black",children:t.friends.map((e,t)=>(0,s.jsx)("li",{children:e},t))})}),(0,s.jsx)(H,{title:"Gear",children:(0,s.jsx)("ul",{className:"text-sm space-y-2",children:t.gear.map((e,t)=>(0,s.jsxs)(F,{icon:(0,s.jsx)(P,{}),children:[(0,s.jsx)("strong",{children:e.name})," (Load: ",e.load,")"]},t))})})]})]})};var X=a(7383);let Q=e=>{let{message:t}=e,a="user"===t.role,[r,c]=(0,n.useState)(!1),i=(0,n.useRef)(null),o=(0,n.useRef)(null),l=()=>{i.current&&(i.current.pause(),i.current.removeEventListener("ended",l),i.current.removeEventListener("error",l),i.current.removeAttribute("src"),i.current=null),o.current&&(URL.revokeObjectURL(o.current),o.current=null),c(!1)};(0,n.useEffect)(()=>l,[]);let d=async()=>{if(r)return void l();l(),c(!0);let e=t.content.replace(/\//g," slash "),a="https://text.pollinations.ai/".concat(encodeURIComponent(e),"?model=openai-audio&voice=onyx");try{let e=await fetch(a);if(!e.ok){let t=await e.text();throw console.error("Audio API request failed with status ".concat(e.status,":"),t.substring(0,500)),Error("API returned status ".concat(e.status))}let t=e.headers.get("Content-Type");if(!t||!t.startsWith("audio/")){let a=await e.text();throw console.error("Unexpected content type:",t,"Response body:",a.substring(0,500)),Error("Response was not an audio file")}let r=await e.blob(),s=URL.createObjectURL(r);o.current=s;let n=new Audio(s);i.current=n,n.play().catch(e=>{console.error("Audio play() failed:",e),l()}),n.addEventListener("ended",l),n.addEventListener("error",l)}catch(e){console.error("Failed to fetch or play audio:",e),l()}};return(0,s.jsxs)("div",{className:"flex items-end gap-2 ".concat(a?"justify-end":"justify-start"),children:[!a&&(0,s.jsx)("button",{onClick:d,className:"self-center p-1.5 rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-amber-400 ".concat(r?"text-amber-400 bg-gray-600 animate-pulse":"text-gray-400 hover:bg-gray-600"),"aria-label":r?"Stop audio":"Play audio response",children:(0,s.jsx)(z,{})}),(0,s.jsx)("div",{className:"max-w-xs md:max-w-md lg:max-w-lg px-4 py-2 rounded-lg text-white ".concat(a?"bg-amber-800":"bg-gray-700"),children:(0,s.jsx)("p",{className:"text-sm break-words",children:t.content})})]})};var $=a(5704);let ee=e=>{let{storedCharacter:t}=e,a=(0,n.useRef)(null),[r,c]=(0,n.useState)([]),[i,o]=(0,n.useState)(""),[l,h]=(0,n.useState)(!1),[m,p]=(0,n.useState)(!0),u=(0,n.useRef)(null),x=(0,n.useRef)(null),g=()=>(null===x.current&&(x.current=new X.qG({publicKey:"pk-lf-2944db31-be9f-4383-87aa-152317d8c0f1",baseUrl:"https://langfuse.omega-spiral.com"})),x.current);(0,n.useEffect)(()=>{var e;null==(e=u.current)||e.scrollIntoView({behavior:"smooth"})},[r]),(0,n.useEffect)(()=>{p(!0),c([{role:"model",content:"Thinking of something to ask you..."}]),o(""),a.current=null,(async()=>{let e=g();try{let r=e.trace({name:"character-chat-initialization",userId:t.id}).generation({name:"initial-message-generation"}),s=new d.M4({apiKey:$.env.API_KEY}),n="You are roleplaying as a character. Based on the following character data: ".concat(JSON.stringify(t.character,null,2),". Your task is to generate a single, brief, in-character opening line (under 30 words). This line must be a question that invites the user to explore a specific part of your character sheet, such as your backstory, a skill, a personality trait, or a piece of equipment. The goal is to spark a conversation that could lead to the user wanting to add more detail to your character. Example questions: 'This old sword has seen many battles... I wonder, does its story interest you?' or 'They say I'm proficient with thieves' tools. Do you believe that's a skill for a hero, or a scoundrel?' Do not add any conversational filler, just provide the single question.");r.update({input:n});let i=(await s.models.generateContent({model:"gemini-2.5-flash",contents:n})).text.trim();r.end({output:i}),c([{role:"model",content:i}]);let o=(e=>{let t=[];return"name"in e&&t.push("You are to roleplay as ".concat(e.name,". You must respond in the first person as this character.")),"class"in e&&"race"in e?(t.push("You are a ".concat(e.race," ").concat(e.class,".")),e.alignment&&t.push("Your alignment is ".concat(e.alignment,".")),e.personality&&t.push("Your core personality traits are: ".concat(e.personality.join(", "),".")),e.backstory&&t.push("Your backstory includes these key points: ".concat(e.backstory.join(" "),"."))):"class"in e&&"ancestry"in e?(t.push("You are a ".concat(e.ancestry," ").concat(e.class,".")),e.alignment&&t.push("Your alignment is ".concat(e.alignment,".")),e.personality&&t.push("Your core personality traits are: ".concat(e.personality.join(", "),".")),e.backstory&&t.push("Your backstory includes these key points: ".concat(e.backstory.join(" "),"."))):"playbook"in e&&(t.push("You are a ".concat(e.playbook," in a grim, industrial city.")),e.heritage&&t.push("Your heritage is ".concat(e.heritage,".")),e.background&&t.push("Your background is as a ".concat(e.background,".")),e.drives&&t.push("Your drives and motivations are: ".concat(e.drives.join(" "),".")),e.vice&&t.push("You have a vice: ".concat(e.vice,"."))),t.push("Maintain this persona consistently. Do not break character or refer to yourself as an AI. Keep your responses brief, under 50 words, and always end with a question to encourage conversation and help the user flesh out your character details. Answer as if you are speaking directly to someone asking you questions."),t.join(" ")})(t.character);a.current=s.chats.create({model:"gemini-2.5-flash",config:{systemInstruction:o}})}catch(e){console.error("Failed to initialize character chat:",e),c([{role:"model",content:"Greetings. I'm ready to talk when you are. What's on your mind?"}])}finally{p(!1),e.flush()}})()},[t]);let y=async e=>{e.preventDefault();let s=a.current;if(!s||!i.trim()||l)return;let n={role:"user",content:i},d=[...r,n];c(d),o(""),h(!0);let m=g(),p=m.trace({name:"character-chat-turn",userId:t.id}).generation({name:"character-response",input:d,metadata:{system:t.system}});try{let e=await s.sendMessage({message:n.content}),t={role:"model",content:e.text};p.end({output:t.content}),c(e=>[...e,t])}catch(t){console.error("Chat error:",t),p.end({level:"ERROR",statusMessage:t.message});let e={role:"model",content:"(I'm sorry, I seem to be at a loss for words right now. Please try again in a moment.)"};c(t=>[...t,e])}finally{h(!1),m.flush()}};return(0,s.jsx)(H,{title:"Speak with this Character",className:"mt-8 no-print",children:(0,s.jsxs)("div",{className:"h-96 flex flex-col bg-gray-900 rounded-lg p-2 sm:p-4 border border-gray-700",children:[(0,s.jsxs)("div",{className:"flex-grow overflow-y-auto pr-2 space-y-4",children:[r.map((e,t)=>(0,s.jsx)(Q,{message:e},t)),l&&(0,s.jsx)("div",{className:"flex justify-start",children:(0,s.jsx)("div",{className:"bg-gray-700 rounded-lg px-4 py-2 text-white max-w-xs md:max-w-md",children:(0,s.jsx)("span",{className:"animate-pulse",children:"..."})})}),(0,s.jsx)("div",{ref:u})]}),(0,s.jsxs)("form",{onSubmit:y,className:"mt-4 flex items-center space-x-2",children:[(0,s.jsx)("input",{type:"text",value:i,onChange:e=>o(e.target.value),className:"flex-grow bg-gray-800 border-2 border-gray-600 rounded-lg p-2 text-gray-200 focus:ring-amber-400 focus:border-amber-400 transition-colors",placeholder:"Ask a question...",disabled:l||m,"aria-label":"Your message"}),(0,s.jsx)("button",{type:"submit",disabled:l||m||!i.trim(),className:"bg-amber-600 text-gray-900 p-2 rounded-lg hover:bg-amber-500 transition-colors disabled:bg-gray-600 disabled:cursor-not-allowed flex-shrink-0","aria-label":"Send message",children:(0,s.jsx)(Y,{})})]})]})})},et=e=>{let{storedCharacter:t,onBack:a}=e,{character:r,system:n}=t;return(0,s.jsxs)(M,{storedCharacter:t,onBack:a,children:[(()=>{switch(n){case c.DND5E:return(0,s.jsx)(W,{character:r});case c.PF2E:return(0,s.jsx)(V,{character:r});case c.BLADES:return(0,s.jsx)(K,{character:r});default:return(0,s.jsx)("p",{children:"Error: Unknown game system selected."})}})(),(0,s.jsx)(ee,{storedCharacter:t})]})},ea=()=>(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center text-center p-8 bg-gray-800/50 rounded-lg mt-8",children:[(0,s.jsxs)("svg",{className:"animate-spin h-10 w-10 text-amber-400 mb-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,s.jsx)("h3",{className:"font-title text-2xl text-amber-300",children:"Conjuring Character..."}),(0,s.jsx)("p",{className:"text-gray-400",children:"The arcane energies are coalescing. Please wait a moment."})]}),er=e=>{let{message:t}=e;return(0,s.jsxs)("div",{className:"bg-red-900/50 border border-red-700 text-red-300 px-4 py-3 rounded-lg relative mt-6",role:"alert",children:[(0,s.jsx)("strong",{className:"font-bold",children:"Oh no! "}),(0,s.jsx)("span",{className:"block sm:inline",children:t})]})},es=[{id:c.DND5E,name:"D&D 5e"},{id:c.PF2E,name:"Pathfinder 2e"},{id:c.BLADES,name:"Blades in the Dark"}],en=e=>{let{characters:t,onSelect:a,onDelete:r,onGenerateNpc:n,isLoading:i}=e;return(0,s.jsx)("div",{className:"bg-gray-800/50 p-2 sm:p-4 rounded-lg border border-gray-700 shadow-lg",children:(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full min-w-[500px] text-left table-auto",children:[(0,s.jsx)("thead",{className:"border-b-2 border-amber-800/50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"p-3 text-sm font-title uppercase text-amber-400 tracking-wider",children:"Name"}),(0,s.jsx)("th",{className:"p-3 text-sm font-title uppercase text-amber-400 tracking-wider hidden sm:table-cell",children:"System"}),(0,s.jsx)("th",{className:"p-3 text-sm font-title uppercase text-amber-400 tracking-wider hidden md:table-cell",children:"Role"}),(0,s.jsx)("th",{className:"p-3 text-sm font-title uppercase text-amber-400 tracking-wider hidden md:table-cell",children:"Summary"}),(0,s.jsx)("th",{className:"p-3 text-sm font-title uppercase text-amber-400 tracking-wider text-right",children:"Actions"})]})}),(0,s.jsx)("tbody",{children:t.map(e=>{var t;return(0,s.jsxs)("tr",{className:"border-b border-gray-700 hover:bg-gray-800 transition-colors duration-200 group",children:[(0,s.jsx)("td",{className:"p-3 font-bold text-gray-200 group-hover:text-amber-300 cursor-pointer",onClick:()=>a(e),children:e.character.name||"Unnamed"}),(0,s.jsx)("td",{className:"p-3 text-gray-400 hidden sm:table-cell cursor-pointer",onClick:()=>a(e),children:null==(t=es.find(t=>t.id===e.system))?void 0:t.name}),(0,s.jsx)("td",{className:"p-3 text-gray-400 hidden md:table-cell cursor-pointer",onClick:()=>a(e),children:e.isNpc?"NPC":"Character"}),(0,s.jsx)("td",{className:"p-3 text-gray-400 hidden md:table-cell cursor-pointer",onClick:()=>a(e),children:(e=>{switch(e.system){case c.DND5E:let t=e.character;return"".concat(t.race," ").concat(t.class);case c.PF2E:let a=e.character;return"".concat(a.ancestry," ").concat(a.class);case c.BLADES:return e.character.playbook;default:return"Character"}})(e)}),(0,s.jsxs)("td",{className:"p-3 text-right space-x-1 sm:space-x-2",children:[(0,s.jsx)("button",{onClick:t=>{t.stopPropagation(),n(e)},disabled:i||e.isNpc,className:"text-amber-400 hover:text-amber-300 font-semibold transition-colors text-sm py-1 px-2 rounded disabled:text-gray-600 disabled:cursor-not-allowed disabled:hover:text-gray-600","aria-label":"Generate NPC related to ".concat(e.character.name||"Unnamed"),title:"Generate a related NPC",children:"Gen NPC"}),(0,s.jsx)("button",{onClick:t=>{t.stopPropagation(),r(e.id)},className:"text-gray-500 hover:text-red-500 font-semibold transition-colors text-sm py-1 px-2 rounded","aria-label":"Delete ".concat(e.character.name||"Unnamed"),children:"Delete"})]})]},e.id)})})]})})})};function ec(){let[e,t]=(0,n.useState)(c.DND5E),[a,r]=(0,n.useState)([]),[i,o]=(0,n.useState)(null),[d,h]=(0,n.useState)(!1),[m,p]=(0,n.useState)(null);(0,n.useEffect)(()=>{(async()=>{try{h(!0);let e=await l.getAllCharacters();r(e)}catch(e){console.error("Failed to load characters from database:",e),p("Failed to load characters from database")}finally{h(!1)}})()},[]);let u=(0,n.useCallback)(async t=>{if(!t)return void p("Please enter a character concept.");h(!0),p(null),o(null);try{let a=await A(e,t),s=await l.addCharacter({system:e,prompt:t,character:a,isNpc:!1});r(e=>[s,...e]),o(s)}catch(e){console.error(e),p("Failed to generate character. The model might be busy or returned an unexpected format. Please try again.")}finally{h(!1)}},[e]),x=(0,n.useCallback)(async e=>{var t;h(!0),p(null),o(null);let a=["a sibling","a childhood friend","a bitter rival","a mentor","a former lover","a sworn enemy","a long-lost parent"],s=a[Math.floor(Math.random()*a.length)],n=e.character.backstory&&Array.isArray(e.character.backstory)?e.character.backstory.join(" "):"a mysterious past",c=(null==(t=es.find(t=>t.id===e.system))?void 0:t.name)||"the game",i='Based on the backstory of an existing character ("'.concat(n,'"), generate a complete level 1 NPC who is ').concat(s," to them. The NPC is for the ").concat(c," roleplaying game. Make the NPC's own story and personality connect directly to the original character's backstory, creating interesting plot hooks.");try{let t=await A(e.system,i),a=await l.addCharacter({system:e.system,prompt:i,character:t,isNpc:!0});r(e=>[a,...e])}catch(e){console.error(e),p("Failed to generate NPC. The model might be busy or returned an unexpected format. Please try again.")}finally{h(!1)}},[]),g=(0,n.useCallback)(async t=>{if(!t)return void p("Please enter a character concept.");h(!0),p(null),o(null);try{let a=await R(e,t,2),s=await l.addCharacter({system:e,prompt:t,character:a.character,isNpc:!1}),n=await Promise.all(a.npcs.map(a=>l.addCharacter({system:e,prompt:"NPC related to: ".concat(t),character:a,isNpc:!0})));r(e=>[s,...n,...e]),o(s)}catch(a){console.error(a),p("NPC Generation failed, generating single character instead.");try{let a=await A(e,t),s=await l.addCharacter({system:e,prompt:t,character:a,isNpc:!1});r(e=>[s,...e]),o(s)}catch(e){p("Failed to generate character. The model might be busy or returned an unexpected format. Please try again.")}}finally{h(!1)}},[e]),y=async e=>{try{await l.deleteCharacter(e),r(t=>t.filter(t=>t.id!==e)),(null==i?void 0:i.id)===e&&o(null)}catch(e){console.error("Failed to delete character from database:",e),p("Failed to delete character")}};return(0,s.jsx)("div",{className:"min-h-screen bg-background text-text p-4 sm:p-6 md:p-8",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,s.jsx)(C,{}),(0,s.jsx)("main",{children:i?(0,s.jsx)(et,{storedCharacter:i,onBack:()=>{o(null)}}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(E,{systems:es,selectedSystem:e,onSelectSystem:t}),(0,s.jsx)(T,{onGenerate:u,onGenerateWithNpcs:g,isLoading:d,selectedSystem:e}),m&&(0,s.jsx)(er,{message:m}),d&&(0,s.jsx)(ea,{}),!d&&a.length>0&&(0,s.jsxs)("div",{className:"mt-12 animate-fade-in",children:[(0,s.jsx)("h2",{className:"font-title text-3xl text-amber-300 text-center mb-4",children:"Character Compendium"}),(0,s.jsx)(en,{characters:a,onSelect:e=>{o(e)},onDelete:y,onGenerateNpc:x,isLoading:d})]})]})})]})})}},9136:(e,t,a)=>{Promise.resolve().then(a.bind(a,2679))}},e=>{e.O(0,[798,596,441,255,358],()=>e(e.s=9136)),_N_E=e.O()}]);